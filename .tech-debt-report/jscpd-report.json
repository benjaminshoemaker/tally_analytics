{
  "statistics": {
    "detectionDate": "2026-02-03T10:00:06.716Z",
    "formats": {
      "tsx": {
        "sources": {
          "packages/sdk/src/react/pages-router.tsx": {
            "lines": 22,
            "tokens": 174,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "packages/sdk/src/react/app-router.tsx": {
            "lines": 26,
            "tokens": 207,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/app/(dashboard)/projects/[id]/sessions/page.tsx": {
            "lines": 97,
            "tokens": 1082,
            "sources": 1,
            "clones": 2,
            "duplicatedLines": 19,
            "duplicatedTokens": 281,
            "percentage": 19.59,
            "percentageTokens": 25.97,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/app/(dashboard)/projects/[id]/overview/page.tsx": {
            "lines": 152,
            "tokens": 1757,
            "sources": 1,
            "clones": 2,
            "duplicatedLines": 19,
            "duplicatedTokens": 281,
            "percentage": 12.5,
            "percentageTokens": 15.99,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/app/(dashboard)/projects/[id]/live/page.tsx": {
            "lines": 91,
            "tokens": 961,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/app/(marketing)/docs/setup/page.tsx": {
            "lines": 42,
            "tokens": 471,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/app/(marketing)/docs/sdk/page.tsx": {
            "lines": 201,
            "tokens": 1735,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/app/(dashboard)/projects/[id]/page.tsx": {
            "lines": 288,
            "tokens": 2800,
            "sources": 1,
            "clones": 1,
            "duplicatedLines": 5,
            "duplicatedTokens": 83,
            "percentage": 1.74,
            "percentageTokens": 2.96,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/app/(dashboard)/projects/[id]/layout.tsx": {
            "lines": 104,
            "tokens": 959,
            "sources": 1,
            "clones": 1,
            "duplicatedLines": 5,
            "duplicatedTokens": 83,
            "percentage": 4.81,
            "percentageTokens": 8.65,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/app/(marketing)/terms/page.tsx": {
            "lines": 13,
            "tokens": 117,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/app/(marketing)/privacy/page.tsx": {
            "lines": 13,
            "tokens": 113,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/app/(marketing)/pricing/page.tsx": {
            "lines": 178,
            "tokens": 1885,
            "sources": 1,
            "clones": 1,
            "duplicatedLines": 7,
            "duplicatedTokens": 107,
            "percentage": 3.93,
            "percentageTokens": 5.68,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/app/(marketing)/docs/page.tsx": {
            "lines": 24,
            "tokens": 283,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/app/(dashboard)/settings/stripe-reconcile-client.tsx": {
            "lines": 72,
            "tokens": 717,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/app/(dashboard)/settings/page.tsx": {
            "lines": 120,
            "tokens": 1434,
            "sources": 1,
            "clones": 5,
            "duplicatedLines": 27,
            "duplicatedTokens": 399,
            "percentage": 22.5,
            "percentageTokens": 27.82,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/app/(dashboard)/projects/page.tsx": {
            "lines": 86,
            "tokens": 897,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/components/marketing/what-you-get.tsx": {
            "lines": 165,
            "tokens": 1095,
            "sources": 1,
            "clones": 11,
            "duplicatedLines": 137,
            "duplicatedTokens": 807,
            "percentage": 83.03,
            "percentageTokens": 73.7,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/components/marketing/set-and-forget.tsx": {
            "lines": 54,
            "tokens": 380,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/components/marketing/pricing-card.tsx": {
            "lines": 140,
            "tokens": 1236,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/components/marketing/navbar.tsx": {
            "lines": 73,
            "tokens": 503,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/components/marketing/how-it-works.tsx": {
            "lines": 169,
            "tokens": 1181,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/components/marketing/hero.tsx": {
            "lines": 85,
            "tokens": 694,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/components/marketing/footer.tsx": {
            "lines": 58,
            "tokens": 399,
            "sources": 1,
            "clones": 1,
            "duplicatedLines": 8,
            "duplicatedTokens": 61,
            "percentage": 13.79,
            "percentageTokens": 15.29,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/components/marketing/features.tsx": {
            "lines": 70,
            "tokens": 555,
            "sources": 1,
            "clones": 1,
            "duplicatedLines": 17,
            "duplicatedTokens": 127,
            "percentage": 24.29,
            "percentageTokens": 22.88,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/components/dashboard/user-dropdown.tsx": {
            "lines": 110,
            "tokens": 1010,
            "sources": 1,
            "clones": 3,
            "duplicatedLines": 24,
            "duplicatedTokens": 249,
            "percentage": 21.82,
            "percentageTokens": 24.65,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/components/dashboard/top-list.tsx": {
            "lines": 71,
            "tokens": 613,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/components/dashboard/status-badge.tsx": {
            "lines": 108,
            "tokens": 986,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/components/dashboard/stat-card.tsx": {
            "lines": 31,
            "tokens": 400,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/components/dashboard/skeleton.tsx": {
            "lines": 79,
            "tokens": 683,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/components/dashboard/sidebar.tsx": {
            "lines": 131,
            "tokens": 939,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/components/dashboard/sessions-chart.tsx": {
            "lines": 25,
            "tokens": 309,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/components/dashboard/quota-display.tsx": {
            "lines": 82,
            "tokens": 667,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/components/dashboard/project-card.tsx": {
            "lines": 48,
            "tokens": 546,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/components/dashboard/page-views-chart.tsx": {
            "lines": 56,
            "tokens": 540,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/components/dashboard/onboarding-checklist.tsx": {
            "lines": 131,
            "tokens": 1075,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/components/dashboard/mobile-tab-bar.tsx": {
            "lines": 106,
            "tokens": 718,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/components/dashboard/live-event.tsx": {
            "lines": 27,
            "tokens": 271,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/components/dashboard/header.tsx": {
            "lines": 44,
            "tokens": 386,
            "sources": 1,
            "clones": 2,
            "duplicatedLines": 14,
            "duplicatedTokens": 138,
            "percentage": 31.82,
            "percentageTokens": 35.75,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/app/login/page.tsx": {
            "lines": 99,
            "tokens": 790,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/app/dashboard/page.tsx": {
            "lines": 4,
            "tokens": 33,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/app/(marketing)/page.tsx": {
            "lines": 55,
            "tokens": 360,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/app/(marketing)/layout.tsx": {
            "lines": 24,
            "tokens": 230,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/app/(dashboard)/layout.tsx": {
            "lines": 46,
            "tokens": 371,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/lib/providers.tsx": {
            "lines": 9,
            "tokens": 106,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/app/layout.tsx": {
            "lines": 45,
            "tokens": 370,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/events/app/layout.tsx": {
            "lines": 12,
            "tokens": 100,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          }
        },
        "total": {
          "lines": 3686,
          "tokens": 33138,
          "sources": 46,
          "clones": 15,
          "duplicatedLines": 141,
          "duplicatedTokens": 1308,
          "percentage": 3.83,
          "percentageTokens": 3.95,
          "newDuplicatedLines": 0,
          "newClones": 0
        }
      },
      "javascript": {
        "sources": {
          "packages/sdk/src/react/app-router.tsx": {
            "lines": 0,
            "tokens": 3,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/app/(dashboard)/projects/[id]/sessions/page.tsx": {
            "lines": 32,
            "tokens": 357,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/app/(dashboard)/projects/[id]/overview/page.tsx": {
            "lines": 61,
            "tokens": 712,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/app/(dashboard)/projects/[id]/live/page.tsx": {
            "lines": 16,
            "tokens": 239,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/app/(marketing)/docs/setup/page.tsx": {
            "lines": 0,
            "tokens": 3,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/app/(dashboard)/projects/[id]/page.tsx": {
            "lines": 220,
            "tokens": 2295,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/app/(dashboard)/projects/[id]/layout.tsx": {
            "lines": 19,
            "tokens": 122,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/app/(marketing)/pricing/page.tsx": {
            "lines": 19,
            "tokens": 195,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/app/(dashboard)/projects/page.tsx": {
            "lines": 42,
            "tokens": 499,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/components/marketing/what-you-get.tsx": {
            "lines": 0,
            "tokens": 5,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/components/marketing/set-and-forget.tsx": {
            "lines": 0,
            "tokens": 3,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/components/marketing/pricing-card.tsx": {
            "lines": 130,
            "tokens": 1166,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/components/marketing/navbar.tsx": {
            "lines": 19,
            "tokens": 125,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/components/marketing/how-it-works.tsx": {
            "lines": 35,
            "tokens": 298,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/components/marketing/hero.tsx": {
            "lines": 41,
            "tokens": 320,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/components/marketing/footer.tsx": {
            "lines": 0,
            "tokens": 3,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/components/marketing/features.tsx": {
            "lines": 0,
            "tokens": 5,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/components/dashboard/user-dropdown.tsx": {
            "lines": 19,
            "tokens": 182,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/components/dashboard/top-list.tsx": {
            "lines": 46,
            "tokens": 404,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/components/dashboard/status-badge.tsx": {
            "lines": 98,
            "tokens": 912,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/components/dashboard/stat-card.tsx": {
            "lines": 2,
            "tokens": 21,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/components/dashboard/skeleton.tsx": {
            "lines": 4,
            "tokens": 21,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/components/dashboard/sidebar.tsx": {
            "lines": 114,
            "tokens": 805,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/components/dashboard/sessions-chart.tsx": {
            "lines": 3,
            "tokens": 56,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/components/dashboard/project-card.tsx": {
            "lines": 18,
            "tokens": 205,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/components/dashboard/page-views-chart.tsx": {
            "lines": 36,
            "tokens": 349,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/components/dashboard/onboarding-checklist.tsx": {
            "lines": 95,
            "tokens": 793,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/components/dashboard/mobile-tab-bar.tsx": {
            "lines": 87,
            "tokens": 572,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/components/dashboard/live-event.tsx": {
            "lines": 3,
            "tokens": 22,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/components/dashboard/header.tsx": {
            "lines": 0,
            "tokens": 13,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/app/login/page.tsx": {
            "lines": 0,
            "tokens": 9,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/app/(marketing)/page.tsx": {
            "lines": 24,
            "tokens": 175,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/app/(marketing)/layout.tsx": {
            "lines": 2,
            "tokens": 32,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/app/(dashboard)/layout.tsx": {
            "lines": 0,
            "tokens": 11,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/scripts/playwright-test.mjs": {
            "lines": 71,
            "tokens": 799,
            "sources": 1,
            "clones": 1,
            "duplicatedLines": 25,
            "duplicatedTokens": 321,
            "percentage": 35.21,
            "percentageTokens": 40.18,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/scripts/playwright-install.mjs": {
            "lines": 69,
            "tokens": 816,
            "sources": 1,
            "clones": 1,
            "duplicatedLines": 25,
            "duplicatedTokens": 321,
            "percentage": 36.23,
            "percentageTokens": 39.34,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/lib/providers.tsx": {
            "lines": 0,
            "tokens": 3,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/app/layout.tsx": {
            "lines": 0,
            "tokens": 9,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/tailwind.config.js": {
            "lines": 106,
            "tokens": 781,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/postcss.config.js": {
            "lines": 5,
            "tokens": 33,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/next.config.js": {
            "lines": 26,
            "tokens": 198,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/events/next.config.js": {
            "lines": 5,
            "tokens": 28,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          }
        },
        "total": {
          "lines": 1467,
          "tokens": 13599,
          "sources": 42,
          "clones": 1,
          "duplicatedLines": 25,
          "duplicatedTokens": 321,
          "percentage": 1.7,
          "percentageTokens": 2.36,
          "newDuplicatedLines": 0,
          "newClones": 0
        }
      },
      "typescript": {
        "sources": {
          "packages/sdk/test/visitor.test.ts": {
            "lines": 199,
            "tokens": 1700,
            "sources": 1,
            "clones": 4,
            "duplicatedLines": 71,
            "duplicatedTokens": 693,
            "percentage": 35.68,
            "percentageTokens": 40.76,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "packages/sdk/test/utm.test.ts": {
            "lines": 113,
            "tokens": 899,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "packages/sdk/test/types.test.ts": {
            "lines": 65,
            "tokens": 655,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "packages/sdk/test/tracker.test.ts": {
            "lines": 92,
            "tokens": 778,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "packages/sdk/test/tracker-v2-integration.test.ts": {
            "lines": 225,
            "tokens": 1953,
            "sources": 1,
            "clones": 4,
            "duplicatedLines": 48,
            "duplicatedTokens": 404,
            "percentage": 21.33,
            "percentageTokens": 20.69,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "packages/sdk/test/session.test.ts": {
            "lines": 97,
            "tokens": 841,
            "sources": 1,
            "clones": 1,
            "duplicatedLines": 18,
            "duplicatedTokens": 182,
            "percentage": 18.56,
            "percentageTokens": 21.64,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "packages/sdk/test/scroll.test.ts": {
            "lines": 222,
            "tokens": 1700,
            "sources": 1,
            "clones": 2,
            "duplicatedLines": 22,
            "duplicatedTokens": 240,
            "percentage": 9.91,
            "percentageTokens": 14.12,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "packages/sdk/test/readme.test.ts": {
            "lines": 22,
            "tokens": 250,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "packages/sdk/test/publish-config.test.ts": {
            "lines": 18,
            "tokens": 227,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "packages/sdk/test/public-api.test.ts": {
            "lines": 133,
            "tokens": 1387,
            "sources": 1,
            "clones": 3,
            "duplicatedLines": 35,
            "duplicatedTokens": 379,
            "percentage": 26.32,
            "percentageTokens": 27.33,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "packages/sdk/test/pages-router.test.ts": {
            "lines": 23,
            "tokens": 266,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "packages/sdk/test/package-init.test.ts": {
            "lines": 35,
            "tokens": 353,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "packages/sdk/test/engagement.test.ts": {
            "lines": 233,
            "tokens": 1945,
            "sources": 1,
            "clones": 3,
            "duplicatedLines": 28,
            "duplicatedTokens": 330,
            "percentage": 12.02,
            "percentageTokens": 16.97,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "packages/sdk/test/cta.test.ts": {
            "lines": 278,
            "tokens": 2542,
            "sources": 1,
            "clones": 1,
            "duplicatedLines": 6,
            "duplicatedTokens": 90,
            "percentage": 2.16,
            "percentageTokens": 3.54,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "packages/sdk/test/app-router.test.ts": {
            "lines": 24,
            "tokens": 278,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "packages/sdk/src/visitor.ts": {
            "lines": 53,
            "tokens": 417,
            "sources": 1,
            "clones": 1,
            "duplicatedLines": 9,
            "duplicatedTokens": 107,
            "percentage": 16.98,
            "percentageTokens": 25.66,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "packages/sdk/src/utm.ts": {
            "lines": 36,
            "tokens": 250,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "packages/sdk/src/types.ts": {
            "lines": 30,
            "tokens": 217,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "packages/sdk/src/tracker.ts": {
            "lines": 75,
            "tokens": 622,
            "sources": 1,
            "clones": 2,
            "duplicatedLines": 26,
            "duplicatedTokens": 230,
            "percentage": 34.67,
            "percentageTokens": 36.98,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "packages/sdk/src/session.ts": {
            "lines": 71,
            "tokens": 661,
            "sources": 1,
            "clones": 1,
            "duplicatedLines": 9,
            "duplicatedTokens": 107,
            "percentage": 12.68,
            "percentageTokens": 16.19,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "packages/sdk/src/scroll.ts": {
            "lines": 65,
            "tokens": 487,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "packages/sdk/src/index.ts": {
            "lines": 6,
            "tokens": 70,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "packages/sdk/src/engagement.ts": {
            "lines": 92,
            "tokens": 719,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "packages/sdk/src/cta.ts": {
            "lines": 131,
            "tokens": 1004,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "packages/sdk/src/core.ts": {
            "lines": 213,
            "tokens": 1684,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "packages/sdk/tsup.config.ts": {
            "lines": 11,
            "tokens": 101,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/app/api/projects/[id]/analytics/sessions/route.ts": {
            "lines": 102,
            "tokens": 1110,
            "sources": 1,
            "clones": 6,
            "duplicatedLines": 92,
            "duplicatedTokens": 1267,
            "percentage": 90.2,
            "percentageTokens": 114.14,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/app/api/projects/[id]/analytics/overview/route.ts": {
            "lines": 238,
            "tokens": 2016,
            "sources": 1,
            "clones": 4,
            "duplicatedLines": 65,
            "duplicatedTokens": 750,
            "percentage": 27.31,
            "percentageTokens": 37.2,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/app/api/projects/[id]/analytics/live/route.ts": {
            "lines": 113,
            "tokens": 1221,
            "sources": 1,
            "clones": 2,
            "duplicatedLines": 33,
            "duplicatedTokens": 403,
            "percentage": 29.2,
            "percentageTokens": 33.01,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/app/api/projects/[id]/regenerate/route.ts": {
            "lines": 60,
            "tokens": 795,
            "sources": 1,
            "clones": 1,
            "duplicatedLines": 5,
            "duplicatedTokens": 85,
            "percentage": 8.33,
            "percentageTokens": 10.69,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/app/api/auth/github/callback/route.ts": {
            "lines": 67,
            "tokens": 724,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/app/api/webhooks/stripe/route.ts": {
            "lines": 214,
            "tokens": 2396,
            "sources": 1,
            "clones": 1,
            "duplicatedLines": 9,
            "duplicatedTokens": 159,
            "percentage": 4.21,
            "percentageTokens": 6.64,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/app/api/webhooks/github/route.ts": {
            "lines": 53,
            "tokens": 554,
            "sources": 1,
            "clones": 1,
            "duplicatedLines": 11,
            "duplicatedTokens": 85,
            "percentage": 20.75,
            "percentageTokens": 15.34,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/app/api/stripe/reconcile/route.ts": {
            "lines": 126,
            "tokens": 1566,
            "sources": 1,
            "clones": 3,
            "duplicatedLines": 27,
            "duplicatedTokens": 331,
            "percentage": 21.43,
            "percentageTokens": 21.14,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/app/api/stripe/portal/route.ts": {
            "lines": 49,
            "tokens": 618,
            "sources": 1,
            "clones": 2,
            "duplicatedLines": 18,
            "duplicatedTokens": 177,
            "percentage": 36.73,
            "percentageTokens": 28.64,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/app/api/stripe/checkout/route.ts": {
            "lines": 116,
            "tokens": 1414,
            "sources": 1,
            "clones": 2,
            "duplicatedLines": 18,
            "duplicatedTokens": 179,
            "percentage": 15.52,
            "percentageTokens": 12.66,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/app/api/projects/[id]/route.ts": {
            "lines": 130,
            "tokens": 1327,
            "sources": 1,
            "clones": 2,
            "duplicatedLines": 26,
            "duplicatedTokens": 361,
            "percentage": 20,
            "percentageTokens": 27.2,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/app/api/github/callback/route.ts": {
            "lines": 30,
            "tokens": 355,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/app/api/auth/logout/route.ts": {
            "lines": 14,
            "tokens": 145,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/app/api/auth/github/route.ts": {
            "lines": 12,
            "tokens": 137,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/app/api/auth/e2e-login/route.ts": {
            "lines": 37,
            "tokens": 395,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/lib/github/templates/paths.ts": {
            "lines": 30,
            "tokens": 402,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/lib/github/templates/pages-router.ts": {
            "lines": 480,
            "tokens": 94,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/lib/github/templates/insert-analytics.ts": {
            "lines": 69,
            "tokens": 873,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/lib/github/templates/app-router.ts": {
            "lines": 489,
            "tokens": 94,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/lib/github/handlers/push.ts": {
            "lines": 62,
            "tokens": 728,
            "sources": 1,
            "clones": 1,
            "duplicatedLines": 15,
            "duplicatedTokens": 174,
            "percentage": 24.19,
            "percentageTokens": 23.9,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/lib/github/handlers/pull-request.ts": {
            "lines": 25,
            "tokens": 321,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/lib/github/handlers/installation.ts": {
            "lines": 101,
            "tokens": 1097,
            "sources": 1,
            "clones": 5,
            "duplicatedLines": 51,
            "duplicatedTokens": 546,
            "percentage": 50.5,
            "percentageTokens": 49.77,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/lib/db/queries/users.ts": {
            "lines": 65,
            "tokens": 563,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/lib/db/queries/regenerate-requests.ts": {
            "lines": 23,
            "tokens": 285,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/lib/db/queries/projects.ts": {
            "lines": 104,
            "tokens": 1154,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/lib/db/queries/github-tokens.ts": {
            "lines": 106,
            "tokens": 1016,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/app/api/projects/route.ts": {
            "lines": 103,
            "tokens": 1066,
            "sources": 1,
            "clones": 1,
            "duplicatedLines": 15,
            "duplicatedTokens": 168,
            "percentage": 14.56,
            "percentageTokens": 15.76,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/events/app/v1/track/route.ts": {
            "lines": 96,
            "tokens": 1148,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/lib/tinybird/client.ts": {
            "lines": 75,
            "tokens": 982,
            "sources": 1,
            "clones": 3,
            "duplicatedLines": 35,
            "duplicatedTokens": 464,
            "percentage": 46.67,
            "percentageTokens": 47.25,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/lib/stripe/plans.ts": {
            "lines": 8,
            "tokens": 120,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/lib/stripe/constants.ts": {
            "lines": 21,
            "tokens": 221,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/lib/stripe/client.ts": {
            "lines": 15,
            "tokens": 114,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/lib/hooks/use-projects.ts": {
            "lines": 48,
            "tokens": 509,
            "sources": 1,
            "clones": 3,
            "duplicatedLines": 32,
            "duplicatedTokens": 432,
            "percentage": 66.67,
            "percentageTokens": 84.87,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/lib/hooks/use-project.ts": {
            "lines": 59,
            "tokens": 698,
            "sources": 1,
            "clones": 2,
            "duplicatedLines": 20,
            "duplicatedTokens": 264,
            "percentage": 33.9,
            "percentageTokens": 37.82,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/lib/hooks/use-live-feed.ts": {
            "lines": 45,
            "tokens": 499,
            "sources": 1,
            "clones": 1,
            "duplicatedLines": 12,
            "duplicatedTokens": 168,
            "percentage": 26.67,
            "percentageTokens": 33.67,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/lib/github/webhook-verify.ts": {
            "lines": 20,
            "tokens": 241,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/lib/github/pr-generator.ts": {
            "lines": 289,
            "tokens": 3147,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/lib/github/generate.ts": {
            "lines": 112,
            "tokens": 1212,
            "sources": 1,
            "clones": 1,
            "duplicatedLines": 16,
            "duplicatedTokens": 179,
            "percentage": 14.29,
            "percentageTokens": 14.77,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/lib/github/detection.ts": {
            "lines": 242,
            "tokens": 2340,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/lib/github/detect-framework.ts": {
            "lines": 80,
            "tokens": 557,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/lib/github/app.ts": {
            "lines": 129,
            "tokens": 1402,
            "sources": 1,
            "clones": 1,
            "duplicatedLines": 11,
            "duplicatedTokens": 85,
            "percentage": 8.53,
            "percentageTokens": 6.06,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/lib/github/analyze.ts": {
            "lines": 70,
            "tokens": 705,
            "sources": 1,
            "clones": 1,
            "duplicatedLines": 16,
            "duplicatedTokens": 179,
            "percentage": 22.86,
            "percentageTokens": 25.39,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/lib/env/read-required-env.ts": {
            "lines": 7,
            "tokens": 81,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/lib/db/schema.ts": {
            "lines": 164,
            "tokens": 1946,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/lib/db/drizzle-env.ts": {
            "lines": 30,
            "tokens": 323,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/lib/db/client.ts": {
            "lines": 26,
            "tokens": 293,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/lib/auth/session.ts": {
            "lines": 49,
            "tokens": 509,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/lib/auth/github-oauth.ts": {
            "lines": 106,
            "tokens": 918,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/lib/auth/get-user.ts": {
            "lines": 36,
            "tokens": 473,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/lib/auth/cookies.ts": {
            "lines": 117,
            "tokens": 952,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/types/github.ts": {
            "lines": 20,
            "tokens": 131,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/types/database.ts": {
            "lines": 20,
            "tokens": 243,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/tests/users-queries.test.ts": {
            "lines": 151,
            "tokens": 1651,
            "sources": 1,
            "clones": 7,
            "duplicatedLines": 66,
            "duplicatedTokens": 807,
            "percentage": 43.71,
            "percentageTokens": 48.88,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/tests/user-dropdown.test.ts": {
            "lines": 70,
            "tokens": 841,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/tests/tinybird-top-referrers.test.ts": {
            "lines": 20,
            "tokens": 227,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/tests/tinybird-top-pages.test.ts": {
            "lines": 21,
            "tokens": 239,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/tests/tinybird-sql-client.test.ts": {
            "lines": 73,
            "tokens": 734,
            "sources": 1,
            "clones": 2,
            "duplicatedLines": 22,
            "duplicatedTokens": 228,
            "percentage": 30.14,
            "percentageTokens": 31.06,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/tests/tinybird-page-views-timeseries.test.ts": {
            "lines": 22,
            "tokens": 251,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/tests/tinybird-live-feed.test.ts": {
            "lines": 19,
            "tokens": 215,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/tests/tinybird-events-datasource.test.ts": {
            "lines": 25,
            "tokens": 276,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/tests/tinybird-daily-aggregates.test.ts": {
            "lines": 38,
            "tokens": 421,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/tests/tinybird-client.test.ts": {
            "lines": 300,
            "tokens": 3253,
            "sources": 1,
            "clones": 16,
            "duplicatedLines": 152,
            "duplicatedTokens": 1696,
            "percentage": 50.67,
            "percentageTokens": 52.14,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/tests/stripe-webhook-handlers.test.ts": {
            "lines": 627,
            "tokens": 5710,
            "sources": 1,
            "clones": 59,
            "duplicatedLines": 729,
            "duplicatedTokens": 6893,
            "percentage": 116.27,
            "percentageTokens": 120.72,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/tests/stripe-webhook-api.test.ts": {
            "lines": 115,
            "tokens": 1093,
            "sources": 1,
            "clones": 3,
            "duplicatedLines": 35,
            "duplicatedTokens": 458,
            "percentage": 30.43,
            "percentageTokens": 41.9,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/tests/stripe-reconcile-api.test.ts": {
            "lines": 150,
            "tokens": 1768,
            "sources": 1,
            "clones": 28,
            "duplicatedLines": 287,
            "duplicatedTokens": 4060,
            "percentage": 191.33,
            "percentageTokens": 229.64,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/tests/stripe-portal-api.test.ts": {
            "lines": 88,
            "tokens": 1064,
            "sources": 1,
            "clones": 5,
            "duplicatedLines": 66,
            "duplicatedTokens": 743,
            "percentage": 75,
            "percentageTokens": 69.83,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/tests/stripe-plans.test.ts": {
            "lines": 20,
            "tokens": 240,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/tests/stripe-migration.test.ts": {
            "lines": 21,
            "tokens": 226,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/tests/stripe-env-example.test.ts": {
            "lines": 20,
            "tokens": 197,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/tests/stripe-client.test.ts": {
            "lines": 7,
            "tokens": 85,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/tests/stripe-checkout-api.test.ts": {
            "lines": 185,
            "tokens": 2297,
            "sources": 1,
            "clones": 22,
            "duplicatedLines": 239,
            "duplicatedTokens": 2941,
            "percentage": 129.19,
            "percentageTokens": 128.04,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/tests/stripe-checkout-additional.test.ts": {
            "lines": 396,
            "tokens": 5366,
            "sources": 1,
            "clones": 37,
            "duplicatedLines": 385,
            "duplicatedTokens": 5508,
            "percentage": 97.22,
            "percentageTokens": 102.65,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/tests/settings-page.test.ts": {
            "lines": 65,
            "tokens": 678,
            "sources": 1,
            "clones": 5,
            "duplicatedLines": 64,
            "duplicatedTokens": 682,
            "percentage": 98.46,
            "percentageTokens": 100.59,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/tests/sessions-page.test.ts": {
            "lines": 34,
            "tokens": 348,
            "sources": 1,
            "clones": 1,
            "duplicatedLines": 10,
            "duplicatedTokens": 92,
            "percentage": 29.41,
            "percentageTokens": 26.44,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/tests/session.test.ts": {
            "lines": 222,
            "tokens": 2350,
            "sources": 1,
            "clones": 12,
            "duplicatedLines": 94,
            "duplicatedTokens": 1329,
            "percentage": 42.34,
            "percentageTokens": 56.55,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/tests/schema.test.ts": {
            "lines": 88,
            "tokens": 1531,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/tests/root-layout-metadata.test.ts": {
            "lines": 23,
            "tokens": 252,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/tests/regenerate-requests-queries.test.ts": {
            "lines": 111,
            "tokens": 1240,
            "sources": 1,
            "clones": 9,
            "duplicatedLines": 98,
            "duplicatedTokens": 1182,
            "percentage": 88.29,
            "percentageTokens": 95.32,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/tests/regenerate-api.test.ts": {
            "lines": 205,
            "tokens": 2389,
            "sources": 1,
            "clones": 27,
            "duplicatedLines": 313,
            "duplicatedTokens": 3541,
            "percentage": 152.68,
            "percentageTokens": 148.22,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/tests/quota-display.test.ts": {
            "lines": 23,
            "tokens": 267,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/tests/projects-queries.test.ts": {
            "lines": 40,
            "tokens": 464,
            "sources": 1,
            "clones": 2,
            "duplicatedLines": 19,
            "duplicatedTokens": 198,
            "percentage": 47.5,
            "percentageTokens": 42.67,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/tests/projects-list-page.test.ts": {
            "lines": 56,
            "tokens": 464,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/tests/projects-list-api.test.ts": {
            "lines": 129,
            "tokens": 1318,
            "sources": 1,
            "clones": 8,
            "duplicatedLines": 132,
            "duplicatedTokens": 1443,
            "percentage": 102.33,
            "percentageTokens": 109.48,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/tests/project-polling.test.ts": {
            "lines": 14,
            "tokens": 145,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/tests/project-layout.test.ts": {
            "lines": 223,
            "tokens": 1866,
            "sources": 1,
            "clones": 10,
            "duplicatedLines": 184,
            "duplicatedTokens": 1604,
            "percentage": 82.51,
            "percentageTokens": 85.96,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/tests/project-detail-page.test.ts": {
            "lines": 43,
            "tokens": 381,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/tests/project-detail-api.test.ts": {
            "lines": 168,
            "tokens": 1816,
            "sources": 1,
            "clones": 10,
            "duplicatedLines": 162,
            "duplicatedTokens": 1784,
            "percentage": 96.43,
            "percentageTokens": 98.24,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/tests/pr-generator.test.ts": {
            "lines": 269,
            "tokens": 2866,
            "sources": 1,
            "clones": 10,
            "duplicatedLines": 186,
            "duplicatedTokens": 1884,
            "percentage": 69.14,
            "percentageTokens": 65.74,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/tests/overview-page.test.ts": {
            "lines": 34,
            "tokens": 425,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/tests/migrations.test.ts": {
            "lines": 44,
            "tokens": 532,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/tests/middleware.test.ts": {
            "lines": 46,
            "tokens": 525,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/tests/marketing-pricing-page.test.ts": {
            "lines": 94,
            "tokens": 1028,
            "sources": 1,
            "clones": 8,
            "duplicatedLines": 84,
            "duplicatedTokens": 1004,
            "percentage": 89.36,
            "percentageTokens": 97.67,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/tests/marketing-legal-pages.test.ts": {
            "lines": 24,
            "tokens": 281,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/tests/marketing-landing-page.test.ts": {
            "lines": 151,
            "tokens": 1659,
            "sources": 1,
            "clones": 1,
            "duplicatedLines": 11,
            "duplicatedTokens": 105,
            "percentage": 7.28,
            "percentageTokens": 6.33,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/tests/marketing-footer-links.test.ts": {
            "lines": 29,
            "tokens": 280,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/tests/marketing-docs-pages.test.ts": {
            "lines": 38,
            "tokens": 426,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/tests/marketing-copy.test.ts": {
            "lines": 27,
            "tokens": 211,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/tests/logout-no-cookie.test.ts": {
            "lines": 28,
            "tokens": 343,
            "sources": 1,
            "clones": 2,
            "duplicatedLines": 19,
            "duplicatedTokens": 218,
            "percentage": 67.86,
            "percentageTokens": 63.56,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/tests/logout-api.test.ts": {
            "lines": 37,
            "tokens": 416,
            "sources": 1,
            "clones": 2,
            "duplicatedLines": 19,
            "duplicatedTokens": 218,
            "percentage": 51.35,
            "percentageTokens": 52.4,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/tests/login-page-oauth.test.ts": {
            "lines": 29,
            "tokens": 337,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/tests/live-feed-page.test.ts": {
            "lines": 55,
            "tokens": 502,
            "sources": 1,
            "clones": 2,
            "duplicatedLines": 18,
            "duplicatedTokens": 158,
            "percentage": 32.73,
            "percentageTokens": 31.47,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/tests/live-event.test.ts": {
            "lines": 27,
            "tokens": 221,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/tests/link-github-users-script.test.ts": {
            "lines": 62,
            "tokens": 722,
            "sources": 1,
            "clones": 1,
            "duplicatedLines": 13,
            "duplicatedTokens": 126,
            "percentage": 20.97,
            "percentageTokens": 17.45,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/tests/github-webhooks-api.test.ts": {
            "lines": 243,
            "tokens": 2447,
            "sources": 1,
            "clones": 14,
            "duplicatedLines": 152,
            "duplicatedTokens": 1518,
            "percentage": 62.55,
            "percentageTokens": 62.04,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/tests/github-webhook-push-handler.test.ts": {
            "lines": 71,
            "tokens": 758,
            "sources": 1,
            "clones": 1,
            "duplicatedLines": 11,
            "duplicatedTokens": 89,
            "percentage": 15.49,
            "percentageTokens": 11.74,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/tests/github-webhook-pull-request-handler.test.ts": {
            "lines": 76,
            "tokens": 770,
            "sources": 1,
            "clones": 3,
            "duplicatedLines": 45,
            "duplicatedTokens": 498,
            "percentage": 59.21,
            "percentageTokens": 64.68,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/tests/github-webhook-installation-handler.test.ts": {
            "lines": 182,
            "tokens": 1954,
            "sources": 1,
            "clones": 8,
            "duplicatedLines": 120,
            "duplicatedTokens": 1294,
            "percentage": 65.93,
            "percentageTokens": 66.22,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/tests/github-tokens.test.ts": {
            "lines": 207,
            "tokens": 2177,
            "sources": 1,
            "clones": 13,
            "duplicatedLines": 92,
            "duplicatedTokens": 1376,
            "percentage": 44.44,
            "percentageTokens": 63.21,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/tests/github-templates.test.ts": {
            "lines": 49,
            "tokens": 591,
            "sources": 1,
            "clones": 2,
            "duplicatedLines": 28,
            "duplicatedTokens": 324,
            "percentage": 57.14,
            "percentageTokens": 54.82,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/tests/github-oauth.test.ts": {
            "lines": 128,
            "tokens": 1387,
            "sources": 1,
            "clones": 6,
            "duplicatedLines": 40,
            "duplicatedTokens": 500,
            "percentage": 31.25,
            "percentageTokens": 36.05,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/tests/github-oauth-redirect.test.ts": {
            "lines": 79,
            "tokens": 967,
            "sources": 1,
            "clones": 1,
            "duplicatedLines": 10,
            "duplicatedTokens": 117,
            "percentage": 12.66,
            "percentageTokens": 12.1,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/tests/github-oauth-callback.test.ts": {
            "lines": 190,
            "tokens": 2207,
            "sources": 1,
            "clones": 12,
            "duplicatedLines": 117,
            "duplicatedTokens": 1315,
            "percentage": 61.58,
            "percentageTokens": 59.58,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/tests/github-insertion.test.ts": {
            "lines": 72,
            "tokens": 592,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/tests/github-generate.test.ts": {
            "lines": 394,
            "tokens": 3688,
            "sources": 1,
            "clones": 20,
            "duplicatedLines": 342,
            "duplicatedTokens": 3042,
            "percentage": 86.8,
            "percentageTokens": 82.48,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/tests/github-generate-events-url.test.ts": {
            "lines": 38,
            "tokens": 397,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/tests/github-detection.test.ts": {
            "lines": 152,
            "tokens": 1934,
            "sources": 1,
            "clones": 8,
            "duplicatedLines": 60,
            "duplicatedTokens": 944,
            "percentage": 39.47,
            "percentageTokens": 48.81,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/tests/github-callback-api.test.ts": {
            "lines": 107,
            "tokens": 1173,
            "sources": 1,
            "clones": 5,
            "duplicatedLines": 35,
            "duplicatedTokens": 422,
            "percentage": 32.71,
            "percentageTokens": 35.98,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/tests/github-app.test.ts": {
            "lines": 166,
            "tokens": 1787,
            "sources": 1,
            "clones": 6,
            "duplicatedLines": 48,
            "duplicatedTokens": 498,
            "percentage": 28.92,
            "percentageTokens": 27.87,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/tests/github-analyze.test.ts": {
            "lines": 117,
            "tokens": 1227,
            "sources": 1,
            "clones": 6,
            "duplicatedLines": 62,
            "duplicatedTokens": 658,
            "percentage": 52.99,
            "percentageTokens": 53.63,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/tests/get-user.test.ts": {
            "lines": 67,
            "tokens": 841,
            "sources": 1,
            "clones": 1,
            "duplicatedLines": 18,
            "duplicatedTokens": 171,
            "percentage": 26.87,
            "percentageTokens": 20.33,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/tests/events-track-route.test.ts": {
            "lines": 87,
            "tokens": 926,
            "sources": 1,
            "clones": 11,
            "duplicatedLines": 101,
            "duplicatedTokens": 1135,
            "percentage": 116.09,
            "percentageTokens": 122.57,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/tests/events-track-route-v2-schema.test.ts": {
            "lines": 172,
            "tokens": 1730,
            "sources": 1,
            "clones": 10,
            "duplicatedLines": 116,
            "duplicatedTokens": 1231,
            "percentage": 67.44,
            "percentageTokens": 71.16,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/tests/events-track-route-project-validation.test.ts": {
            "lines": 41,
            "tokens": 415,
            "sources": 1,
            "clones": 3,
            "duplicatedLines": 24,
            "duplicatedTokens": 245,
            "percentage": 58.54,
            "percentageTokens": 59.04,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/tests/events-track-route-cors.test.ts": {
            "lines": 51,
            "tokens": 514,
            "sources": 1,
            "clones": 2,
            "duplicatedLines": 25,
            "duplicatedTokens": 267,
            "percentage": 49.02,
            "percentageTokens": 51.95,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/tests/events-tinybird-client.test.ts": {
            "lines": 61,
            "tokens": 716,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/tests/events-project-cache.test.ts": {
            "lines": 22,
            "tokens": 290,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/tests/events-app-scaffold.test.ts": {
            "lines": 50,
            "tokens": 704,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/tests/env.test.ts": {
            "lines": 25,
            "tokens": 265,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/tests/e2e-login.test.ts": {
            "lines": 110,
            "tokens": 1244,
            "sources": 1,
            "clones": 7,
            "duplicatedLines": 87,
            "duplicatedTokens": 922,
            "percentage": 79.09,
            "percentageTokens": 74.12,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/tests/drizzle-env.test.ts": {
            "lines": 40,
            "tokens": 487,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/tests/detect-framework.test.ts": {
            "lines": 169,
            "tokens": 1784,
            "sources": 1,
            "clones": 12,
            "duplicatedLines": 154,
            "duplicatedTokens": 1722,
            "percentage": 91.12,
            "percentageTokens": 96.52,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/tests/design-system-tailwind.test.ts": {
            "lines": 55,
            "tokens": 515,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/tests/dashboard-shell.test.ts": {
            "lines": 95,
            "tokens": 1117,
            "sources": 1,
            "clones": 3,
            "duplicatedLines": 21,
            "duplicatedTokens": 270,
            "percentage": 22.11,
            "percentageTokens": 24.17,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/tests/dashboard-page.test.ts": {
            "lines": 20,
            "tokens": 209,
            "sources": 1,
            "clones": 1,
            "duplicatedLines": 7,
            "duplicatedTokens": 82,
            "percentage": 35,
            "percentageTokens": 39.23,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/tests/dashboard-header.test.ts": {
            "lines": 24,
            "tokens": 245,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/tests/dashboard-data-fetching.test.ts": {
            "lines": 42,
            "tokens": 461,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/tests/app-url.test.ts": {
            "lines": 25,
            "tokens": 275,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/tests/analytics-sessions-api.test.ts": {
            "lines": 96,
            "tokens": 1148,
            "sources": 1,
            "clones": 12,
            "duplicatedLines": 170,
            "duplicatedTokens": 2016,
            "percentage": 177.08,
            "percentageTokens": 175.61,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/tests/analytics-overview-api.test.ts": {
            "lines": 123,
            "tokens": 1397,
            "sources": 1,
            "clones": 6,
            "duplicatedLines": 84,
            "duplicatedTokens": 1016,
            "percentage": 68.29,
            "percentageTokens": 72.73,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/tests/analytics-live-feed-api.test.ts": {
            "lines": 111,
            "tokens": 1187,
            "sources": 1,
            "clones": 6,
            "duplicatedLines": 78,
            "duplicatedTokens": 978,
            "percentage": 70.27,
            "percentageTokens": 82.39,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/scripts/link-github-users.ts": {
            "lines": 66,
            "tokens": 581,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/lib/env.ts": {
            "lines": 12,
            "tokens": 81,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/lib/app-url.ts": {
            "lines": 4,
            "tokens": 36,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/e2e/dashboard.spec.ts": {
            "lines": 43,
            "tokens": 440,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/e2e/auth.spec.ts": {
            "lines": 10,
            "tokens": 125,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/events/lib/tinybird.ts": {
            "lines": 105,
            "tokens": 1072,
            "sources": 1,
            "clones": 1,
            "duplicatedLines": 9,
            "duplicatedTokens": 82,
            "percentage": 8.57,
            "percentageTokens": 7.65,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/events/lib/project-cache.ts": {
            "lines": 64,
            "tokens": 711,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/vitest.config.ts": {
            "lines": 7,
            "tokens": 50,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/playwright.config.ts": {
            "lines": 39,
            "tokens": 366,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/next-env.d.ts": {
            "lines": 4,
            "tokens": 7,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/middleware.ts": {
            "lines": 22,
            "tokens": 243,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/drizzle.config.ts": {
            "lines": 20,
            "tokens": 150,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/events/next-env.d.ts": {
            "lines": 4,
            "tokens": 7,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          }
        },
        "total": {
          "lines": 16427,
          "tokens": 161068,
          "sources": 179,
          "clones": 267,
          "duplicatedLines": 3131,
          "duplicatedTokens": 35426,
          "percentage": 19.06,
          "percentageTokens": 21.99,
          "newDuplicatedLines": 0,
          "newClones": 0
        }
      },
      "json": {
        "sources": {
          "packages/sdk/tsconfig.json": {
            "lines": 9,
            "tokens": 68,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "packages/sdk/package.json": {
            "lines": 31,
            "tokens": 177,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/drizzle/migrations/meta/_journal.json": {
            "lines": 41,
            "tokens": 228,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/tsconfig.json": {
            "lines": 25,
            "tokens": 113,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/package.json": {
            "lines": 55,
            "tokens": 364,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/events/tsconfig.json": {
            "lines": 19,
            "tokens": 84,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/events/package.json": {
            "lines": 24,
            "tokens": 147,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          }
        },
        "total": {
          "lines": 204,
          "tokens": 1181,
          "sources": 7,
          "clones": 0,
          "duplicatedLines": 0,
          "duplicatedTokens": 0,
          "percentage": 0,
          "percentageTokens": 0,
          "newDuplicatedLines": 0,
          "newClones": 0
        }
      },
      "markdown": {
        "sources": {
          "packages/sdk/README.md": {
            "lines": 81,
            "tokens": 490,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "packages/sdk/CHANGELOG.md": {
            "lines": 0,
            "tokens": 4,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          }
        },
        "total": {
          "lines": 81,
          "tokens": 494,
          "sources": 2,
          "clones": 0,
          "duplicatedLines": 0,
          "duplicatedTokens": 0,
          "percentage": 0,
          "percentageTokens": 0,
          "newDuplicatedLines": 0,
          "newClones": 0
        }
      },
      "sql": {
        "sources": {
          "apps/web/drizzle/migrations/0005_drop_magic_links.sql": {
            "lines": 2,
            "tokens": 12,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/drizzle/migrations/0004_add_conversion_columns.sql": {
            "lines": 6,
            "tokens": 81,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/drizzle/migrations/0003_github_oauth.sql": {
            "lines": 5,
            "tokens": 54,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/drizzle/migrations/0002_stripe_billing.sql": {
            "lines": 9,
            "tokens": 101,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/drizzle/migrations/0001_regenerate_requests.sql": {
            "lines": 12,
            "tokens": 146,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "apps/web/drizzle/migrations/0000_initial.sql": {
            "lines": 159,
            "tokens": 1273,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          }
        },
        "total": {
          "lines": 193,
          "tokens": 1667,
          "sources": 6,
          "clones": 0,
          "duplicatedLines": 0,
          "duplicatedTokens": 0,
          "percentage": 0,
          "percentageTokens": 0,
          "newDuplicatedLines": 0,
          "newClones": 0
        }
      },
      "css": {
        "sources": {
          "apps/web/app/globals.css": {
            "lines": 51,
            "tokens": 289,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          }
        },
        "total": {
          "lines": 51,
          "tokens": 289,
          "sources": 1,
          "clones": 0,
          "duplicatedLines": 0,
          "duplicatedTokens": 0,
          "percentage": 0,
          "percentageTokens": 0,
          "newDuplicatedLines": 0,
          "newClones": 0
        }
      }
    },
    "total": {
      "lines": 22109,
      "tokens": 211436,
      "sources": 283,
      "clones": 283,
      "duplicatedLines": 3297,
      "duplicatedTokens": 37055,
      "percentage": 14.91,
      "percentageTokens": 17.53,
      "newDuplicatedLines": 0,
      "newClones": 0
    }
  },
  "duplicates": [
    {
      "format": "typescript",
      "lines": 21,
      "fragment": "let setCookieString = \"\";\n\n    Object.defineProperty(globalThis, \"document\", {\n      value: {\n        _cookie: \"\",\n        get cookie() {\n          return this._cookie;\n        },\n        set cookie(value: string) {\n          setCookieString = value;\n          const [pair] = value.split(\";\");\n          const [name, cookieValue] = pair.split(\"=\");\n          this._cookie = `${name}=${cookieValue}`;\n        },\n      },\n      configurable: true,\n    });\n\n    Object.defineProperty(globalThis, \"location\", {\n      value: {\n        protocol: \"http:\"",
      "tokens": 0,
      "firstFile": {
        "name": "packages/sdk/test/visitor.test.ts",
        "start": 126,
        "end": 146,
        "startLoc": {
          "line": 126,
          "column": 5,
          "position": 1118
        },
        "endLoc": {
          "line": 146,
          "column": 8,
          "position": 1295
        }
      },
      "secondFile": {
        "name": "packages/sdk/test/visitor.test.ts",
        "start": 87,
        "end": 107,
        "startLoc": {
          "line": 87,
          "column": 5,
          "position": 787
        },
        "endLoc": {
          "line": 107,
          "column": 9,
          "position": 964
        }
      }
    },
    {
      "format": "typescript",
      "lines": 11,
      "fragment": ", async () => {\n    const { init, trackPageView } = await import(\"../src/core\");\n\n    init({ projectId: \"proj_test\" });\n    await trackPageView();\n\n    const events = getPostedEvents();\n    const pageView = events.find((e: any) => e.event_type === \"page_view\");\n\n    expect(pageView).toBeDefined();\n    // cta_clicks should be present (empty string or JSON array)",
      "tokens": 0,
      "firstFile": {
        "name": "packages/sdk/test/tracker-v2-integration.test.ts",
        "start": 107,
        "end": 117,
        "startLoc": {
          "line": 107,
          "column": 44,
          "position": 929
        },
        "endLoc": {
          "line": 117,
          "column": 61,
          "position": 1041
        }
      },
      "secondFile": {
        "name": "packages/sdk/test/tracker-v2-integration.test.ts",
        "start": 93,
        "end": 103,
        "startLoc": {
          "line": 93,
          "column": 63,
          "position": 784
        },
        "endLoc": {
          "line": 103,
          "column": 7,
          "position": 896
        }
      }
    },
    {
      "format": "typescript",
      "lines": 15,
      "fragment": ",\n        removeEventListener: vi.fn(),\n      },\n      configurable: true,\n      writable: true,\n    });\n\n    Object.defineProperty(globalThis, \"navigator\", {\n      value: { doNotTrack: \"0\" },\n      configurable: true,\n      writable: true,\n    });\n  });\n\n  it",
      "tokens": 0,
      "firstFile": {
        "name": "packages/sdk/test/tracker-v2-integration.test.ts",
        "start": 189,
        "end": 203,
        "startLoc": {
          "line": 189,
          "column": 25,
          "position": 1635
        },
        "endLoc": {
          "line": 203,
          "column": 3,
          "position": 1725
        }
      },
      "secondFile": {
        "name": "packages/sdk/test/tracker-v2-integration.test.ts",
        "start": 49,
        "end": 63,
        "startLoc": {
          "line": 49,
          "column": 2,
          "position": 411
        },
        "endLoc": {
          "line": 63,
          "column": 10,
          "position": 501
        }
      }
    },
    {
      "format": "typescript",
      "lines": 19,
      "fragment": ";\n\n  Object.defineProperty(globalThis, \"document\", {\n    value: {\n      get cookie() {\n        return Array.from(jar.entries())\n          .map(([name, value]) => `${name}=${value}`)\n          .join(\"; \");\n      },\n      set cookie(value: string) {\n        const [pair] = value.split(\";\");\n        const [name, cookieValue] = pair.split(\"=\");\n        jar.set(name.trim(), (cookieValue ?? \"\").trim());\n      },\n    },\n    configurable: true,\n  });\n\n  return",
      "tokens": 0,
      "firstFile": {
        "name": "packages/sdk/test/session.test.ts",
        "start": 6,
        "end": 24,
        "startLoc": {
          "line": 6,
          "column": 2,
          "position": 63
        },
        "endLoc": {
          "line": 24,
          "column": 7,
          "position": 245
        }
      },
      "secondFile": {
        "name": "packages/sdk/test/visitor.test.ts",
        "start": 7,
        "end": 25,
        "startLoc": {
          "line": 7,
          "column": 5,
          "position": 100
        },
        "endLoc": {
          "line": 25,
          "column": 7,
          "position": 282
        }
      }
    },
    {
      "format": "typescript",
      "lines": 14,
      "fragment": "get cookie() {\n        return Array.from(jar.entries())\n          .map(([name, value]) => `${name}=${value}`)\n          .join(\"; \");\n      },\n      set cookie(value: string) {\n        const [pair] = value.split(\";\");\n        const [name, cookieValue] = pair.split(\"=\");\n        jar.set(name.trim(), (cookieValue ?? \"\").trim());\n      },\n    },\n    configurable: true,\n  });\n}",
      "tokens": 0,
      "firstFile": {
        "name": "packages/sdk/test/public-api.test.ts",
        "start": 18,
        "end": 31,
        "startLoc": {
          "line": 18,
          "column": 7,
          "position": 177
        },
        "endLoc": {
          "line": 31,
          "column": 2,
          "position": 334
        }
      },
      "secondFile": {
        "name": "packages/sdk/test/visitor.test.ts",
        "start": 11,
        "end": 25,
        "startLoc": {
          "line": 11,
          "column": 7,
          "position": 123
        },
        "endLoc": {
          "line": 25,
          "column": 7,
          "position": 282
        }
      }
    },
    {
      "format": "typescript",
      "lines": 12,
      "fragment": ");\n    Object.defineProperty(globalThis, \"navigator\", {\n      value: { doNotTrack: \"0\" },\n      configurable: true,\n    });\n\n    const fetchSpy = vi.fn(async () => new Response(null, { status: 204 }));\n    // @ts-expect-error test stub\n    globalThis.fetch = fetchSpy;\n\n    vi.spyOn(globalThis.crypto, \"randomUUID\").mockReturnValue(\n      \"bbbbbbbb-bbbb-4bbb-8bbb-bbbbbbbbbbbb\"",
      "tokens": 0,
      "firstFile": {
        "name": "packages/sdk/test/public-api.test.ts",
        "start": 81,
        "end": 92,
        "startLoc": {
          "line": 81,
          "column": 2,
          "position": 872
        },
        "endLoc": {
          "line": 92,
          "column": 39,
          "position": 983
        }
      },
      "secondFile": {
        "name": "packages/sdk/test/public-api.test.ts",
        "start": 55,
        "end": 66,
        "startLoc": {
          "line": 55,
          "column": 2,
          "position": 602
        },
        "endLoc": {
          "line": 66,
          "column": 39,
          "position": 713
        }
      }
    },
    {
      "format": "typescript",
      "lines": 12,
      "fragment": ") {\n        if (!handlers.has(type)) handlers.set(type, new Set());\n        handlers.get(type)!.add(handler);\n      },\n      removeEventListener(type: string, handler: EventListener) {\n        handlers.get(type)?.delete(handler);\n      },\n    },\n    configurable: true,\n  });\n\n  Object.defineProperty(globalThis, \"window\"",
      "tokens": 0,
      "firstFile": {
        "name": "packages/sdk/test/engagement.test.ts",
        "start": 11,
        "end": 22,
        "startLoc": {
          "line": 11,
          "column": 14,
          "position": 116
        },
        "endLoc": {
          "line": 22,
          "column": 9,
          "position": 228
        }
      },
      "secondFile": {
        "name": "packages/sdk/test/scroll.test.ts",
        "start": 20,
        "end": 31,
        "startLoc": {
          "line": 20,
          "column": 8,
          "position": 216
        },
        "endLoc": {
          "line": 31,
          "column": 11,
          "position": 328
        }
      }
    },
    {
      "format": "typescript",
      "lines": 12,
      "fragment": "addEventListener(type: string, handler: EventListener, options?: AddEventListenerOptions | boolean) {\n        if (!handlers.has(type)) handlers.set(type, new Set());\n        handlers.get(type)!.add(handler);\n      },\n      removeEventListener(type: string, handler: EventListener) {\n        handlers.get(type)?.delete(handler);\n      },\n    },\n    configurable: true,\n  });\n\n  return",
      "tokens": 0,
      "firstFile": {
        "name": "packages/sdk/test/engagement.test.ts",
        "start": 24,
        "end": 35,
        "startLoc": {
          "line": 24,
          "column": 7,
          "position": 240
        },
        "endLoc": {
          "line": 35,
          "column": 7,
          "position": 368
        }
      },
      "secondFile": {
        "name": "packages/sdk/test/scroll.test.ts",
        "start": 20,
        "end": 31,
        "startLoc": {
          "line": 20,
          "column": 7,
          "position": 193
        },
        "endLoc": {
          "line": 31,
          "column": 7,
          "position": 321
        }
      }
    },
    {
      "format": "typescript",
      "lines": 7,
      "fragment": ");\n\n  Object.defineProperty(globalThis, \"window\", {\n    value: {\n      addEventListener(type: string, handler: EventListener, options?: AddEventListenerOptions | boolean) {\n        if (!handlers.has(type)) handlers.set(type, new Set());\n        handlers.get(type)!.add({",
      "tokens": 0,
      "firstFile": {
        "name": "packages/sdk/test/cta.test.ts",
        "start": 11,
        "end": 17,
        "startLoc": {
          "line": 11,
          "column": 2,
          "position": 101
        },
        "endLoc": {
          "line": 17,
          "column": 2,
          "position": 191
        }
      },
      "secondFile": {
        "name": "packages/sdk/test/engagement.test.ts",
        "start": 20,
        "end": 22,
        "startLoc": {
          "line": 20,
          "column": 2,
          "position": 216
        },
        "endLoc": {
          "line": 22,
          "column": 8,
          "position": 259
        }
      }
    },
    {
      "format": "typescript",
      "lines": 14,
      "fragment": ": string;\n  userId?: string;\n}): AnalyticsEvent {\n  const url =\n    typeof window === \"undefined\" ? undefined : window.location.href || undefined;\n  const referrer =\n    typeof document === \"undefined\"\n      ? undefined\n      : document.referrer || undefined;\n\n  return {\n    project_id: options.projectId,\n    session_id: options.sessionId,\n    event_type: \"session_start\"",
      "tokens": 0,
      "firstFile": {
        "name": "packages/sdk/src/tracker.ts",
        "start": 57,
        "end": 70,
        "startLoc": {
          "line": 57,
          "column": 10,
          "position": 468
        },
        "endLoc": {
          "line": 70,
          "column": 16,
          "position": 583
        }
      },
      "secondFile": {
        "name": "packages/sdk/src/tracker.ts",
        "start": 33,
        "end": 46,
        "startLoc": {
          "line": 33,
          "column": 5,
          "position": 282
        },
        "endLoc": {
          "line": 46,
          "column": 12,
          "position": 397
        }
      }
    },
    {
      "format": "typescript",
      "lines": 10,
      "fragment": "function getCookie(name: string): string | null {\n  if (typeof document === \"undefined\") return null;\n\n  const prefix = `${name}=`;\n  const cookie = document.cookie\n    .split(\"; \")\n    .find((row) => row.startsWith(prefix))\n    ?.slice(prefix.length);\n\n  return cookie ? cookie",
      "tokens": 0,
      "firstFile": {
        "name": "packages/sdk/src/session.ts",
        "start": 10,
        "end": 19,
        "startLoc": {
          "line": 10,
          "column": 1,
          "position": 78
        },
        "endLoc": {
          "line": 19,
          "column": 7,
          "position": 185
        }
      },
      "secondFile": {
        "name": "packages/sdk/src/visitor.ts",
        "start": 9,
        "end": 18,
        "startLoc": {
          "line": 9,
          "column": 1,
          "position": 58
        },
        "endLoc": {
          "line": 18,
          "column": 2,
          "position": 164
        }
      }
    },
    {
      "format": "typescript",
      "lines": 21,
      "fragment": ": number }>;\n};\n\nfunction parsePeriod(raw: string | null): Period | null {\n  if (!raw) return \"7d\";\n  if (raw === \"24h\" || raw === \"7d\" || raw === \"30d\") return raw;\n  return null;\n}\n\nfunction periodMs(period: Period): number {\n  switch (period) {\n    case \"24h\":\n      return 24 * 60 * 60 * 1000;\n    case \"7d\":\n      return 7 * 24 * 60 * 60 * 1000;\n    case \"30d\":\n      return 30 * 24 * 60 * 60 * 1000;\n  }\n}\n\nfunction percentChange",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/app/api/projects/[id]/analytics/overview/route.ts",
        "start": 15,
        "end": 35,
        "startLoc": {
          "line": 15,
          "column": 11,
          "position": 218
        },
        "endLoc": {
          "line": 35,
          "column": 14,
          "position": 419
        }
      },
      "secondFile": {
        "name": "apps/web/app/api/projects/[id]/analytics/sessions/route.ts",
        "start": 15,
        "end": 35,
        "startLoc": {
          "line": 15,
          "column": 18,
          "position": 148
        },
        "endLoc": {
          "line": 35,
          "column": 16,
          "position": 349
        }
      }
    },
    {
      "format": "typescript",
      "lines": 11,
      "fragment": "}\n\nfunction escapeSqlString(value: string): string {\n  return value.replaceAll(\"'\", \"''\");\n}\n\nfunction toTinybirdDateTime64String(date: Date): string {\n  return date.toISOString().replace(\"T\", \" \").replace(\"Z\", \"\");\n}\n\nasync",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/app/api/projects/[id]/analytics/overview/route.ts",
        "start": 38,
        "end": 48,
        "startLoc": {
          "line": 38,
          "column": 1,
          "position": 493
        },
        "endLoc": {
          "line": 48,
          "column": 6,
          "position": 572
        }
      },
      "secondFile": {
        "name": "apps/web/app/api/projects/[id]/analytics/sessions/route.ts",
        "start": 33,
        "end": 43,
        "startLoc": {
          "line": 33,
          "column": 1,
          "position": 344
        },
        "endLoc": {
          "line": 43,
          "column": 7,
          "position": 423
        }
      }
    },
    {
      "format": "typescript",
      "lines": 25,
      "fragment": "}\n\nexport async function GET(\n  request: Request,\n  context: { params: Promise<{ id: string }> | { id: string } },\n): Promise<Response> {\n  const user = await getUserFromRequest(request);\n  if (!user) return Response.json({ error: \"Unauthorized\" }, { status: 401 });\n\n  const params = \"then\" in context.params ? await context.params : context.params;\n  const projectId = params.id;\n  if (!projectId) return Response.json({ error: \"Missing project id\" }, { status: 400 });\n\n  const ownedRows = await db\n    .select({ id: projects.id })\n    .from(projects)\n    .where(and(eq(projects.id, projectId), eq(projects.userId, user.id)));\n  if (!ownedRows[0]) return Response.json({ error: \"Project not found\" }, { status: 404 });\n\n  const url = new URL(request.url);\n  const period = parsePeriod(url.searchParams.get(\"period\"));\n  if (!period) return Response.json({ error: \"Invalid period\" }, { status: 400 });\n\n  const now = new Date();\n  const duration",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/app/api/projects/[id]/analytics/overview/route.ts",
        "start": 55,
        "end": 79,
        "startLoc": {
          "line": 55,
          "column": 1,
          "position": 688
        },
        "endLoc": {
          "line": 79,
          "column": 9,
          "position": 1076
        }
      },
      "secondFile": {
        "name": "apps/web/app/api/projects/[id]/analytics/sessions/route.ts",
        "start": 41,
        "end": 65,
        "startLoc": {
          "line": 41,
          "column": 1,
          "position": 420
        },
        "endLoc": {
          "line": 65,
          "column": 6,
          "position": 808
        }
      }
    },
    {
      "format": "typescript",
      "lines": 12,
      "fragment": ");\n}\n\nfunction escapeSqlString(value: string): string {\n  return value.replaceAll(\"'\", \"''\");\n}\n\nfunction toTinybirdDateTime64String(date: Date): string {\n  return date.toISOString().replace(\"T\", \" \").replace(\"Z\", \"\");\n}\n\nfunction",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/app/api/projects/[id]/analytics/live/route.ts",
        "start": 21,
        "end": 32,
        "startLoc": {
          "line": 21,
          "column": 2,
          "position": 197
        },
        "endLoc": {
          "line": 32,
          "column": 9,
          "position": 279
        }
      },
      "secondFile": {
        "name": "apps/web/app/api/projects/[id]/analytics/overview/route.ts",
        "start": 37,
        "end": 43,
        "startLoc": {
          "line": 37,
          "column": 4,
          "position": 490
        },
        "endLoc": {
          "line": 43,
          "column": 7,
          "position": 423
        }
      }
    },
    {
      "format": "typescript",
      "lines": 23,
      "fragment": ";\n}\n\nexport async function GET(\n  request: Request,\n  context: { params: Promise<{ id: string }> | { id: string } },\n): Promise<Response> {\n  const user = await getUserFromRequest(request);\n  if (!user) return Response.json({ error: \"Unauthorized\" }, { status: 401 });\n\n  const params = \"then\" in context.params ? await context.params : context.params;\n  const projectId = params.id;\n  if (!projectId) return Response.json({ error: \"Missing project id\" }, { status: 400 });\n\n  const ownedRows = await db\n    .select({ id: projects.id })\n    .from(projects)\n    .where(and(eq(projects.id, projectId), eq(projects.userId, user.id)));\n\n  if (!ownedRows[0]) return Response.json({ error: \"Project not found\" }, { status: 404 });\n\n  const url = new URL(request.url);\n  const limitRaw",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/app/api/projects/[id]/analytics/live/route.ts",
        "start": 38,
        "end": 60,
        "startLoc": {
          "line": 38,
          "column": 3,
          "position": 382
        },
        "endLoc": {
          "line": 60,
          "column": 9,
          "position": 703
        }
      },
      "secondFile": {
        "name": "apps/web/app/api/projects/[id]/analytics/sessions/route.ts",
        "start": 40,
        "end": 61,
        "startLoc": {
          "line": 40,
          "column": 2,
          "position": 418
        },
        "endLoc": {
          "line": 61,
          "column": 7,
          "position": 738
        }
      }
    },
    {
      "format": "typescript",
      "lines": 6,
      "fragment": "(\n  request: Request,\n  context: { params: Promise<{ id: string }> | { id: string } },\n): Promise<Response> {\n  const user = await getUserFromRequest(request);\n  if (!user) return Response.json({ success",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/app/api/projects/[id]/regenerate/route.ts",
        "start": 11,
        "end": 16,
        "startLoc": {
          "line": 11,
          "column": 5,
          "position": 116
        },
        "endLoc": {
          "line": 16,
          "column": 8,
          "position": 201
        }
      },
      "secondFile": {
        "name": "apps/web/app/api/projects/[id]/analytics/sessions/route.ts",
        "start": 43,
        "end": 48,
        "startLoc": {
          "line": 43,
          "column": 4,
          "position": 430
        },
        "endLoc": {
          "line": 48,
          "column": 6,
          "position": 515
        }
      }
    },
    {
      "format": "tsx",
      "lines": 14,
      "fragment": ": number }>;\n};\n\ntype ErrorResponse = { error?: string; message?: string };\n\nfunction extractErrorMessage(body: unknown): string | null {\n  if (!body || typeof body !== \"object\") return null;\n  const maybe = body as ErrorResponse;\n  if (typeof maybe.error === \"string\" && maybe.error.length > 0) return maybe.error;\n  if (typeof maybe.message === \"string\" && maybe.message.length > 0) return maybe.message;\n  return null;\n}\n\nasync function fetchOverview",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/app/(dashboard)/projects/[id]/overview/page.tsx",
        "start": 18,
        "end": 31,
        "startLoc": {
          "line": 18,
          "column": 11,
          "position": 229
        },
        "endLoc": {
          "line": 31,
          "column": 14,
          "position": 403
        }
      },
      "secondFile": {
        "name": "apps/web/app/(dashboard)/projects/[id]/sessions/page.tsx",
        "start": 17,
        "end": 30,
        "startLoc": {
          "line": 17,
          "column": 18,
          "position": 144
        },
        "endLoc": {
          "line": 30,
          "column": 14,
          "position": 318
        }
      }
    },
    {
      "format": "tsx",
      "lines": 7,
      "fragment": "${period}`, {\n    method: \"GET\",\n    headers: { accept: \"application/json\" },\n  });\n  const body = (await response.json().catch(() => null)) as unknown;\n  if (!response.ok) throw new Error(extractErrorMessage(body) ?? `Request failed (${response.status})`);\n  return body as OverviewResponse",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/app/(dashboard)/projects/[id]/overview/page.tsx",
        "start": 32,
        "end": 38,
        "startLoc": {
          "line": 32,
          "column": 28,
          "position": 444
        },
        "endLoc": {
          "line": 38,
          "column": 17,
          "position": 551
        }
      },
      "secondFile": {
        "name": "apps/web/app/(dashboard)/projects/[id]/sessions/page.tsx",
        "start": 31,
        "end": 37,
        "startLoc": {
          "line": 31,
          "column": 28,
          "position": 359
        },
        "endLoc": {
          "line": 37,
          "column": 17,
          "position": 466
        }
      }
    },
    {
      "format": "typescript",
      "lines": 10,
      "fragment": "function getExpandedId(value: unknown): string | null {\n  if (typeof value === \"string\" && value.length > 0) return value;\n  if (value && typeof value === \"object\" && \"id\" in value && typeof (value as { id?: unknown }).id === \"string\") {\n    const id = (value as { id: string }).id;\n    return id.length > 0 ? id : null;\n  }\n  return null;\n}\n\nfunction getUnixSecondsDate",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/app/api/stripe/reconcile/route.ts",
        "start": 13,
        "end": 22,
        "startLoc": {
          "line": 13,
          "column": 1,
          "position": 100
        },
        "endLoc": {
          "line": 22,
          "column": 19,
          "position": 259
        }
      },
      "secondFile": {
        "name": "apps/web/app/api/webhooks/stripe/route.ts",
        "start": 40,
        "end": 49,
        "startLoc": {
          "line": 40,
          "column": 1,
          "position": 498
        },
        "endLoc": {
          "line": 49,
          "column": 18,
          "position": 657
        }
      }
    },
    {
      "format": "typescript",
      "lines": 10,
      "fragment": ";\n}\n\nexport async function POST(request: Request): Promise<Response> {\n  const session = await validateSession(request);\n  if (!session) {\n    return Response.json({ error: \"Unauthorized\" }, { status: 401 });\n  }\n\n  const",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/app/api/stripe/portal/route.ts",
        "start": 11,
        "end": 20,
        "startLoc": {
          "line": 11,
          "column": 4,
          "position": 134
        },
        "endLoc": {
          "line": 20,
          "column": 6,
          "position": 219
        }
      },
      "secondFile": {
        "name": "apps/web/app/api/stripe/reconcile/route.ts",
        "start": 40,
        "end": 49,
        "startLoc": {
          "line": 40,
          "column": 2,
          "position": 497
        },
        "endLoc": {
          "line": 49,
          "column": 4,
          "position": 582
        }
      }
    },
    {
      "format": "typescript",
      "lines": 10,
      "fragment": ";\n}\n\nexport async function POST(request: Request): Promise<Response> {\n  const session = await validateSession(request);\n  if (!session) {\n    return Response.json({ error: \"Unauthorized\" }, { status: 401 });\n  }\n\n  let formData",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/app/api/stripe/checkout/route.ts",
        "start": 28,
        "end": 37,
        "startLoc": {
          "line": 28,
          "column": 5,
          "position": 340
        },
        "endLoc": {
          "line": 37,
          "column": 9,
          "position": 427
        }
      },
      "secondFile": {
        "name": "apps/web/app/api/stripe/reconcile/route.ts",
        "start": 40,
        "end": 49,
        "startLoc": {
          "line": 40,
          "column": 2,
          "position": 497
        },
        "endLoc": {
          "line": 49,
          "column": 5,
          "position": 584
        }
      }
    },
    {
      "format": "typescript",
      "lines": 10,
      "fragment": "stripeCustomerId: users.stripeCustomerId })\n    .from(users)\n    .where(eq(users.id, session.userId));\n\n  const user = rows[0];\n  if (!user) {\n    return Response.json({ error: \"User not found\" }, { status: 404 });\n  }\n\n  const",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/app/api/stripe/checkout/route.ts",
        "start": 51,
        "end": 60,
        "startLoc": {
          "line": 51,
          "column": 2,
          "position": 605
        },
        "endLoc": {
          "line": 60,
          "column": 6,
          "position": 697
        }
      },
      "secondFile": {
        "name": "apps/web/app/api/stripe/portal/route.ts",
        "start": 20,
        "end": 26,
        "startLoc": {
          "line": 20,
          "column": 2,
          "position": 233
        },
        "endLoc": {
          "line": 26,
          "column": 3,
          "position": 320
        }
      }
    },
    {
      "format": "typescript",
      "lines": 12,
      "fragment": "export async function GET(\n  request: Request,\n  context: { params: Promise<{ id: string }> | { id: string } },\n): Promise<Response> {\n  const user = await getUserFromRequest(request);\n  if (!user) return Response.json({ error: \"Unauthorized\" }, { status: 401 });\n\n  const params = \"then\" in context.params ? await context.params : context.params;\n  const projectId = params.id;\n  if (!projectId) return Response.json({ error: \"Missing project id\" }, { status: 400 });\n\n  const projectRows",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/app/api/projects/[id]/route.ts",
        "start": 66,
        "end": 77,
        "startLoc": {
          "line": 66,
          "column": 1,
          "position": 540
        },
        "endLoc": {
          "line": 77,
          "column": 12,
          "position": 733
        }
      },
      "secondFile": {
        "name": "apps/web/app/api/projects/[id]/analytics/sessions/route.ts",
        "start": 43,
        "end": 54,
        "startLoc": {
          "line": 43,
          "column": 1,
          "position": 423
        },
        "endLoc": {
          "line": 54,
          "column": 10,
          "position": 616
        }
      }
    },
    {
      "format": "tsx",
      "lines": 6,
      "fragment": "useMemo(() => {\n    const data = projectQuery.data as null | { project?: unknown };\n    return (data?.project as null | Record<string, unknown>) ?? null;\n  }, [projectQuery.data]);\n\n  const repoName",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/app/(dashboard)/projects/[id]/layout.tsx",
        "start": 36,
        "end": 41,
        "startLoc": {
          "line": 36,
          "column": 2,
          "position": 397
        },
        "endLoc": {
          "line": 41,
          "column": 9,
          "position": 480
        }
      },
      "secondFile": {
        "name": "apps/web/app/(dashboard)/projects/[id]/page.tsx",
        "start": 112,
        "end": 117,
        "startLoc": {
          "line": 112,
          "column": 2,
          "position": 993
        },
        "endLoc": {
          "line": 117,
          "column": 9,
          "position": 1076
        }
      }
    },
    {
      "format": "typescript",
      "lines": 16,
      "fragment": "} from \"../../db/queries/projects\";\nimport { analyzeRepository } from \"../analyze\";\n\nfunction isRecord(value: unknown): value is Record<string, unknown> {\n  return typeof value === \"object\" && value !== null;\n}\n\nfunction readInstallationId(payload: Record<string, unknown>): bigint | null {\n  const installation = payload.installation;\n  if (!isRecord(installation)) return null;\n  const id = installation.id;\n  if (typeof id !== \"number\" || !Number.isFinite(id)) return null;\n  return BigInt(id);\n}\n\nasync",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/lib/github/handlers/installation.ts",
        "start": 10,
        "end": 25,
        "startLoc": {
          "line": 10,
          "column": 1,
          "position": 62
        },
        "endLoc": {
          "line": 25,
          "column": 6,
          "position": 236
        }
      },
      "secondFile": {
        "name": "apps/web/lib/github/handlers/push.ts",
        "start": 1,
        "end": 16,
        "startLoc": {
          "line": 1,
          "column": 2,
          "position": 6
        },
        "endLoc": {
          "line": 16,
          "column": 9,
          "position": 180
        }
      }
    },
    {
      "format": "typescript",
      "lines": 9,
      "fragment": "(payload: unknown): Promise<void> {\n  if (!isRecord(payload)) return;\n  const action = payload.action;\n  if (typeof action !== \"string\") return;\n\n  const installationId = readInstallationId(payload);\n  if (!installationId) return;\n\n  if (action === \"added\"",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/lib/github/handlers/installation.ts",
        "start": 75,
        "end": 83,
        "startLoc": {
          "line": 75,
          "column": 38,
          "position": 800
        },
        "endLoc": {
          "line": 83,
          "column": 8,
          "position": 891
        }
      },
      "secondFile": {
        "name": "apps/web/lib/github/handlers/installation.ts",
        "start": 48,
        "end": 56,
        "startLoc": {
          "line": 48,
          "column": 26,
          "position": 542
        },
        "endLoc": {
          "line": 56,
          "column": 10,
          "position": 633
        }
      }
    },
    {
      "format": "typescript",
      "lines": 11,
      "fragment": ");\n    await upsertProjectsForRepos({ userId, installationId, repositories });\n    await Promise.all(\n      repositories.map((repo) =>\n        analyzeRepository({ repoId: BigInt(repo.id), repoFullName: repo.fullName, installationId }),\n      ),\n    );\n    return;\n  }\n\n  if (action === \"removed\"",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/lib/github/handlers/installation.ts",
        "start": 87,
        "end": 97,
        "startLoc": {
          "line": 87,
          "column": 21,
          "position": 936
        },
        "endLoc": {
          "line": 97,
          "column": 10,
          "position": 1031
        }
      },
      "secondFile": {
        "name": "apps/web/lib/github/handlers/installation.ts",
        "start": 60,
        "end": 70,
        "startLoc": {
          "line": 60,
          "column": 15,
          "position": 678
        },
        "endLoc": {
          "line": 70,
          "column": 10,
          "position": 773
        }
      }
    },
    {
      "format": "typescript",
      "lines": 16,
      "fragment": ";\n\nfunction escapeSqlString(value: string): string {\n  return value.replaceAll(\"'\", \"''\");\n}\n\nfunction normalizeTimestamp(value: unknown): string | null {\n  const raw = String(value ?? \"\");\n  if (!raw) return null;\n  if (raw.includes(\"T\")) return raw.endsWith(\"Z\") ? raw : `${raw}Z`;\n\n  const iso = raw.replace(\" \", \"T\");\n  return iso.endsWith(\"Z\") ? iso : `${iso}Z`;\n}\n\nasync function fetchLastEventAtByProjectId",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/app/api/projects/route.ts",
        "start": 6,
        "end": 21,
        "startLoc": {
          "line": 6,
          "column": 31,
          "position": 70
        },
        "endLoc": {
          "line": 21,
          "column": 28,
          "position": 238
        }
      },
      "secondFile": {
        "name": "apps/web/app/api/projects/[id]/route.ts",
        "start": 6,
        "end": 21,
        "startLoc": {
          "line": 6,
          "column": 34,
          "position": 73
        },
        "endLoc": {
          "line": 21,
          "column": 25,
          "position": 241
        }
      }
    },
    {
      "format": "tsx",
      "lines": 8,
      "fragment": "const now = new Date();\n  const sessionRows = await db\n    .select({ userId: sessions.userId })\n    .from(sessions)\n    .where(and(eq(sessions.id, sessionId), gt(sessions.expiresAt, now)));\n\n  const userId = sessionRows[0]?.userId ?? null;\n  if (!userId) {",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/app/(dashboard)/settings/page.tsx",
        "start": 16,
        "end": 23,
        "startLoc": {
          "line": 16,
          "column": 3,
          "position": 171
        },
        "endLoc": {
          "line": 23,
          "column": 2,
          "position": 278
        }
      },
      "secondFile": {
        "name": "apps/web/app/(marketing)/pricing/page.tsx",
        "start": 58,
        "end": 65,
        "startLoc": {
          "line": 58,
          "column": 3,
          "position": 494
        },
        "endLoc": {
          "line": 65,
          "column": 7,
          "position": 601
        }
      }
    },
    {
      "format": "tsx",
      "lines": 6,
      "fragment": "<svg className=\"size-4 transition-transform group-hover:translate-x-0.5\" viewBox=\"0 0 16 16\" fill=\"none\">\n                    <path d=\"M3 8h10M9 4l4 4-4 4\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\"/>\n                  </svg>\n                </button>\n              </form>\n            <",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/app/(dashboard)/settings/page.tsx",
        "start": 101,
        "end": 106,
        "startLoc": {
          "line": 101,
          "column": 19,
          "position": 1215
        },
        "endLoc": {
          "line": 106,
          "column": 2,
          "position": 1288
        }
      },
      "secondFile": {
        "name": "apps/web/app/(dashboard)/settings/page.tsx",
        "start": 92,
        "end": 97,
        "startLoc": {
          "line": 92,
          "column": 19,
          "position": 1077
        },
        "endLoc": {
          "line": 97,
          "column": 2,
          "position": 1150
        }
      }
    },
    {
      "format": "tsx",
      "lines": 6,
      "fragment": "<svg className=\"size-4 transition-transform group-hover:translate-x-0.5\" viewBox=\"0 0 16 16\" fill=\"none\">\n                  <path d=\"M3 8h10M9 4l4 4-4 4\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\"/>\n                </svg>\n              </button>\n            </form>\n          )",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/app/(dashboard)/settings/page.tsx",
        "start": 111,
        "end": 116,
        "startLoc": {
          "line": 111,
          "column": 17,
          "position": 1339
        },
        "endLoc": {
          "line": 116,
          "column": 2,
          "position": 1412
        }
      },
      "secondFile": {
        "name": "apps/web/app/(dashboard)/settings/page.tsx",
        "start": 92,
        "end": 97,
        "startLoc": {
          "line": 92,
          "column": 19,
          "position": 1077
        },
        "endLoc": {
          "line": 97,
          "column": 2,
          "position": 1150
        }
      }
    },
    {
      "format": "typescript",
      "lines": 14,
      "fragment": "});\n\n  const text = await response.text();\n  const json = ((): null | { data?: T[]; error?: unknown } => {\n    try {\n      return JSON.parse(text) as { data?: T[]; error?: unknown };\n    } catch {\n      return null;\n    }\n  })();\n\n  if (!response.ok || !json || !Array.isArray(json.data)) {\n    const detail = json?.error ? String(json.error) : text.slice(0, 500);\n    throw new Error(`Tinybird SQL request failed (",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/lib/tinybird/client.ts",
        "start": 59,
        "end": 72,
        "startLoc": {
          "line": 59,
          "column": 3,
          "position": 758
        },
        "endLoc": {
          "line": 72,
          "column": 31,
          "position": 949
        }
      },
      "secondFile": {
        "name": "apps/web/lib/tinybird/client.ts",
        "start": 28,
        "end": 40,
        "startLoc": {
          "line": 28,
          "column": 2,
          "position": 338
        },
        "endLoc": {
          "line": 40,
          "column": 32,
          "position": 528
        }
      }
    },
    {
      "format": "typescript",
      "lines": 13,
      "fragment": ";\n\ntype ErrorResponse = { error?: string; message?: string };\n\nfunction extractErrorMessage(body: unknown): string | null {\n  if (!body || typeof body !== \"object\") return null;\n  const maybe = body as ErrorResponse;\n  if (typeof maybe.error === \"string\" && maybe.error.length > 0) return maybe.error;\n  if (typeof maybe.message === \"string\" && maybe.message.length > 0) return maybe.message;\n  return null;\n}\n\nexport async function fetchProject",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/lib/hooks/use-project.ts",
        "start": 11,
        "end": 23,
        "startLoc": {
          "line": 11,
          "column": 2,
          "position": 87
        },
        "endLoc": {
          "line": 23,
          "column": 13,
          "position": 254
        }
      },
      "secondFile": {
        "name": "apps/web/lib/hooks/use-projects.ts",
        "start": 18,
        "end": 30,
        "startLoc": {
          "line": 18,
          "column": 2,
          "position": 131
        },
        "endLoc": {
          "line": 30,
          "column": 14,
          "position": 298
        }
      }
    },
    {
      "format": "typescript",
      "lines": 9,
      "fragment": "});\n\n  const body = (await response.json().catch(() => null)) as unknown;\n\n  if (!response.ok) {\n    throw new Error(extractErrorMessage(body) ?? `Request failed (${response.status})`);\n  }\n\n  if (!body || typeof body !== \"object\") {",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/lib/hooks/use-project.ts",
        "start": 27,
        "end": 35,
        "startLoc": {
          "line": 27,
          "column": 3,
          "position": 315
        },
        "endLoc": {
          "line": 35,
          "column": 2,
          "position": 412
        }
      },
      "secondFile": {
        "name": "apps/web/lib/hooks/use-projects.ts",
        "start": 31,
        "end": 38,
        "startLoc": {
          "line": 31,
          "column": 2,
          "position": 344
        },
        "endLoc": {
          "line": 38,
          "column": 6,
          "position": 440
        }
      }
    },
    {
      "format": "typescript",
      "lines": 13,
      "fragment": "};\n\ntype ErrorResponse = { error?: string; message?: string };\n\nfunction extractErrorMessage(body: unknown): string | null {\n  if (!body || typeof body !== \"object\") return null;\n  const maybe = body as ErrorResponse;\n  if (typeof maybe.error === \"string\" && maybe.error.length > 0) return maybe.error;\n  if (typeof maybe.message === \"string\" && maybe.message.length > 0) return maybe.message;\n  return null;\n}\n\nexport async function fetchLiveFeed",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/lib/hooks/use-live-feed.ts",
        "start": 16,
        "end": 28,
        "startLoc": {
          "line": 16,
          "column": 2,
          "position": 113
        },
        "endLoc": {
          "line": 28,
          "column": 14,
          "position": 281
        }
      },
      "secondFile": {
        "name": "apps/web/lib/hooks/use-projects.ts",
        "start": 18,
        "end": 30,
        "startLoc": {
          "line": 18,
          "column": 2,
          "position": 130
        },
        "endLoc": {
          "line": 30,
          "column": 14,
          "position": 298
        }
      }
    },
    {
      "format": "typescript",
      "lines": 12,
      "fragment": ";\n\nfunction readRequiredEnv(name: string): string {\n  const value = process.env[name];\n  if (typeof value === \"string\" && value.length > 0) return value;\n\n  throw new Error(\n    `Missing required environment variable: ${name}. Set it in apps/web/.env.local for local dev, or in your Vercel project environment variables.`,\n  );\n}\n\nfunction",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/lib/github/app.ts",
        "start": 33,
        "end": 44,
        "startLoc": {
          "line": 33,
          "column": 5,
          "position": 284
        },
        "endLoc": {
          "line": 44,
          "column": 9,
          "position": 369
        }
      },
      "secondFile": {
        "name": "apps/web/app/api/webhooks/github/route.ts",
        "start": 4,
        "end": 15,
        "startLoc": {
          "line": 4,
          "column": 39,
          "position": 53
        },
        "endLoc": {
          "line": 15,
          "column": 6,
          "position": 138
        }
      }
    },
    {
      "format": "typescript",
      "lines": 17,
      "fragment": ";\n\nfunction toSafeNumber(value: bigint): number {\n  const asNumber = Number(value);\n  if (!Number.isSafeInteger(asNumber)) {\n    throw new Error(`Installation ID is too large to safely convert to number: ${value.toString()}`);\n  }\n  return asNumber;\n}\n\nfunction parseRepoFullName(repoFullName: string): { owner: string; repo: string } | null {\n  const [owner, repo, ...rest] = repoFullName.split(\"/\");\n  if (!owner || !repo || rest.length > 0) return null;\n  return { owner, repo };\n}\n\nexport async",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/lib/github/analyze.ts",
        "start": 5,
        "end": 21,
        "startLoc": {
          "line": 5,
          "column": 13,
          "position": 57
        },
        "endLoc": {
          "line": 21,
          "column": 6,
          "position": 236
        }
      },
      "secondFile": {
        "name": "apps/web/lib/github/generate.ts",
        "start": 5,
        "end": 21,
        "startLoc": {
          "line": 5,
          "column": 17,
          "position": 59
        },
        "endLoc": {
          "line": 21,
          "column": 9,
          "position": 238
        }
      }
    },
    {
      "format": "tsx",
      "lines": 13,
      "fragment": ",\n    icon: (\n      <svg\n        viewBox=\"0 0 24 24\"\n        aria-hidden=\"true\"\n        className=\"size-7\"\n        fill=\"none\"\n        stroke=\"currentColor\"\n        strokeWidth=\"2\"\n        strokeLinecap=\"round\"\n        strokeLinejoin=\"round\"\n      >\n        <path d=\"M3 17l6-6 4 4 7-7",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/components/marketing/what-you-get.tsx",
        "start": 31,
        "end": 43,
        "startLoc": {
          "line": 31,
          "column": 82,
          "position": 176
        },
        "endLoc": {
          "line": 43,
          "column": 18,
          "position": 245
        }
      },
      "secondFile": {
        "name": "apps/web/components/marketing/what-you-get.tsx",
        "start": 13,
        "end": 25,
        "startLoc": {
          "line": 13,
          "column": 93,
          "position": 74
        },
        "endLoc": {
          "line": 25,
          "column": 26,
          "position": 143
        }
      }
    },
    {
      "format": "tsx",
      "lines": 13,
      "fragment": ",\n    icon: (\n      <svg\n        viewBox=\"0 0 24 24\"\n        aria-hidden=\"true\"\n        className=\"size-7\"\n        fill=\"none\"\n        stroke=\"currentColor\"\n        strokeWidth=\"2\"\n        strokeLinecap=\"round\"\n        strokeLinejoin=\"round\"\n      >\n        <path d=\"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/components/marketing/what-you-get.tsx",
        "start": 50,
        "end": 62,
        "startLoc": {
          "line": 50,
          "column": 71,
          "position": 290
        },
        "endLoc": {
          "line": 62,
          "column": 59,
          "position": 359
        }
      },
      "secondFile": {
        "name": "apps/web/components/marketing/what-you-get.tsx",
        "start": 13,
        "end": 25,
        "startLoc": {
          "line": 13,
          "column": 93,
          "position": 74
        },
        "endLoc": {
          "line": 25,
          "column": 26,
          "position": 143
        }
      }
    },
    {
      "format": "tsx",
      "lines": 13,
      "fragment": ",\n    icon: (\n      <svg\n        viewBox=\"0 0 24 24\"\n        aria-hidden=\"true\"\n        className=\"size-7\"\n        fill=\"none\"\n        stroke=\"currentColor\"\n        strokeWidth=\"2\"\n        strokeLinecap=\"round\"\n        strokeLinejoin=\"round\"\n      >\n        <path d=\"M10 13a5 5 0 0 1 0-7l1.4-1.4a5 5 0 0 1 7 7L17 13",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/components/marketing/what-you-get.tsx",
        "start": 72,
        "end": 84,
        "startLoc": {
          "line": 72,
          "column": 108,
          "position": 429
        },
        "endLoc": {
          "line": 84,
          "column": 49,
          "position": 498
        }
      },
      "secondFile": {
        "name": "apps/web/components/marketing/what-you-get.tsx",
        "start": 13,
        "end": 25,
        "startLoc": {
          "line": 13,
          "column": 93,
          "position": 74
        },
        "endLoc": {
          "line": 25,
          "column": 26,
          "position": 143
        }
      }
    },
    {
      "format": "tsx",
      "lines": 13,
      "fragment": ",\n    icon: (\n      <svg\n        viewBox=\"0 0 24 24\"\n        aria-hidden=\"true\"\n        className=\"size-7\"\n        fill=\"none\"\n        stroke=\"currentColor\"\n        strokeWidth=\"2\"\n        strokeLinecap=\"round\"\n        strokeLinejoin=\"round\"\n      >\n        <path d=\"M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/components/marketing/what-you-get.tsx",
        "start": 91,
        "end": 103,
        "startLoc": {
          "line": 91,
          "column": 73,
          "position": 543
        },
        "endLoc": {
          "line": 103,
          "column": 42,
          "position": 612
        }
      },
      "secondFile": {
        "name": "apps/web/components/marketing/what-you-get.tsx",
        "start": 13,
        "end": 25,
        "startLoc": {
          "line": 13,
          "column": 93,
          "position": 74
        },
        "endLoc": {
          "line": 25,
          "column": 26,
          "position": 143
        }
      }
    },
    {
      "format": "tsx",
      "lines": 13,
      "fragment": ",\n    icon: (\n      <svg\n        viewBox=\"0 0 24 24\"\n        aria-hidden=\"true\"\n        className=\"size-7\"\n        fill=\"none\"\n        stroke=\"currentColor\"\n        strokeWidth=\"2\"\n        strokeLinecap=\"round\"\n        strokeLinejoin=\"round\"\n      >\n        <rect",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/components/marketing/what-you-get.tsx",
        "start": 112,
        "end": 124,
        "startLoc": {
          "line": 112,
          "column": 71,
          "position": 681
        },
        "endLoc": {
          "line": 124,
          "column": 5,
          "position": 745
        }
      },
      "secondFile": {
        "name": "apps/web/components/marketing/what-you-get.tsx",
        "start": 13,
        "end": 25,
        "startLoc": {
          "line": 13,
          "column": 93,
          "position": 74
        },
        "endLoc": {
          "line": 25,
          "column": 5,
          "position": 138
        }
      }
    },
    {
      "format": "tsx",
      "lines": 18,
      "fragment": "\">\n          {FEATURES.map((feature) => (\n            <div\n              key={feature.title}\n              className=\"group rounded-lg border border-[#e8e0d9] bg-white p-8 shadow-warm transition-all duration-300 hover:-translate-y-1 hover:shadow-warm-lg\"\n            >\n              <div className=\"mb-6 flex size-12 items-center justify-center rounded bg-[#ec7f13]/10 text-[#ec7f13] transition-transform group-hover:scale-110\">\n                {feature.icon}\n              </div>\n              <h3 className=\"mb-3 font-display text-xl font-semibold text-[#1b140d]\">{feature.title}</h3>\n              <p className=\"leading-relaxed text-[#9a734c]\">{feature.description}</p>\n            </div>\n          ))}\n        </div>\n      </div>\n    </section>\n  );\n}",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/components/marketing/features.tsx",
        "start": 54,
        "end": 71,
        "startLoc": {
          "line": 54,
          "column": 38,
          "position": 428
        },
        "endLoc": {
          "line": 71,
          "column": 2,
          "position": 555
        }
      },
      "secondFile": {
        "name": "apps/web/components/marketing/what-you-get.tsx",
        "start": 145,
        "end": 166,
        "startLoc": {
          "line": 145,
          "column": 53,
          "position": 960
        },
        "endLoc": {
          "line": 166,
          "column": 2,
          "position": 1095
        }
      }
    },
    {
      "format": "tsx",
      "lines": 10,
      "fragment": ") {\n      if (!open) return;\n      const target = event.target as Node | null;\n      if (!target) return;\n      if (rootRef.current && !rootRef.current.contains(target)) {\n        setOpen(false);\n      }\n    }\n\n    function onDocumentKeyDown",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/components/dashboard/user-dropdown.tsx",
        "start": 30,
        "end": 39,
        "startLoc": {
          "line": 30,
          "column": 11,
          "position": 288
        },
        "endLoc": {
          "line": 39,
          "column": 18,
          "position": 374
        }
      },
      "secondFile": {
        "name": "apps/web/components/dashboard/user-dropdown.tsx",
        "start": 21,
        "end": 30,
        "startLoc": {
          "line": 21,
          "column": 11,
          "position": 196
        },
        "endLoc": {
          "line": 30,
          "column": 21,
          "position": 282
        }
      }
    },
    {
      "format": "tsx",
      "lines": 9,
      "fragment": "\">\n            <svg viewBox=\"0 0 24 24\" aria-hidden=\"true\" className=\"size-4\">\n              <path\n                fill=\"currentColor\"\n                d=\"M3 3h18v18H3V3zm4 14h2V9H7v8zm4 0h2V5h-2v12zm4 0h2v-6h-2v6z\"\n              />\n            </svg>\n          </div>\n          <span className=\"text-base font-bold tracking-tight text-warm-900",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/components/dashboard/header.tsx",
        "start": 16,
        "end": 24,
        "startLoc": {
          "line": 16,
          "column": 82,
          "position": 137
        },
        "endLoc": {
          "line": 24,
          "column": 49,
          "position": 198
        }
      },
      "secondFile": {
        "name": "apps/web/components/marketing/footer.tsx",
        "start": 12,
        "end": 20,
        "startLoc": {
          "line": 12,
          "column": 79,
          "position": 97
        },
        "endLoc": {
          "line": 20,
          "column": 41,
          "position": 158
        }
      }
    },
    {
      "format": "tsx",
      "lines": 7,
      "fragment": "\" viewBox=\"0 0 16 16\" fill=\"none\" aria-hidden=\"true\">\n              <path d=\"M6 14H3a1 1 0 01-1-1V3a1 1 0 011-1h3M11 11l3-3-3-3M14 8H6\" stroke=\"currentColor\" strokeWidth=\"1.5\" strokeLinecap=\"round\" strokeLinejoin=\"round\"/>\n            </svg>\n            Log out\n          </button>\n        </form>\n      )",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/components/dashboard/header.tsx",
        "start": 36,
        "end": 42,
        "startLoc": {
          "line": 36,
          "column": 65,
          "position": 297
        },
        "endLoc": {
          "line": 42,
          "column": 2,
          "position": 374
        }
      },
      "secondFile": {
        "name": "apps/web/components/dashboard/user-dropdown.tsx",
        "start": 101,
        "end": 107,
        "startLoc": {
          "line": 101,
          "column": 21,
          "position": 916
        },
        "endLoc": {
          "line": 107,
          "column": 3,
          "position": 993
        }
      }
    },
    {
      "format": "typescript",
      "lines": 7,
      "fragment": "]);\n      selectSpy = vi.fn(() => ({ from: () => ({ where: whereSpy }) }));\n      updateSpy = vi.fn();\n      insertSpy = vi.fn();\n\n      const { getUserById } = await import(\"../lib/db/queries/users\");\n      await expect(getUserById(\"u1\")).resolves.toEqual",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/users-queries.test.ts",
        "start": 138,
        "end": 144,
        "startLoc": {
          "line": 138,
          "column": 7,
          "position": 1500
        },
        "endLoc": {
          "line": 144,
          "column": 8,
          "position": 1602
        }
      },
      "secondFile": {
        "name": "apps/web/tests/users-queries.test.ts",
        "start": 119,
        "end": 125,
        "startLoc": {
          "line": 119,
          "column": 2,
          "position": 1310
        },
        "endLoc": {
          "line": 125,
          "column": 9,
          "position": 1412
        }
      }
    },
    {
      "format": "typescript",
      "lines": 12,
      "fragment": ", async () => {\n    const fetchSpy = vi.spyOn(globalThis, \"fetch\").mockResolvedValue(\n      new Response(JSON.stringify({ data: [] }), {\n        status: 200,\n        headers: { \"content-type\": \"application/json\" },\n      }),\n    );\n\n    try {\n      await tinybirdSql(\n        { apiUrl: \"https://api.example.tinybird.co\", token: \"tb_token\" },\n        \"SELECT 1 FORMAT JSON\"",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/tinybird-sql-client.test.ts",
        "start": 33,
        "end": 44,
        "startLoc": {
          "line": 33,
          "column": 53,
          "position": 354
        },
        "endLoc": {
          "line": 44,
          "column": 23,
          "position": 468
        }
      },
      "secondFile": {
        "name": "apps/web/tests/tinybird-sql-client.test.ts",
        "start": 6,
        "end": 15,
        "startLoc": {
          "line": 6,
          "column": 32,
          "position": 53
        },
        "endLoc": {
          "line": 15,
          "column": 11,
          "position": 164
        }
      }
    },
    {
      "format": "typescript",
      "lines": 9,
      "fragment": ", async () => {\n      vi.resetModules();\n      process.env.TINYBIRD_API_URL = \"https://api.tinybird.co\";\n      process.env.TINYBIRD_ADMIN_TOKEN = \"p.token123\";\n\n      global.fetch = vi.fn().mockResolvedValue({\n        ok: true,\n        status: 200,\n        text: () => Promise.resolve(JSON",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/tinybird-client.test.ts",
        "start": 141,
        "end": 149,
        "startLoc": {
          "line": 141,
          "column": 35,
          "position": 1514
        },
        "endLoc": {
          "line": 149,
          "column": 5,
          "position": 1602
        }
      },
      "secondFile": {
        "name": "apps/web/tests/tinybird-client.test.ts",
        "start": 124,
        "end": 132,
        "startLoc": {
          "line": 124,
          "column": 41,
          "position": 1345
        },
        "endLoc": {
          "line": 132,
          "column": 11,
          "position": 1433
        }
      }
    },
    {
      "format": "typescript",
      "lines": 11,
      "fragment": ", async () => {\n      vi.resetModules();\n      process.env.TINYBIRD_API_URL = \"https://api.tinybird.co\";\n      process.env.TINYBIRD_ADMIN_TOKEN = \"p.token123\";\n\n      global.fetch = vi.fn().mockResolvedValue({\n        ok: true,\n        text: () => Promise.resolve(JSON.stringify({ data: [] })),\n      });\n\n      const { tinybirdSql",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/tinybird-client.test.ts",
        "start": 188,
        "end": 198,
        "startLoc": {
          "line": 188,
          "column": 39,
          "position": 2009
        },
        "endLoc": {
          "line": 198,
          "column": 12,
          "position": 2118
        }
      },
      "secondFile": {
        "name": "apps/web/tests/tinybird-client.test.ts",
        "start": 88,
        "end": 98,
        "startLoc": {
          "line": 88,
          "column": 39,
          "position": 931
        },
        "endLoc": {
          "line": 98,
          "column": 13,
          "position": 1040
        }
      }
    },
    {
      "format": "typescript",
      "lines": 13,
      "fragment": ", async () => {\n      vi.resetModules();\n      process.env.TINYBIRD_API_URL = \"https://api.tinybird.co\";\n      process.env.TINYBIRD_ADMIN_TOKEN = \"p.token123\";\n\n      global.fetch = vi.fn().mockResolvedValue({\n        ok: true,\n        text: () => Promise.resolve(JSON.stringify({ data: [] })),\n      });\n\n      const { tinybirdSql, createTinybirdClientFromEnv } = await import(\"../lib/tinybird/client\");\n      const client = createTinybirdClientFromEnv();\n      await tinybirdSql(client, \"SELECT count() FROM events FORMAT JSONEachRow\"",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/tinybird-client.test.ts",
        "start": 207,
        "end": 219,
        "startLoc": {
          "line": 207,
          "column": 51,
          "position": 2238
        },
        "endLoc": {
          "line": 219,
          "column": 48,
          "position": 2384
        }
      },
      "secondFile": {
        "name": "apps/web/tests/tinybird-client.test.ts",
        "start": 88,
        "end": 200,
        "startLoc": {
          "line": 88,
          "column": 39,
          "position": 931
        },
        "endLoc": {
          "line": 200,
          "column": 29,
          "position": 2155
        }
      }
    },
    {
      "format": "typescript",
      "lines": 13,
      "fragment": ", async () => {\n      vi.resetModules();\n      process.env.TINYBIRD_API_URL = \"https://api.tinybird.co\";\n      process.env.TINYBIRD_ADMIN_TOKEN = \"p.token123\";\n\n      global.fetch = vi.fn().mockResolvedValue({\n        ok: true,\n        text: () => Promise.resolve(JSON.stringify({ data: [] })),\n      });\n\n      const { tinybirdSql, createTinybirdClientFromEnv } = await import(\"../lib/tinybird/client\");\n      const client = createTinybirdClientFromEnv();\n      await tinybirdSql(client, \"SELECT count() FROM events;  \"",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/tinybird-client.test.ts",
        "start": 228,
        "end": 240,
        "startLoc": {
          "line": 228,
          "column": 40,
          "position": 2498
        },
        "endLoc": {
          "line": 240,
          "column": 32,
          "position": 2644
        }
      },
      "secondFile": {
        "name": "apps/web/tests/tinybird-client.test.ts",
        "start": 88,
        "end": 200,
        "startLoc": {
          "line": 88,
          "column": 39,
          "position": 931
        },
        "endLoc": {
          "line": 200,
          "column": 29,
          "position": 2155
        }
      }
    },
    {
      "format": "typescript",
      "lines": 6,
      "fragment": ");\n\n      const [, options] = (fetch as ReturnType<typeof vi.fn>).mock.calls[0];\n      const bodyParams = new URLSearchParams(options.body);\n      const query = bodyParams.get(\"q\");\n      expect(query).not",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/tinybird-client.test.ts",
        "start": 240,
        "end": 245,
        "startLoc": {
          "line": 240,
          "column": 32,
          "position": 2645
        },
        "endLoc": {
          "line": 245,
          "column": 4,
          "position": 2721
        }
      },
      "secondFile": {
        "name": "apps/web/tests/tinybird-client.test.ts",
        "start": 219,
        "end": 224,
        "startLoc": {
          "line": 219,
          "column": 48,
          "position": 2385
        },
        "endLoc": {
          "line": 224,
          "column": 10,
          "position": 2461
        }
      }
    },
    {
      "format": "typescript",
      "lines": 11,
      "fragment": ");\n    });\n\n    it(\"throws on non-ok response\", async () => {\n      vi.resetModules();\n      process.env.TINYBIRD_API_URL = \"https://api.tinybird.co\";\n      process.env.TINYBIRD_ADMIN_TOKEN = \"p.token123\";\n\n      global.fetch = vi.fn().mockResolvedValue({\n        ok: false,\n        status: 500",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/tinybird-client.test.ts",
        "start": 245,
        "end": 255,
        "startLoc": {
          "line": 245,
          "column": 4,
          "position": 2726
        },
        "endLoc": {
          "line": 255,
          "column": 4,
          "position": 2811
        }
      },
      "secondFile": {
        "name": "apps/web/tests/tinybird-client.test.ts",
        "start": 104,
        "end": 114,
        "startLoc": {
          "line": 104,
          "column": 11,
          "position": 1151
        },
        "endLoc": {
          "line": 114,
          "column": 4,
          "position": 1236
        }
      }
    },
    {
      "format": "typescript",
      "lines": 12,
      "fragment": ");\n    });\n\n    it(\"throws when response is not valid JSON\", async () => {\n      vi.resetModules();\n      process.env.TINYBIRD_API_URL = \"https://api.tinybird.co\";\n      process.env.TINYBIRD_ADMIN_TOKEN = \"p.token123\";\n\n      global.fetch = vi.fn().mockResolvedValue({\n        ok: true,\n        status: 200,\n        text: () => Promise.resolve(\"invalid json {\"",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/tinybird-client.test.ts",
        "start": 264,
        "end": 275,
        "startLoc": {
          "line": 264,
          "column": 7,
          "position": 2896
        },
        "endLoc": {
          "line": 275,
          "column": 17,
          "position": 2997
        }
      },
      "secondFile": {
        "name": "apps/web/tests/tinybird-client.test.ts",
        "start": 121,
        "end": 132,
        "startLoc": {
          "line": 121,
          "column": 50,
          "position": 1332
        },
        "endLoc": {
          "line": 132,
          "column": 11,
          "position": 1433
        }
      }
    },
    {
      "format": "typescript",
      "lines": 9,
      "fragment": ", async () => {\n      vi.resetModules();\n      process.env.TINYBIRD_API_URL = \"https://api.tinybird.co\";\n      process.env.TINYBIRD_ADMIN_TOKEN = \"p.token123\";\n\n      global.fetch = vi.fn().mockResolvedValue({\n        ok: false,\n        status: 400,\n        text: () => Promise.resolve(JSON.stringify({ error: \"Syntax error in query\"",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/tinybird-client.test.ts",
        "start": 284,
        "end": 292,
        "startLoc": {
          "line": 284,
          "column": 52,
          "position": 3074
        },
        "endLoc": {
          "line": 292,
          "column": 24,
          "position": 3171
        }
      },
      "secondFile": {
        "name": "apps/web/tests/tinybird-client.test.ts",
        "start": 107,
        "end": 115,
        "startLoc": {
          "line": 107,
          "column": 28,
          "position": 1164
        },
        "endLoc": {
          "line": 115,
          "column": 14,
          "position": 1261
        }
      }
    },
    {
      "format": "typescript",
      "lines": 13,
      "fragment": ": ReturnType<typeof vi.fn> | undefined;\n\nvi.mock(\"../lib/db/client\", () => ({\n  db: {\n    select: (...args: unknown[]) => {\n      if (!selectSpy) throw new Error(\"selectSpy not initialized\");\n      return selectSpy(...args);\n    },\n    update: (...args: unknown[]) => {\n      if (!updateSpy) throw new Error(\"updateSpy not initialized\");\n      return updateSpy(...args);\n    },\n  }",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/stripe-webhook-handlers.test.ts",
        "start": 5,
        "end": 17,
        "startLoc": {
          "line": 5,
          "column": 10,
          "position": 60
        },
        "endLoc": {
          "line": 17,
          "column": 2,
          "position": 199
        }
      },
      "secondFile": {
        "name": "apps/web/tests/users-queries.test.ts",
        "start": 5,
        "end": 17,
        "startLoc": {
          "line": 5,
          "column": 10,
          "position": 64
        },
        "endLoc": {
          "line": 17,
          "column": 7,
          "position": 203
        }
      }
    },
    {
      "format": "typescript",
      "lines": 7,
      "fragment": "}));\n\n  const whereUpdateSpy = vi.fn().mockResolvedValue(undefined);\n  const setSpy = vi.fn(() => ({ where: whereUpdateSpy }));\n  updateSpy = vi.fn(() => ({ set: setSpy }));\n\n  return",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/stripe-webhook-handlers.test.ts",
        "start": 52,
        "end": 58,
        "startLoc": {
          "line": 52,
          "column": 2,
          "position": 523
        },
        "endLoc": {
          "line": 58,
          "column": 7,
          "position": 606
        }
      },
      "secondFile": {
        "name": "apps/web/tests/users-queries.test.ts",
        "start": 31,
        "end": 36,
        "startLoc": {
          "line": 31,
          "column": 2,
          "position": 390
        },
        "endLoc": {
          "line": 36,
          "column": 10,
          "position": 472
        }
      }
    },
    {
      "format": "typescript",
      "lines": 7,
      "fragment": ", async () => {\n    vi.resetModules();\n    const stripe = new Stripe(process.env.STRIPE_SECRET_KEY!, { apiVersion: \"2025-12-15.clover\" });\n    const now = Math.floor(Date.now() / 1000);\n\n    const payload = createStripeWebhookPayload({\n      eventId: \"evt_user_not_found\"",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/stripe-webhook-handlers.test.ts",
        "start": 136,
        "end": 142,
        "startLoc": {
          "line": 136,
          "column": 53,
          "position": 1385
        },
        "endLoc": {
          "line": 142,
          "column": 21,
          "position": 1473
        }
      },
      "secondFile": {
        "name": "apps/web/tests/stripe-webhook-handlers.test.ts",
        "start": 110,
        "end": 116,
        "startLoc": {
          "line": 110,
          "column": 42,
          "position": 1131
        },
        "endLoc": {
          "line": 116,
          "column": 18,
          "position": 1219
        }
      }
    },
    {
      "format": "typescript",
      "lines": 18,
      "fragment": ", status: \"active\" },\n    });\n\n    const signature = stripe.webhooks.generateTestHeaderString({\n      payload,\n      secret: process.env.STRIPE_WEBHOOK_SECRET!,\n      timestamp: now,\n    });\n\n    setupDbMocks(null);\n\n    const { POST } = await import(\"../app/api/webhooks/stripe/route\");\n    const response = await POST(createTestRequest(payload, signature));\n\n    expect(response.status).toBe(200);\n  });\n\n  it(\"ignores duplicate events with same event ID\"",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/stripe-webhook-handlers.test.ts",
        "start": 145,
        "end": 162,
        "startLoc": {
          "line": 145,
          "column": 14,
          "position": 1512
        },
        "endLoc": {
          "line": 162,
          "column": 46,
          "position": 1644
        }
      },
      "secondFile": {
        "name": "apps/web/tests/stripe-webhook-handlers.test.ts",
        "start": 119,
        "end": 136,
        "startLoc": {
          "line": 119,
          "column": 15,
          "position": 1252
        },
        "endLoc": {
          "line": 136,
          "column": 53,
          "position": 1384
        }
      }
    },
    {
      "format": "typescript",
      "lines": 7,
      "fragment": ", async () => {\n    vi.resetModules();\n    const stripe = new Stripe(process.env.STRIPE_SECRET_KEY!, { apiVersion: \"2025-12-15.clover\" });\n    const now = Math.floor(Date.now() / 1000);\n\n    const payload = createStripeWebhookPayload({\n      eventId: \"evt_duplicate\"",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/stripe-webhook-handlers.test.ts",
        "start": 162,
        "end": 168,
        "startLoc": {
          "line": 162,
          "column": 46,
          "position": 1645
        },
        "endLoc": {
          "line": 168,
          "column": 16,
          "position": 1733
        }
      },
      "secondFile": {
        "name": "apps/web/tests/stripe-webhook-handlers.test.ts",
        "start": 110,
        "end": 116,
        "startLoc": {
          "line": 110,
          "column": 42,
          "position": 1131
        },
        "endLoc": {
          "line": 116,
          "column": 18,
          "position": 1219
        }
      }
    },
    {
      "format": "typescript",
      "lines": 7,
      "fragment": ", async () => {\n    vi.resetModules();\n    const stripe = new Stripe(process.env.STRIPE_SECRET_KEY!, { apiVersion: \"2025-12-15.clover\" });\n    const now = Math.floor(Date.now() / 1000);\n\n    const payload = createStripeWebhookPayload({\n      eventId: \"evt_stale\"",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/stripe-webhook-handlers.test.ts",
        "start": 202,
        "end": 208,
        "startLoc": {
          "line": 202,
          "column": 54,
          "position": 2009
        },
        "endLoc": {
          "line": 208,
          "column": 12,
          "position": 2097
        }
      },
      "secondFile": {
        "name": "apps/web/tests/stripe-webhook-handlers.test.ts",
        "start": 110,
        "end": 116,
        "startLoc": {
          "line": 110,
          "column": 42,
          "position": 1131
        },
        "endLoc": {
          "line": 116,
          "column": 18,
          "position": 1219
        }
      }
    },
    {
      "format": "typescript",
      "lines": 21,
      "fragment": ",\n      data: {\n        id: \"sub_123\",\n        object: \"subscription\",\n        customer: \"cus_123\",\n        status: \"active\",\n        items: { data: [{ price: { id: \"price_pro_123\" } }] },\n      },\n    });\n\n    const signature = stripe.webhooks.generateTestHeaderString({\n      payload,\n      secret: process.env.STRIPE_WEBHOOK_SECRET!,\n      timestamp: now,\n    });\n\n    setupDbMocks({\n      id: \"u1\",\n      plan: \"pro\",\n      stripeCustomerId: \"cus_123\",\n      stripeLastWebhookEventId: \"evt_previous\"",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/stripe-webhook-handlers.test.ts",
        "start": 210,
        "end": 230,
        "startLoc": {
          "line": 210,
          "column": 5,
          "position": 2116
        },
        "endLoc": {
          "line": 230,
          "column": 15,
          "position": 2266
        }
      },
      "secondFile": {
        "name": "apps/web/tests/stripe-webhook-handlers.test.ts",
        "start": 170,
        "end": 190,
        "startLoc": {
          "line": 170,
          "column": 4,
          "position": 1748
        },
        "endLoc": {
          "line": 190,
          "column": 16,
          "position": 1898
        }
      }
    },
    {
      "format": "typescript",
      "lines": 12,
      "fragment": ",\n    });\n\n    const { POST } = await import(\"../app/api/webhooks/stripe/route\");\n    const response = await POST(createTestRequest(payload, signature));\n\n    expect(response.status).toBe(200);\n    const body = await response.json();\n    expect(body.ignored).toBe(true);\n  });\n\n  it(\"handles checkout.session.completed with subscription ID\"",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/stripe-webhook-handlers.test.ts",
        "start": 231,
        "end": 242,
        "startLoc": {
          "line": 231,
          "column": 2,
          "position": 2277
        },
        "endLoc": {
          "line": 242,
          "column": 58,
          "position": 2379
        }
      },
      "secondFile": {
        "name": "apps/web/tests/stripe-webhook-handlers.test.ts",
        "start": 191,
        "end": 202,
        "startLoc": {
          "line": 191,
          "column": 5,
          "position": 1906
        },
        "endLoc": {
          "line": 202,
          "column": 54,
          "position": 2008
        }
      }
    },
    {
      "format": "typescript",
      "lines": 7,
      "fragment": ", async () => {\n    vi.resetModules();\n    const stripe = new Stripe(process.env.STRIPE_SECRET_KEY!, { apiVersion: \"2025-12-15.clover\" });\n    const now = Math.floor(Date.now() / 1000);\n\n    const payload = createStripeWebhookPayload({\n      eventId: \"evt_checkout\"",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/stripe-webhook-handlers.test.ts",
        "start": 242,
        "end": 248,
        "startLoc": {
          "line": 242,
          "column": 58,
          "position": 2380
        },
        "endLoc": {
          "line": 248,
          "column": 15,
          "position": 2468
        }
      },
      "secondFile": {
        "name": "apps/web/tests/stripe-webhook-handlers.test.ts",
        "start": 110,
        "end": 116,
        "startLoc": {
          "line": 110,
          "column": 42,
          "position": 1131
        },
        "endLoc": {
          "line": 116,
          "column": 18,
          "position": 1219
        }
      }
    },
    {
      "format": "typescript",
      "lines": 7,
      "fragment": ", async () => {\n    vi.resetModules();\n    const stripe = new Stripe(process.env.STRIPE_SECRET_KEY!, { apiVersion: \"2025-12-15.clover\" });\n    const now = Math.floor(Date.now() / 1000);\n\n    const payload = createStripeWebhookPayload({\n      eventId: \"evt_checkout_no_sub\"",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/stripe-webhook-handlers.test.ts",
        "start": 285,
        "end": 291,
        "startLoc": {
          "line": 285,
          "column": 61,
          "position": 2733
        },
        "endLoc": {
          "line": 291,
          "column": 22,
          "position": 2821
        }
      },
      "secondFile": {
        "name": "apps/web/tests/stripe-webhook-handlers.test.ts",
        "start": 110,
        "end": 116,
        "startLoc": {
          "line": 110,
          "column": 42,
          "position": 1131
        },
        "endLoc": {
          "line": 116,
          "column": 18,
          "position": 1219
        }
      }
    },
    {
      "format": "typescript",
      "lines": 23,
      "fragment": ",\n      },\n    });\n\n    const signature = stripe.webhooks.generateTestHeaderString({\n      payload,\n      secret: process.env.STRIPE_WEBHOOK_SECRET!,\n      timestamp: now,\n    });\n\n    const { setSpy } = setupDbMocks({\n      id: \"u1\",\n      plan: \"free\",\n      stripeCustomerId: \"cus_123\",\n      stripeLastWebhookEventId: null,\n      stripeLastWebhookEventCreated: null,\n    });\n\n    const { POST } = await import(\"../app/api/webhooks/stripe/route\");\n    const response = await POST(createTestRequest(payload, signature));\n\n    expect(response.status).toBe(200);\n    expect(setSpy).not",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/stripe-webhook-handlers.test.ts",
        "start": 297,
        "end": 319,
        "startLoc": {
          "line": 297,
          "column": 10,
          "position": 2863
        },
        "endLoc": {
          "line": 319,
          "column": 4,
          "position": 3036
        }
      },
      "secondFile": {
        "name": "apps/web/tests/stripe-webhook-handlers.test.ts",
        "start": 255,
        "end": 277,
        "startLoc": {
          "line": 255,
          "column": 14,
          "position": 2517
        },
        "endLoc": {
          "line": 277,
          "column": 21,
          "position": 2690
        }
      }
    },
    {
      "format": "typescript",
      "lines": 7,
      "fragment": ", async () => {\n    vi.resetModules();\n    const stripe = new Stripe(process.env.STRIPE_SECRET_KEY!, { apiVersion: \"2025-12-15.clover\" });\n    const now = Math.floor(Date.now() / 1000);\n\n    const payload = createStripeWebhookPayload({\n      eventId: \"evt_upgrade_pro\"",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/stripe-webhook-handlers.test.ts",
        "start": 322,
        "end": 328,
        "startLoc": {
          "line": 322,
          "column": 60,
          "position": 3053
        },
        "endLoc": {
          "line": 328,
          "column": 18,
          "position": 3141
        }
      },
      "secondFile": {
        "name": "apps/web/tests/stripe-webhook-handlers.test.ts",
        "start": 110,
        "end": 116,
        "startLoc": {
          "line": 110,
          "column": 42,
          "position": 1131
        },
        "endLoc": {
          "line": 116,
          "column": 18,
          "position": 1219
        }
      }
    },
    {
      "format": "typescript",
      "lines": 12,
      "fragment": ",\n        items: { data: [{ price: { id: \"price_pro_123\" } }] },\n      },\n    });\n\n    const signature = stripe.webhooks.generateTestHeaderString({\n      payload,\n      secret: process.env.STRIPE_WEBHOOK_SECRET!,\n      timestamp: now,\n    });\n\n    const",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/stripe-webhook-handlers.test.ts",
        "start": 337,
        "end": 348,
        "startLoc": {
          "line": 337,
          "column": 3,
          "position": 3212
        },
        "endLoc": {
          "line": 348,
          "column": 6,
          "position": 3299
        }
      },
      "secondFile": {
        "name": "apps/web/tests/stripe-webhook-handlers.test.ts",
        "start": 175,
        "end": 186,
        "startLoc": {
          "line": 175,
          "column": 9,
          "position": 1782
        },
        "endLoc": {
          "line": 186,
          "column": 13,
          "position": 1869
        }
      }
    },
    {
      "format": "typescript",
      "lines": 25,
      "fragment": ",\n      },\n    });\n\n    const signature = stripe.webhooks.generateTestHeaderString({\n      payload,\n      secret: process.env.STRIPE_WEBHOOK_SECRET!,\n      timestamp: now,\n    });\n\n    const { setSpy } = setupDbMocks({\n      id: \"u1\",\n      plan: \"free\",\n      stripeCustomerId: \"cus_123\",\n      stripeLastWebhookEventId: null,\n      stripeLastWebhookEventCreated: null,\n    });\n\n    const { POST } = await import(\"../app/api/webhooks/stripe/route\");\n    const response = await POST(createTestRequest(payload, signature));\n\n    expect(response.status).toBe(200);\n    expect(setSpy).toHaveBeenCalledWith(\n      expect.objectContaining({\n        plan",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/stripe-webhook-handlers.test.ts",
        "start": 338,
        "end": 362,
        "startLoc": {
          "line": 338,
          "column": 2,
          "position": 3242
        },
        "endLoc": {
          "line": 362,
          "column": 5,
          "position": 3426
        }
      },
      "secondFile": {
        "name": "apps/web/tests/stripe-webhook-handlers.test.ts",
        "start": 255,
        "end": 279,
        "startLoc": {
          "line": 255,
          "column": 14,
          "position": 2517
        },
        "endLoc": {
          "line": 279,
          "column": 21,
          "position": 2701
        }
      }
    },
    {
      "format": "typescript",
      "lines": 7,
      "fragment": ", async () => {\n    vi.resetModules();\n    const stripe = new Stripe(process.env.STRIPE_SECRET_KEY!, { apiVersion: \"2025-12-15.clover\" });\n    const now = Math.floor(Date.now() / 1000);\n\n    const payload = createStripeWebhookPayload({\n      eventId: \"evt_upgrade_team\"",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/stripe-webhook-handlers.test.ts",
        "start": 371,
        "end": 377,
        "startLoc": {
          "line": 371,
          "column": 61,
          "position": 3479
        },
        "endLoc": {
          "line": 377,
          "column": 19,
          "position": 3567
        }
      },
      "secondFile": {
        "name": "apps/web/tests/stripe-webhook-handlers.test.ts",
        "start": 110,
        "end": 116,
        "startLoc": {
          "line": 110,
          "column": 42,
          "position": 1131
        },
        "endLoc": {
          "line": 116,
          "column": 18,
          "position": 1219
        }
      }
    },
    {
      "format": "typescript",
      "lines": 11,
      "fragment": ",\n      eventType: \"customer.subscription.updated\",\n      created: now,\n      data: {\n        id: \"sub_123\",\n        object: \"subscription\",\n        customer: \"cus_123\",\n        status: \"active\",\n        cancel_at_period_end: false,\n        current_period_end: now + 86400 * 30,\n        items: { data: [{ price: { id: \"price_team_123\"",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/stripe-webhook-handlers.test.ts",
        "start": 377,
        "end": 387,
        "startLoc": {
          "line": 377,
          "column": 19,
          "position": 3568
        },
        "endLoc": {
          "line": 387,
          "column": 17,
          "position": 3660
        }
      },
      "secondFile": {
        "name": "apps/web/tests/stripe-webhook-handlers.test.ts",
        "start": 328,
        "end": 338,
        "startLoc": {
          "line": 328,
          "column": 18,
          "position": 3142
        },
        "endLoc": {
          "line": 338,
          "column": 16,
          "position": 3234
        }
      }
    },
    {
      "format": "typescript",
      "lines": 13,
      "fragment": "} }] },\n      },\n    });\n\n    const signature = stripe.webhooks.generateTestHeaderString({\n      payload,\n      secret: process.env.STRIPE_WEBHOOK_SECRET!,\n      timestamp: now,\n    });\n\n    const { setSpy } = setupDbMocks({\n      id: \"u1\",\n      plan: \"pro\"",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/stripe-webhook-handlers.test.ts",
        "start": 387,
        "end": 399,
        "startLoc": {
          "line": 387,
          "column": 2,
          "position": 3662
        },
        "endLoc": {
          "line": 399,
          "column": 6,
          "position": 3750
        }
      },
      "secondFile": {
        "name": "apps/web/tests/stripe-webhook-handlers.test.ts",
        "start": 338,
        "end": 350,
        "startLoc": {
          "line": 338,
          "column": 2,
          "position": 3236
        },
        "endLoc": {
          "line": 350,
          "column": 7,
          "position": 3324
        }
      }
    },
    {
      "format": "typescript",
      "lines": 13,
      "fragment": ",\n      stripeCustomerId: \"cus_123\",\n      stripeLastWebhookEventId: null,\n      stripeLastWebhookEventCreated: null,\n    });\n\n    const { POST } = await import(\"../app/api/webhooks/stripe/route\");\n    const response = await POST(createTestRequest(payload, signature));\n\n    expect(response.status).toBe(200);\n    expect(setSpy).toHaveBeenCalledWith(\n      expect.objectContaining({\n        plan: \"team\"",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/stripe-webhook-handlers.test.ts",
        "start": 399,
        "end": 411,
        "startLoc": {
          "line": 399,
          "column": 6,
          "position": 3751
        },
        "endLoc": {
          "line": 411,
          "column": 7,
          "position": 3855
        }
      },
      "secondFile": {
        "name": "apps/web/tests/stripe-webhook-handlers.test.ts",
        "start": 267,
        "end": 362,
        "startLoc": {
          "line": 267,
          "column": 7,
          "position": 2600
        },
        "endLoc": {
          "line": 362,
          "column": 6,
          "position": 3429
        }
      }
    },
    {
      "format": "typescript",
      "lines": 7,
      "fragment": ", async () => {\n    vi.resetModules();\n    const stripe = new Stripe(process.env.STRIPE_SECRET_KEY!, { apiVersion: \"2025-12-15.clover\" });\n    const now = Math.floor(Date.now() / 1000);\n\n    const payload = createStripeWebhookPayload({\n      eventId: \"evt_deleted\"",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/stripe-webhook-handlers.test.ts",
        "start": 418,
        "end": 424,
        "startLoc": {
          "line": 418,
          "column": 63,
          "position": 3891
        },
        "endLoc": {
          "line": 424,
          "column": 14,
          "position": 3979
        }
      },
      "secondFile": {
        "name": "apps/web/tests/stripe-webhook-handlers.test.ts",
        "start": 110,
        "end": 116,
        "startLoc": {
          "line": 110,
          "column": 42,
          "position": 1131
        },
        "endLoc": {
          "line": 116,
          "column": 18,
          "position": 1219
        }
      }
    },
    {
      "format": "typescript",
      "lines": 25,
      "fragment": ",\n      },\n    });\n\n    const signature = stripe.webhooks.generateTestHeaderString({\n      payload,\n      secret: process.env.STRIPE_WEBHOOK_SECRET!,\n      timestamp: now,\n    });\n\n    const { setSpy } = setupDbMocks({\n      id: \"u1\",\n      plan: \"pro\",\n      stripeCustomerId: \"cus_123\",\n      stripeLastWebhookEventId: null,\n      stripeLastWebhookEventCreated: null,\n    });\n\n    const { POST } = await import(\"../app/api/webhooks/stripe/route\");\n    const response = await POST(createTestRequest(payload, signature));\n\n    expect(response.status).toBe(200);\n    expect(setSpy).toHaveBeenCalledWith(\n      expect.objectContaining({\n        plan: \"free\"",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/stripe-webhook-handlers.test.ts",
        "start": 431,
        "end": 455,
        "startLoc": {
          "line": 431,
          "column": 11,
          "position": 4028
        },
        "endLoc": {
          "line": 455,
          "column": 7,
          "position": 4215
        }
      },
      "secondFile": {
        "name": "apps/web/tests/stripe-webhook-handlers.test.ts",
        "start": 387,
        "end": 362,
        "startLoc": {
          "line": 387,
          "column": 2,
          "position": 3668
        },
        "endLoc": {
          "line": 362,
          "column": 6,
          "position": 3429
        }
      }
    },
    {
      "format": "typescript",
      "lines": 7,
      "fragment": ", async () => {\n    vi.resetModules();\n    const stripe = new Stripe(process.env.STRIPE_SECRET_KEY!, { apiVersion: \"2025-12-15.clover\" });\n    const now = Math.floor(Date.now() / 1000);\n\n    const payload = createStripeWebhookPayload({\n      eventId: \"evt_payment_failed\"",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/stripe-webhook-handlers.test.ts",
        "start": 462,
        "end": 468,
        "startLoc": {
          "line": 462,
          "column": 61,
          "position": 4251
        },
        "endLoc": {
          "line": 468,
          "column": 21,
          "position": 4339
        }
      },
      "secondFile": {
        "name": "apps/web/tests/stripe-webhook-handlers.test.ts",
        "start": 110,
        "end": 116,
        "startLoc": {
          "line": 110,
          "column": 42,
          "position": 1131
        },
        "endLoc": {
          "line": 116,
          "column": 18,
          "position": 1219
        }
      }
    },
    {
      "format": "typescript",
      "lines": 25,
      "fragment": ",\n      },\n    });\n\n    const signature = stripe.webhooks.generateTestHeaderString({\n      payload,\n      secret: process.env.STRIPE_WEBHOOK_SECRET!,\n      timestamp: now,\n    });\n\n    const { setSpy } = setupDbMocks({\n      id: \"u1\",\n      plan: \"pro\",\n      stripeCustomerId: \"cus_123\",\n      stripeLastWebhookEventId: null,\n      stripeLastWebhookEventCreated: null,\n    });\n\n    const { POST } = await import(\"../app/api/webhooks/stripe/route\");\n    const response = await POST(createTestRequest(payload, signature));\n\n    expect(response.status).toBe(200);\n    expect(setSpy).toHaveBeenCalledWith(\n      expect.objectContaining({\n        stripeSubscriptionId: \"sub_123\"",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/stripe-webhook-handlers.test.ts",
        "start": 475,
        "end": 499,
        "startLoc": {
          "line": 475,
          "column": 10,
          "position": 4388
        },
        "endLoc": {
          "line": 499,
          "column": 10,
          "position": 4575
        }
      },
      "secondFile": {
        "name": "apps/web/tests/stripe-webhook-handlers.test.ts",
        "start": 387,
        "end": 279,
        "startLoc": {
          "line": 387,
          "column": 2,
          "position": 3668
        },
        "endLoc": {
          "line": 279,
          "column": 14,
          "position": 2704
        }
      }
    },
    {
      "format": "typescript",
      "lines": 7,
      "fragment": ", async () => {\n    vi.resetModules();\n    const stripe = new Stripe(process.env.STRIPE_SECRET_KEY!, { apiVersion: \"2025-12-15.clover\" });\n    const now = Math.floor(Date.now() / 1000);\n\n    const payload = createStripeWebhookPayload({\n      eventId: \"evt_unhandled\"",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/stripe-webhook-handlers.test.ts",
        "start": 506,
        "end": 512,
        "startLoc": {
          "line": 506,
          "column": 43,
          "position": 4611
        },
        "endLoc": {
          "line": 512,
          "column": 16,
          "position": 4699
        }
      },
      "secondFile": {
        "name": "apps/web/tests/stripe-webhook-handlers.test.ts",
        "start": 110,
        "end": 116,
        "startLoc": {
          "line": 110,
          "column": 42,
          "position": 1131
        },
        "endLoc": {
          "line": 116,
          "column": 18,
          "position": 1219
        }
      }
    },
    {
      "format": "typescript",
      "lines": 14,
      "fragment": ",\n        customer: \"cus_123\",\n      },\n    });\n\n    const signature = stripe.webhooks.generateTestHeaderString({\n      payload,\n      secret: process.env.STRIPE_WEBHOOK_SECRET!,\n      timestamp: now,\n    });\n\n    const { setSpy } = setupDbMocks({\n      id: \"u1\",\n      plan: \"pro\"",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/stripe-webhook-handlers.test.ts",
        "start": 517,
        "end": 530,
        "startLoc": {
          "line": 517,
          "column": 11,
          "position": 4734
        },
        "endLoc": {
          "line": 530,
          "column": 6,
          "position": 4823
        }
      },
      "secondFile": {
        "name": "apps/web/tests/stripe-webhook-handlers.test.ts",
        "start": 296,
        "end": 309,
        "startLoc": {
          "line": 296,
          "column": 19,
          "position": 2856
        },
        "endLoc": {
          "line": 309,
          "column": 7,
          "position": 2945
        }
      }
    },
    {
      "format": "typescript",
      "lines": 26,
      "fragment": ",\n      },\n    });\n\n    const signature = stripe.webhooks.generateTestHeaderString({\n      payload,\n      secret: process.env.STRIPE_WEBHOOK_SECRET!,\n      timestamp: now,\n    });\n\n    const { setSpy } = setupDbMocks({\n      id: \"u1\",\n      plan: \"pro\",\n      stripeCustomerId: \"cus_123\",\n      stripeLastWebhookEventId: null,\n      stripeLastWebhookEventCreated: null,\n    });\n\n    const { POST } = await import(\"../app/api/webhooks/stripe/route\");\n    const response = await POST(createTestRequest(payload, signature));\n\n    expect(response.status).toBe(200);\n    expect(setSpy).not.toHaveBeenCalled();\n  });\n\n  it(\"handles expanded customer object with nested id\"",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/stripe-webhook-handlers.test.ts",
        "start": 518,
        "end": 543,
        "startLoc": {
          "line": 518,
          "column": 10,
          "position": 4741
        },
        "endLoc": {
          "line": 543,
          "column": 50,
          "position": 4930
        }
      },
      "secondFile": {
        "name": "apps/web/tests/stripe-webhook-handlers.test.ts",
        "start": 387,
        "end": 322,
        "startLoc": {
          "line": 387,
          "column": 2,
          "position": 3668
        },
        "endLoc": {
          "line": 322,
          "column": 60,
          "position": 3052
        }
      }
    },
    {
      "format": "typescript",
      "lines": 7,
      "fragment": ", async () => {\n    vi.resetModules();\n    const stripe = new Stripe(process.env.STRIPE_SECRET_KEY!, { apiVersion: \"2025-12-15.clover\" });\n    const now = Math.floor(Date.now() / 1000);\n\n    const payload = createStripeWebhookPayload({\n      eventId: \"evt_expanded_customer\"",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/stripe-webhook-handlers.test.ts",
        "start": 543,
        "end": 549,
        "startLoc": {
          "line": 543,
          "column": 50,
          "position": 4931
        },
        "endLoc": {
          "line": 549,
          "column": 24,
          "position": 5019
        }
      },
      "secondFile": {
        "name": "apps/web/tests/stripe-webhook-handlers.test.ts",
        "start": 110,
        "end": 116,
        "startLoc": {
          "line": 110,
          "column": 42,
          "position": 1131
        },
        "endLoc": {
          "line": 116,
          "column": 18,
          "position": 1219
        }
      }
    },
    {
      "format": "typescript",
      "lines": 15,
      "fragment": ",\n        status: \"canceled\",\n      },\n    });\n\n    const signature = stripe.webhooks.generateTestHeaderString({\n      payload,\n      secret: process.env.STRIPE_WEBHOOK_SECRET!,\n      timestamp: now,\n    });\n\n    const { setSpy } = setupDbMocks({\n      id: \"u1\",\n      plan: \"pro\",\n      stripeCustomerId: \"cus_nested\"",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/stripe-webhook-handlers.test.ts",
        "start": 555,
        "end": 569,
        "startLoc": {
          "line": 555,
          "column": 2,
          "position": 5074
        },
        "endLoc": {
          "line": 569,
          "column": 13,
          "position": 5170
        }
      },
      "secondFile": {
        "name": "apps/web/tests/stripe-webhook-handlers.test.ts",
        "start": 430,
        "end": 400,
        "startLoc": {
          "line": 430,
          "column": 10,
          "position": 4021
        },
        "endLoc": {
          "line": 400,
          "column": 10,
          "position": 3757
        }
      }
    },
    {
      "format": "typescript",
      "lines": 10,
      "fragment": ",\n      stripeLastWebhookEventId: null,\n      stripeLastWebhookEventCreated: null,\n    });\n\n    const { POST } = await import(\"../app/api/webhooks/stripe/route\");\n    const response = await POST(createTestRequest(payload, signature));\n\n    expect(response.status).toBe(200);\n    expect(setSpy).toHaveBeenCalledWith(expect.objectContaining({ plan: \"free\" }",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/stripe-webhook-handlers.test.ts",
        "start": 569,
        "end": 578,
        "startLoc": {
          "line": 569,
          "column": 13,
          "position": 5171
        },
        "endLoc": {
          "line": 578,
          "column": 2,
          "position": 5267
        }
      },
      "secondFile": {
        "name": "apps/web/tests/stripe-webhook-handlers.test.ts",
        "start": 268,
        "end": 455,
        "startLoc": {
          "line": 268,
          "column": 10,
          "position": 2607
        },
        "endLoc": {
          "line": 455,
          "column": 2,
          "position": 4216
        }
      }
    },
    {
      "format": "typescript",
      "lines": 26,
      "fragment": ",\n        items: { data: [{ price: { id: \"price_pro_123\" } }] },\n      },\n    });\n\n    const signature = stripe.webhooks.generateTestHeaderString({\n      payload,\n      secret: process.env.STRIPE_WEBHOOK_SECRET!,\n      timestamp: now,\n    });\n\n    const { setSpy } = setupDbMocks({\n      id: \"u1\",\n      plan: \"pro\",\n      stripeCustomerId: \"cus_123\",\n      stripeLastWebhookEventId: null,\n      stripeLastWebhookEventCreated: null,\n    });\n\n    const { POST } = await import(\"../app/api/webhooks/stripe/route\");\n    const response = await POST(createTestRequest(payload, signature));\n\n    expect(response.status).toBe(200);\n    expect(setSpy).toHaveBeenCalledWith(\n      expect.objectContaining({\n        stripeCancelAtPeriodEnd",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/stripe-webhook-handlers.test.ts",
        "start": 598,
        "end": 623,
        "startLoc": {
          "line": 598,
          "column": 9,
          "position": 5458
        },
        "endLoc": {
          "line": 623,
          "column": 24,
          "position": 5672
        }
      },
      "secondFile": {
        "name": "apps/web/tests/stripe-webhook-handlers.test.ts",
        "start": 175,
        "end": 279,
        "startLoc": {
          "line": 175,
          "column": 9,
          "position": 1782
        },
        "endLoc": {
          "line": 279,
          "column": 21,
          "position": 2701
        }
      }
    },
    {
      "format": "typescript",
      "lines": 19,
      "fragment": "} from \"vitest\";\n\nlet selectSpy: ReturnType<typeof vi.fn> | undefined;\nlet updateSpy: ReturnType<typeof vi.fn> | undefined;\n\nvi.mock(\"../lib/db/client\", () => ({\n  db: {\n    select: (...args: unknown[]) => {\n      if (!selectSpy) throw new Error(\"selectSpy not initialized\");\n      return selectSpy(...args);\n    },\n    update: (...args: unknown[]) => {\n      if (!updateSpy) throw new Error(\"updateSpy not initialized\");\n      return updateSpy(...args);\n    },\n  },\n}));\n\ndescribe",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/stripe-webhook-api.test.ts",
        "start": 2,
        "end": 20,
        "startLoc": {
          "line": 2,
          "column": 2,
          "position": 24
        },
        "endLoc": {
          "line": 20,
          "column": 9,
          "position": 202
        }
      },
      "secondFile": {
        "name": "apps/web/tests/stripe-webhook-handlers.test.ts",
        "start": 2,
        "end": 20,
        "startLoc": {
          "line": 2,
          "column": 2,
          "position": 30
        },
        "endLoc": {
          "line": 20,
          "column": 9,
          "position": 208
        }
      }
    },
    {
      "format": "typescript",
      "lines": 9,
      "fragment": "]);\n    const fromSpy = vi.fn(() => ({ where: whereSpy }));\n    selectSpy = vi.fn(() => ({ from: fromSpy }));\n\n    const whereUpdateSpy = vi.fn().mockResolvedValue(undefined);\n    const setSpy = vi.fn(() => ({ where: whereUpdateSpy }));\n    updateSpy = vi.fn(() => ({ set: setSpy }));\n\n    const",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/stripe-webhook-api.test.ts",
        "start": 84,
        "end": 92,
        "startLoc": {
          "line": 84,
          "column": 5,
          "position": 756
        },
        "endLoc": {
          "line": 92,
          "column": 6,
          "position": 894
        }
      },
      "secondFile": {
        "name": "apps/web/tests/stripe-webhook-handlers.test.ts",
        "start": 50,
        "end": 36,
        "startLoc": {
          "line": 50,
          "column": 2,
          "position": 468
        },
        "endLoc": {
          "line": 36,
          "column": 10,
          "position": 472
        }
      }
    },
    {
      "format": "typescript",
      "lines": 16,
      "fragment": ";\n\nvi.mock(\"../lib/db/client\", () => ({\n  db: {\n    select: (...args: unknown[]) => {\n      if (!selectSpy) throw new Error(\"selectSpy not initialized\");\n      return selectSpy(...args);\n    },\n    update: (...args: unknown[]) => {\n      if (!updateSpy) throw new Error(\"updateSpy not initialized\");\n      return updateSpy(...args);\n    },\n  },\n}));\n\nvi",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/stripe-reconcile-api.test.ts",
        "start": 14,
        "end": 29,
        "startLoc": {
          "line": 14,
          "column": 2,
          "position": 169
        },
        "endLoc": {
          "line": 29,
          "column": 3,
          "position": 303
        }
      },
      "secondFile": {
        "name": "apps/web/tests/users-queries.test.ts",
        "start": 5,
        "end": 20,
        "startLoc": {
          "line": 5,
          "column": 10,
          "position": 78
        },
        "endLoc": {
          "line": 20,
          "column": 9,
          "position": 208
        }
      }
    },
    {
      "format": "typescript",
      "lines": 9,
      "fragment": ";\n\n    validateSessionSpy = vi.fn().mockResolvedValue({ id: \"s1\", userId: \"u1\", expiresAt: new Date(Date.now() + 60_000) });\n\n    const whereSpy = vi.fn().mockResolvedValue([{ id: \"u1\", plan: \"free\", stripeCustomerId: \"cus_user\" }]);\n    const fromSpy = vi.fn(() => ({ where: whereSpy }));\n    selectSpy = vi.fn(() => ({ from: fromSpy }));\n\n    const",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/stripe-reconcile-api.test.ts",
        "start": 103,
        "end": 111,
        "startLoc": {
          "line": 103,
          "column": 17,
          "position": 1150
        },
        "endLoc": {
          "line": 111,
          "column": 6,
          "position": 1302
        }
      },
      "secondFile": {
        "name": "apps/web/tests/stripe-reconcile-api.test.ts",
        "start": 73,
        "end": 80,
        "startLoc": {
          "line": 73,
          "column": 2,
          "position": 773
        },
        "endLoc": {
          "line": 80,
          "column": 10,
          "position": 924
        }
      }
    },
    {
      "format": "typescript",
      "lines": 12,
      "fragment": "},\n    });\n\n    const { POST } = await import(\"../app/api/stripe/reconcile/route\");\n    const response = await POST(\n      new Request(\"http://localhost/api/stripe/reconcile\", {\n        method: \"POST\",\n        body: JSON.stringify({ checkout_session_id: \"cs_123\" }),\n      }),\n    );\n\n    expect(response.status).toBe(200",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/stripe-reconcile-api.test.ts",
        "start": 127,
        "end": 138,
        "startLoc": {
          "line": 127,
          "column": 7,
          "position": 1543
        },
        "endLoc": {
          "line": 138,
          "column": 4,
          "position": 1639
        }
      },
      "secondFile": {
        "name": "apps/web/tests/stripe-reconcile-api.test.ts",
        "start": 85,
        "end": 96,
        "startLoc": {
          "line": 85,
          "column": 2,
          "position": 996
        },
        "endLoc": {
          "line": 96,
          "column": 4,
          "position": 1092
        }
      }
    },
    {
      "format": "typescript",
      "lines": 16,
      "fragment": ": ReturnType<typeof vi.fn> | undefined;\n\nvi.mock(\"../lib/auth/session\", () => ({\n  validateSession: (...args: unknown[]) => {\n    if (!validateSessionSpy) throw new Error(\"validateSessionSpy not initialized\");\n    return validateSessionSpy(...args);\n  },\n}));\n\nvi.mock(\"../lib/db/client\", () => ({\n  db: {\n    select: (...args: unknown[]) => {\n      if (!selectSpy) throw new Error(\"selectSpy not initialized\");\n      return selectSpy(...args);\n    },\n  }",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/stripe-portal-api.test.ts",
        "start": 6,
        "end": 21,
        "startLoc": {
          "line": 6,
          "column": 30,
          "position": 65
        },
        "endLoc": {
          "line": 21,
          "column": 2,
          "position": 225
        }
      },
      "secondFile": {
        "name": "apps/web/tests/stripe-reconcile-api.test.ts",
        "start": 7,
        "end": 22,
        "startLoc": {
          "line": 7,
          "column": 34,
          "position": 84
        },
        "endLoc": {
          "line": 22,
          "column": 7,
          "position": 244
        }
      }
    },
    {
      "format": "typescript",
      "lines": 6,
      "fragment": ", async () => {\n    vi.resetModules();\n\n    validateSessionSpy = vi.fn().mockResolvedValue({ id: \"s1\", userId: \"u1\", expiresAt: new Date(Date.now() + 60_000) });\n\n    const whereSpy = vi.fn().mockResolvedValue([{ id: \"u1\", stripeCustomerId",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/stripe-portal-api.test.ts",
        "start": 51,
        "end": 56,
        "startLoc": {
          "line": 51,
          "column": 47,
          "position": 489
        },
        "endLoc": {
          "line": 56,
          "column": 17,
          "position": 584
        }
      },
      "secondFile": {
        "name": "apps/web/tests/stripe-reconcile-api.test.ts",
        "start": 72,
        "end": 77,
        "startLoc": {
          "line": 72,
          "column": 60,
          "position": 756
        },
        "endLoc": {
          "line": 77,
          "column": 5,
          "position": 851
        }
      }
    },
    {
      "format": "typescript",
      "lines": 7,
      "fragment": "import { describe, expect, it, vi } from \"vitest\";\n\nlet validateSessionSpy: ReturnType<typeof vi.fn> | undefined;\nlet selectSpy: ReturnType<typeof vi.fn> | undefined;\nlet updateSpy: ReturnType<typeof vi.fn> | undefined;\n\nlet stripeCustomersCreateSpy",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/stripe-checkout-api.test.ts",
        "start": 1,
        "end": 7,
        "startLoc": {
          "line": 1,
          "column": 1,
          "position": 0
        },
        "endLoc": {
          "line": 7,
          "column": 25,
          "position": 83
        }
      },
      "secondFile": {
        "name": "apps/web/tests/stripe-reconcile-api.test.ts",
        "start": 1,
        "end": 7,
        "startLoc": {
          "line": 1,
          "column": 1,
          "position": 0
        },
        "endLoc": {
          "line": 7,
          "column": 34,
          "position": 83
        }
      }
    },
    {
      "format": "typescript",
      "lines": 27,
      "fragment": ": ReturnType<typeof vi.fn> | undefined;\nlet stripePortalSessionsCreateSpy: ReturnType<typeof vi.fn> | undefined;\n\nvi.mock(\"../lib/auth/session\", () => ({\n  validateSession: (...args: unknown[]) => {\n    if (!validateSessionSpy) throw new Error(\"validateSessionSpy not initialized\");\n    return validateSessionSpy(...args);\n  },\n}));\n\nvi.mock(\"../lib/db/client\", () => ({\n  db: {\n    select: (...args: unknown[]) => {\n      if (!selectSpy) throw new Error(\"selectSpy not initialized\");\n      return selectSpy(...args);\n    },\n    update: (...args: unknown[]) => {\n      if (!updateSpy) throw new Error(\"updateSpy not initialized\");\n      return updateSpy(...args);\n    },\n  },\n}));\n\nvi.mock(\"../lib/stripe/client\", () => ({\n  STRIPE_API_VERSION: \"2025-12-15.clover\",\n  getStripe: () => ({\n    customers",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/stripe-checkout-api.test.ts",
        "start": 9,
        "end": 35,
        "startLoc": {
          "line": 9,
          "column": 32,
          "position": 122
        },
        "endLoc": {
          "line": 35,
          "column": 10,
          "position": 395
        }
      },
      "secondFile": {
        "name": "apps/web/tests/stripe-portal-api.test.ts",
        "start": 4,
        "end": 32,
        "startLoc": {
          "line": 4,
          "column": 10,
          "position": 45
        },
        "endLoc": {
          "line": 32,
          "column": 9,
          "position": 338
        }
      }
    },
    {
      "format": "typescript",
      "lines": 12,
      "fragment": "billingPortal: {\n      sessions: {\n        create: (...args: unknown[]) => {\n          if (!stripePortalSessionsCreateSpy) throw new Error(\"stripePortalSessionsCreateSpy not initialized\");\n          return stripePortalSessionsCreateSpy(...args);\n        },\n      },\n    },\n  }),\n}));\n\ndescribe(\"POST /api/stripe/checkout\"",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/stripe-checkout-api.test.ts",
        "start": 55,
        "end": 66,
        "startLoc": {
          "line": 55,
          "column": 5,
          "position": 585
        },
        "endLoc": {
          "line": 66,
          "column": 28,
          "position": 667
        }
      },
      "secondFile": {
        "name": "apps/web/tests/stripe-portal-api.test.ts",
        "start": 27,
        "end": 38,
        "startLoc": {
          "line": 27,
          "column": 5,
          "position": 269
        },
        "endLoc": {
          "line": 38,
          "column": 26,
          "position": 351
        }
      }
    },
    {
      "format": "typescript",
      "lines": 9,
      "fragment": ", () => {\n  it(\"returns 401 when unauthenticated\", async () => {\n    vi.resetModules();\n\n    validateSessionSpy = vi.fn().mockResolvedValue(null);\n    selectSpy = vi.fn();\n    updateSpy = vi.fn();\n\n    const { POST } = await import(\"../app/api/stripe/checkout/route\"",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/stripe-checkout-api.test.ts",
        "start": 66,
        "end": 74,
        "startLoc": {
          "line": 66,
          "column": 28,
          "position": 668
        },
        "endLoc": {
          "line": 74,
          "column": 35,
          "position": 758
        }
      },
      "secondFile": {
        "name": "apps/web/tests/stripe-reconcile-api.test.ts",
        "start": 43,
        "end": 51,
        "startLoc": {
          "line": 43,
          "column": 29,
          "position": 421
        },
        "endLoc": {
          "line": 51,
          "column": 36,
          "position": 511
        }
      }
    },
    {
      "format": "typescript",
      "lines": 7,
      "fragment": ", async () => {\n    vi.resetModules();\n\n    validateSessionSpy = vi.fn().mockResolvedValue({ id: \"s1\", userId: \"u1\", expiresAt: new Date(Date.now() + 60_000) });\n\n    const whereSpy = vi.fn().mockResolvedValue([\n      { id: \"u1\", email",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/stripe-checkout-api.test.ts",
        "start": 80,
        "end": 86,
        "startLoc": {
          "line": 80,
          "column": 31,
          "position": 817
        },
        "endLoc": {
          "line": 86,
          "column": 6,
          "position": 914
        }
      },
      "secondFile": {
        "name": "apps/web/tests/stripe-reconcile-api.test.ts",
        "start": 72,
        "end": 77,
        "startLoc": {
          "line": 72,
          "column": 60,
          "position": 756
        },
        "endLoc": {
          "line": 77,
          "column": 5,
          "position": 851
        }
      }
    },
    {
      "format": "typescript",
      "lines": 10,
      "fragment": ", async () => {\n    vi.resetModules();\n\n    const previousAppUrl = process.env.NEXT_PUBLIC_APP_URL;\n    process.env.NEXT_PUBLIC_APP_URL = \"http://localhost:3000\";\n\n    validateSessionSpy = vi.fn().mockResolvedValue({ id: \"s1\", userId: \"u1\", expiresAt: new Date(Date.now() + 60_000) });\n\n    const whereSpy = vi.fn().mockResolvedValue([\n      { id: \"u1\", email: \"u1@example.com\", plan: \"pro\"",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/stripe-checkout-api.test.ts",
        "start": 101,
        "end": 110,
        "startLoc": {
          "line": 101,
          "column": 57,
          "position": 1115
        },
        "endLoc": {
          "line": 110,
          "column": 6,
          "position": 1248
        }
      },
      "secondFile": {
        "name": "apps/web/tests/stripe-portal-api.test.ts",
        "start": 66,
        "end": 86,
        "startLoc": {
          "line": 66,
          "column": 37,
          "position": 725
        },
        "endLoc": {
          "line": 86,
          "column": 7,
          "position": 923
        }
      }
    },
    {
      "format": "typescript",
      "lines": 7,
      "fragment": "},\n    ]);\n    const fromSpy = vi.fn(() => ({ where: whereSpy }));\n    selectSpy = vi.fn(() => ({ from: fromSpy }));\n    updateSpy = vi.fn();\n\n    stripeSubscriptionsListSpy",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/stripe-checkout-api.test.ts",
        "start": 110,
        "end": 116,
        "startLoc": {
          "line": 110,
          "column": 2,
          "position": 1256
        },
        "endLoc": {
          "line": 116,
          "column": 27,
          "position": 1334
        }
      },
      "secondFile": {
        "name": "apps/web/tests/stripe-checkout-api.test.ts",
        "start": 86,
        "end": 93,
        "startLoc": {
          "line": 86,
          "column": 2,
          "position": 931
        },
        "endLoc": {
          "line": 93,
          "column": 6,
          "position": 1010
        }
      }
    },
    {
      "format": "typescript",
      "lines": 13,
      "fragment": ";\n    const previousPro = process.env.STRIPE_PRICE_PRO;\n    process.env.STRIPE_PRICE_PRO = \"price_pro_test\";\n\n    validateSessionSpy = vi.fn().mockResolvedValue({ id: \"s1\", userId: \"u1\", expiresAt: new Date(Date.now() + 60_000) });\n\n    const whereSpy = vi.fn().mockResolvedValue([\n      { id: \"u1\", email: \"u1@example.com\", plan: \"free\", stripeCustomerId: null },\n    ]);\n    const fromSpy = vi.fn(() => ({ where: whereSpy }));\n    selectSpy = vi.fn(() => ({ from: fromSpy }));\n\n    const",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/stripe-checkout-api.test.ts",
        "start": 140,
        "end": 152,
        "startLoc": {
          "line": 140,
          "column": 24,
          "position": 1622
        },
        "endLoc": {
          "line": 152,
          "column": 6,
          "position": 1811
        }
      },
      "secondFile": {
        "name": "apps/web/tests/stripe-reconcile-api.test.ts",
        "start": 100,
        "end": 91,
        "startLoc": {
          "line": 100,
          "column": 2,
          "position": 1123
        },
        "endLoc": {
          "line": 91,
          "column": 10,
          "position": 997
        }
      }
    },
    {
      "format": "typescript",
      "lines": 6,
      "fragment": "]);\n    const fromSpy = vi.fn(() => ({ where: whereSpy }));\n    selectSpy = vi.fn(() => ({ from: fromSpy }));\n\n    const returningSpy = vi.fn().mockResolvedValue([\n      { id",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/stripe-checkout-api.test.ts",
        "start": 148,
        "end": 153,
        "startLoc": {
          "line": 148,
          "column": 5,
          "position": 1749
        },
        "endLoc": {
          "line": 153,
          "column": 3,
          "position": 1830
        }
      },
      "secondFile": {
        "name": "apps/web/tests/stripe-reconcile-api.test.ts",
        "start": 107,
        "end": 111,
        "startLoc": {
          "line": 107,
          "column": 2,
          "position": 1240
        },
        "endLoc": {
          "line": 111,
          "column": 5,
          "position": 1319
        }
      }
    },
    {
      "format": "typescript",
      "lines": 6,
      "fragment": "]);\n    const whereUpdateSpy = vi.fn(() => ({ returning: returningSpy }));\n    const setSpy = vi.fn(() => ({ where: whereUpdateSpy }));\n    updateSpy = vi.fn(() => ({ set: setSpy }));\n\n    stripeCustomersCreateSpy",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/stripe-checkout-api.test.ts",
        "start": 154,
        "end": 159,
        "startLoc": {
          "line": 154,
          "column": 5,
          "position": 1857
        },
        "endLoc": {
          "line": 159,
          "column": 25,
          "position": 1948
        }
      },
      "secondFile": {
        "name": "apps/web/tests/stripe-reconcile-api.test.ts",
        "start": 111,
        "end": 116,
        "startLoc": {
          "line": 111,
          "column": 2,
          "position": 1331
        },
        "endLoc": {
          "line": 116,
          "column": 34,
          "position": 1422
        }
      }
    },
    {
      "format": "typescript",
      "lines": 8,
      "fragment": "});\n\n    const { POST } = await import(\"../app/api/stripe/checkout/route\");\n    const form = new FormData();\n    form.set(\"plan\", \"pro\");\n    const response = await POST(new Request(\"http://localhost/api/stripe/checkout\", { method: \"POST\", body: form }));\n\n    expect(response.status).toBe(303",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/stripe-checkout-api.test.ts",
        "start": 161,
        "end": 168,
        "startLoc": {
          "line": 161,
          "column": 2,
          "position": 2016
        },
        "endLoc": {
          "line": 168,
          "column": 4,
          "position": 2113
        }
      },
      "secondFile": {
        "name": "apps/web/tests/stripe-checkout-api.test.ts",
        "start": 119,
        "end": 126,
        "startLoc": {
          "line": 119,
          "column": 2,
          "position": 1395
        },
        "endLoc": {
          "line": 126,
          "column": 4,
          "position": 1492
        }
      }
    },
    {
      "format": "typescript",
      "lines": 66,
      "fragment": "} from \"vitest\";\n\nlet validateSessionSpy: ReturnType<typeof vi.fn> | undefined;\nlet selectSpy: ReturnType<typeof vi.fn> | undefined;\nlet updateSpy: ReturnType<typeof vi.fn> | undefined;\n\nlet stripeCustomersCreateSpy: ReturnType<typeof vi.fn> | undefined;\nlet stripeSubscriptionsListSpy: ReturnType<typeof vi.fn> | undefined;\nlet stripeCheckoutSessionsCreateSpy: ReturnType<typeof vi.fn> | undefined;\nlet stripePortalSessionsCreateSpy: ReturnType<typeof vi.fn> | undefined;\n\nvi.mock(\"../lib/auth/session\", () => ({\n  validateSession: (...args: unknown[]) => {\n    if (!validateSessionSpy) throw new Error(\"validateSessionSpy not initialized\");\n    return validateSessionSpy(...args);\n  },\n}));\n\nvi.mock(\"../lib/db/client\", () => ({\n  db: {\n    select: (...args: unknown[]) => {\n      if (!selectSpy) throw new Error(\"selectSpy not initialized\");\n      return selectSpy(...args);\n    },\n    update: (...args: unknown[]) => {\n      if (!updateSpy) throw new Error(\"updateSpy not initialized\");\n      return updateSpy(...args);\n    },\n  },\n}));\n\nvi.mock(\"../lib/stripe/client\", () => ({\n  STRIPE_API_VERSION: \"2025-12-15.clover\",\n  getStripe: () => ({\n    customers: {\n      create: (...args: unknown[]) => {\n        if (!stripeCustomersCreateSpy) throw new Error(\"stripeCustomersCreateSpy not initialized\");\n        return stripeCustomersCreateSpy(...args);\n      },\n    },\n    subscriptions: {\n      list: (...args: unknown[]) => {\n        if (!stripeSubscriptionsListSpy) throw new Error(\"stripeSubscriptionsListSpy not initialized\");\n        return stripeSubscriptionsListSpy(...args);\n      },\n    },\n    checkout: {\n      sessions: {\n        create: (...args: unknown[]) => {\n          if (!stripeCheckoutSessionsCreateSpy) throw new Error(\"stripeCheckoutSessionsCreateSpy not initialized\");\n          return stripeCheckoutSessionsCreateSpy(...args);\n        },\n      },\n    },\n    billingPortal: {\n      sessions: {\n        create: (...args: unknown[]) => {\n          if (!stripePortalSessionsCreateSpy) throw new Error(\"stripePortalSessionsCreateSpy not initialized\");\n          return stripePortalSessionsCreateSpy(...args);\n        },\n      },\n    },\n  }),\n}));\n\ndescribe(\"POST /api/stripe/checkout - additional coverage\"",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/stripe-checkout-additional.test.ts",
        "start": 1,
        "end": 66,
        "startLoc": {
          "line": 1,
          "column": 2,
          "position": 21
        },
        "endLoc": {
          "line": 66,
          "column": 50,
          "position": 673
        }
      },
      "secondFile": {
        "name": "apps/web/tests/stripe-checkout-api.test.ts",
        "start": 1,
        "end": 38,
        "startLoc": {
          "line": 1,
          "column": 2,
          "position": 15
        },
        "endLoc": {
          "line": 38,
          "column": 26,
          "position": 351
        }
      }
    },
    {
      "format": "typescript",
      "lines": 8,
      "fragment": ";\n    if (previousPricePro === undefined) delete process.env.STRIPE_PRICE_PRO;\n    else process.env.STRIPE_PRICE_PRO = previousPricePro;\n    if (previousPriceTeam === undefined) delete process.env.STRIPE_PRICE_TEAM;\n    else process.env.STRIPE_PRICE_TEAM = previousPriceTeam;\n  });\n\n  it(\"returns 400 when form data is invalid\"",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/stripe-checkout-additional.test.ts",
        "start": 83,
        "end": 90,
        "startLoc": {
          "line": 83,
          "column": 15,
          "position": 854
        },
        "endLoc": {
          "line": 90,
          "column": 40,
          "position": 933
        }
      },
      "secondFile": {
        "name": "apps/web/tests/stripe-webhook-handlers.test.ts",
        "start": 83,
        "end": 90,
        "startLoc": {
          "line": 83,
          "column": 18,
          "position": 881
        },
        "endLoc": {
          "line": 90,
          "column": 55,
          "position": 960
        }
      }
    },
    {
      "format": "typescript",
      "lines": 8,
      "fragment": ", async () => {\n    vi.resetModules();\n\n    validateSessionSpy = vi.fn().mockResolvedValue({ id: \"s1\", userId: \"u1\", expiresAt: new Date(Date.now() + 60_000) });\n    selectSpy = vi.fn();\n    updateSpy = vi.fn();\n\n    const { POST } = await import(\"../app/api/stripe/checkout/route\"",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/stripe-checkout-additional.test.ts",
        "start": 90,
        "end": 97,
        "startLoc": {
          "line": 90,
          "column": 40,
          "position": 934
        },
        "endLoc": {
          "line": 97,
          "column": 35,
          "position": 1044
        }
      },
      "secondFile": {
        "name": "apps/web/tests/stripe-reconcile-api.test.ts",
        "start": 57,
        "end": 64,
        "startLoc": {
          "line": 57,
          "column": 50,
          "position": 570
        },
        "endLoc": {
          "line": 64,
          "column": 36,
          "position": 680
        }
      }
    },
    {
      "format": "typescript",
      "lines": 6,
      "fragment": ", async () => {\n    vi.resetModules();\n\n    validateSessionSpy = vi.fn().mockResolvedValue({ id: \"s1\", userId: \"u1\", expiresAt: new Date(Date.now() + 60_000) });\n\n    const whereSpy = vi.fn().mockResolvedValue([]",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/stripe-checkout-additional.test.ts",
        "start": 110,
        "end": 115,
        "startLoc": {
          "line": 110,
          "column": 37,
          "position": 1159
        },
        "endLoc": {
          "line": 115,
          "column": 2,
          "position": 1246
        }
      },
      "secondFile": {
        "name": "apps/web/tests/stripe-reconcile-api.test.ts",
        "start": 72,
        "end": 77,
        "startLoc": {
          "line": 72,
          "column": 60,
          "position": 756
        },
        "endLoc": {
          "line": 77,
          "column": 2,
          "position": 843
        }
      }
    },
    {
      "format": "typescript",
      "lines": 8,
      "fragment": "]);\n    const fromSpy = vi.fn(() => ({ where: whereSpy }));\n    selectSpy = vi.fn(() => ({ from: fromSpy }));\n    updateSpy = vi.fn();\n\n    const { POST } = await import(\"../app/api/stripe/checkout/route\");\n    const form = new FormData();\n    form.set(\"plan\", \"pro\"",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/stripe-checkout-additional.test.ts",
        "start": 115,
        "end": 122,
        "startLoc": {
          "line": 115,
          "column": 2,
          "position": 1246
        },
        "endLoc": {
          "line": 122,
          "column": 6,
          "position": 1360
        }
      },
      "secondFile": {
        "name": "apps/web/tests/stripe-checkout-api.test.ts",
        "start": 87,
        "end": 95,
        "startLoc": {
          "line": 87,
          "column": 5,
          "position": 935
        },
        "endLoc": {
          "line": 95,
          "column": 7,
          "position": 1050
        }
      }
    },
    {
      "format": "typescript",
      "lines": 8,
      "fragment": ");\n\n    const { POST } = await import(\"../app/api/stripe/checkout/route\");\n    const form = new FormData();\n    form.set(\"plan\", \"pro\");\n    const response = await POST(new Request(\"http://localhost/api/stripe/checkout\", { method: \"POST\", body: form }));\n\n    expect(response.status).toBe(404",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/stripe-checkout-additional.test.ts",
        "start": 118,
        "end": 125,
        "startLoc": {
          "line": 118,
          "column": 2,
          "position": 1315
        },
        "endLoc": {
          "line": 125,
          "column": 4,
          "position": 1411
        }
      },
      "secondFile": {
        "name": "apps/web/tests/stripe-checkout-api.test.ts",
        "start": 119,
        "end": 126,
        "startLoc": {
          "line": 119,
          "column": 2,
          "position": 1396
        },
        "endLoc": {
          "line": 126,
          "column": 4,
          "position": 1492
        }
      }
    },
    {
      "format": "typescript",
      "lines": 13,
      "fragment": ", async () => {\n    vi.resetModules();\n\n    validateSessionSpy = vi.fn().mockResolvedValue({ id: \"s1\", userId: \"u1\", expiresAt: new Date(Date.now() + 60_000) });\n\n    const whereSpy = vi.fn().mockResolvedValue([\n      { id: \"u1\", email: \"u1@example.com\", plan: \"free\", stripeCustomerId: null },\n    ]);\n    const fromSpy = vi.fn(() => ({ where: whereSpy }));\n    selectSpy = vi.fn(() => ({ from: fromSpy }));\n    updateSpy = vi.fn();\n\n    stripeCustomersCreateSpy",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/stripe-checkout-additional.test.ts",
        "start": 129,
        "end": 141,
        "startLoc": {
          "line": 129,
          "column": 43,
          "position": 1452
        },
        "endLoc": {
          "line": 141,
          "column": 25,
          "position": 1644
        }
      },
      "secondFile": {
        "name": "apps/web/tests/stripe-reconcile-api.test.ts",
        "start": 72,
        "end": 93,
        "startLoc": {
          "line": 72,
          "column": 60,
          "position": 756
        },
        "endLoc": {
          "line": 93,
          "column": 6,
          "position": 1010
        }
      }
    },
    {
      "format": "typescript",
      "lines": 8,
      "fragment": ");\n\n    const { POST } = await import(\"../app/api/stripe/checkout/route\");\n    const form = new FormData();\n    form.set(\"plan\", \"pro\");\n    const response = await POST(new Request(\"http://localhost/api/stripe/checkout\", { method: \"POST\", body: form }));\n\n    expect(response.status).toBe(500",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/stripe-checkout-additional.test.ts",
        "start": 141,
        "end": 148,
        "startLoc": {
          "line": 141,
          "column": 2,
          "position": 1662
        },
        "endLoc": {
          "line": 148,
          "column": 4,
          "position": 1758
        }
      },
      "secondFile": {
        "name": "apps/web/tests/stripe-checkout-api.test.ts",
        "start": 119,
        "end": 126,
        "startLoc": {
          "line": 119,
          "column": 2,
          "position": 1396
        },
        "endLoc": {
          "line": 126,
          "column": 4,
          "position": 1492
        }
      }
    },
    {
      "format": "typescript",
      "lines": 7,
      "fragment": ", async () => {\n    vi.resetModules();\n\n    validateSessionSpy = vi.fn().mockResolvedValue({ id: \"s1\", userId: \"u1\", expiresAt: new Date(Date.now() + 60_000) });\n\n    const whereSpy = vi.fn().mockResolvedValue([\n      { id: \"u1\", email: \"u1@example.com\", plan: \"free\", stripeCustomerId: \"cus_existing\"",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/stripe-checkout-additional.test.ts",
        "start": 152,
        "end": 158,
        "startLoc": {
          "line": 152,
          "column": 49,
          "position": 1799
        },
        "endLoc": {
          "line": 158,
          "column": 15,
          "position": 1911
        }
      },
      "secondFile": {
        "name": "apps/web/tests/stripe-reconcile-api.test.ts",
        "start": 72,
        "end": 86,
        "startLoc": {
          "line": 72,
          "column": 60,
          "position": 756
        },
        "endLoc": {
          "line": 86,
          "column": 5,
          "position": 929
        }
      }
    },
    {
      "format": "typescript",
      "lines": 7,
      "fragment": "},\n    ]);\n    const fromSpy = vi.fn(() => ({ where: whereSpy }));\n    selectSpy = vi.fn(() => ({ from: fromSpy }));\n    updateSpy = vi.fn();\n\n    stripeSubscriptionsListSpy = vi.fn().mockRejectedValue",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/stripe-checkout-additional.test.ts",
        "start": 158,
        "end": 164,
        "startLoc": {
          "line": 158,
          "column": 2,
          "position": 1913
        },
        "endLoc": {
          "line": 164,
          "column": 18,
          "position": 2001
        }
      },
      "secondFile": {
        "name": "apps/web/tests/stripe-checkout-api.test.ts",
        "start": 86,
        "end": 116,
        "startLoc": {
          "line": 86,
          "column": 2,
          "position": 931
        },
        "endLoc": {
          "line": 116,
          "column": 18,
          "position": 1344
        }
      }
    },
    {
      "format": "typescript",
      "lines": 12,
      "fragment": "= vi.fn().mockRejectedValue(new Error(\"Stripe API error\"));\n\n    const { POST } = await import(\"../app/api/stripe/checkout/route\");\n    const form = new FormData();\n    form.set(\"plan\", \"pro\");\n    const response = await POST(new Request(\"http://localhost/api/stripe/checkout\", { method: \"POST\", body: form }));\n\n    expect(response.status).toBe(500);\n    await expect(response.json()).resolves.toEqual({ error: \"Failed to start checkout\" });\n  });\n\n  it(\"returns 500 when checkout session has no URL\"",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/stripe-checkout-additional.test.ts",
        "start": 164,
        "end": 175,
        "startLoc": {
          "line": 164,
          "column": 2,
          "position": 1993
        },
        "endLoc": {
          "line": 175,
          "column": 47,
          "position": 2145
        }
      },
      "secondFile": {
        "name": "apps/web/tests/stripe-checkout-additional.test.ts",
        "start": 141,
        "end": 152,
        "startLoc": {
          "line": 141,
          "column": 2,
          "position": 1646
        },
        "endLoc": {
          "line": 152,
          "column": 49,
          "position": 1798
        }
      }
    },
    {
      "format": "typescript",
      "lines": 13,
      "fragment": ", async () => {\n    vi.resetModules();\n\n    validateSessionSpy = vi.fn().mockResolvedValue({ id: \"s1\", userId: \"u1\", expiresAt: new Date(Date.now() + 60_000) });\n\n    const whereSpy = vi.fn().mockResolvedValue([\n      { id: \"u1\", email: \"u1@example.com\", plan: \"free\", stripeCustomerId: \"cus_existing\" },\n    ]);\n    const fromSpy = vi.fn(() => ({ where: whereSpy }));\n    selectSpy = vi.fn(() => ({ from: fromSpy }));\n    updateSpy = vi.fn();\n\n    stripeSubscriptionsListSpy = vi.fn().mockResolvedValue({ data: []",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/stripe-checkout-additional.test.ts",
        "start": 175,
        "end": 187,
        "startLoc": {
          "line": 175,
          "column": 47,
          "position": 2146
        },
        "endLoc": {
          "line": 187,
          "column": 2,
          "position": 2356
        }
      },
      "secondFile": {
        "name": "apps/web/tests/stripe-reconcile-api.test.ts",
        "start": 72,
        "end": 117,
        "startLoc": {
          "line": 72,
          "column": 60,
          "position": 756
        },
        "endLoc": {
          "line": 117,
          "column": 2,
          "position": 1353
        }
      }
    },
    {
      "format": "typescript",
      "lines": 12,
      "fragment": "});\n\n    const { POST } = await import(\"../app/api/stripe/checkout/route\");\n    const form = new FormData();\n    form.set(\"plan\", \"pro\");\n    const response = await POST(new Request(\"http://localhost/api/stripe/checkout\", { method: \"POST\", body: form }));\n\n    expect(response.status).toBe(500);\n    await expect(response.json()).resolves.toEqual({ error: \"Failed to start checkout\" });\n  });\n\n  it(\"returns 500 when checkout session creation fails\"",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/stripe-checkout-additional.test.ts",
        "start": 188,
        "end": 199,
        "startLoc": {
          "line": 188,
          "column": 2,
          "position": 2388
        },
        "endLoc": {
          "line": 199,
          "column": 51,
          "position": 2525
        }
      },
      "secondFile": {
        "name": "apps/web/tests/stripe-checkout-api.test.ts",
        "start": 119,
        "end": 152,
        "startLoc": {
          "line": 119,
          "column": 2,
          "position": 1395
        },
        "endLoc": {
          "line": 152,
          "column": 49,
          "position": 1798
        }
      }
    },
    {
      "format": "typescript",
      "lines": 14,
      "fragment": ", async () => {\n    vi.resetModules();\n\n    validateSessionSpy = vi.fn().mockResolvedValue({ id: \"s1\", userId: \"u1\", expiresAt: new Date(Date.now() + 60_000) });\n\n    const whereSpy = vi.fn().mockResolvedValue([\n      { id: \"u1\", email: \"u1@example.com\", plan: \"free\", stripeCustomerId: \"cus_existing\" },\n    ]);\n    const fromSpy = vi.fn(() => ({ where: whereSpy }));\n    selectSpy = vi.fn(() => ({ from: fromSpy }));\n    updateSpy = vi.fn();\n\n    stripeSubscriptionsListSpy = vi.fn().mockResolvedValue({ data: [] });\n    stripeCheckoutSessionsCreateSpy = vi.fn().mockRejectedValue",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/stripe-checkout-additional.test.ts",
        "start": 199,
        "end": 212,
        "startLoc": {
          "line": 199,
          "column": 51,
          "position": 2526
        },
        "endLoc": {
          "line": 212,
          "column": 18,
          "position": 2753
        }
      },
      "secondFile": {
        "name": "apps/web/tests/stripe-reconcile-api.test.ts",
        "start": 72,
        "end": 188,
        "startLoc": {
          "line": 72,
          "column": 60,
          "position": 756
        },
        "endLoc": {
          "line": 188,
          "column": 18,
          "position": 2373
        }
      }
    },
    {
      "format": "typescript",
      "lines": 12,
      "fragment": "));\n\n    const { POST } = await import(\"../app/api/stripe/checkout/route\");\n    const form = new FormData();\n    form.set(\"plan\", \"pro\");\n    const response = await POST(new Request(\"http://localhost/api/stripe/checkout\", { method: \"POST\", body: form }));\n\n    expect(response.status).toBe(500);\n    await expect(response.json()).resolves.toEqual({ error: \"Failed to start checkout\" });\n  });\n\n  it(\"creates customer and updates user when stripeCustomerId is null\"",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/stripe-checkout-additional.test.ts",
        "start": 212,
        "end": 223,
        "startLoc": {
          "line": 212,
          "column": 25,
          "position": 2760
        },
        "endLoc": {
          "line": 223,
          "column": 66,
          "position": 2897
        }
      },
      "secondFile": {
        "name": "apps/web/tests/stripe-checkout-additional.test.ts",
        "start": 141,
        "end": 152,
        "startLoc": {
          "line": 141,
          "column": 19,
          "position": 1661
        },
        "endLoc": {
          "line": 152,
          "column": 49,
          "position": 1798
        }
      }
    },
    {
      "format": "typescript",
      "lines": 12,
      "fragment": ", async () => {\n    vi.resetModules();\n\n    validateSessionSpy = vi.fn().mockResolvedValue({ id: \"s1\", userId: \"u1\", expiresAt: new Date(Date.now() + 60_000) });\n\n    const whereSpy = vi.fn().mockResolvedValue([\n      { id: \"u1\", email: \"u1@example.com\", plan: \"free\", stripeCustomerId: null },\n    ]);\n    const fromSpy = vi.fn(() => ({ where: whereSpy }));\n    selectSpy = vi.fn(() => ({ from: fromSpy }));\n\n    const whereUpdateSpy",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/stripe-checkout-additional.test.ts",
        "start": 223,
        "end": 234,
        "startLoc": {
          "line": 223,
          "column": 66,
          "position": 2898
        },
        "endLoc": {
          "line": 234,
          "column": 15,
          "position": 3080
        }
      },
      "secondFile": {
        "name": "apps/web/tests/stripe-reconcile-api.test.ts",
        "start": 72,
        "end": 152,
        "startLoc": {
          "line": 72,
          "column": 60,
          "position": 756
        },
        "endLoc": {
          "line": 152,
          "column": 13,
          "position": 1813
        }
      }
    },
    {
      "format": "typescript",
      "lines": 10,
      "fragment": "},\n    ]);\n    const fromSpy = vi.fn(() => ({ where: whereSpy }));\n    selectSpy = vi.fn(() => ({ from: fromSpy }));\n\n    const whereUpdateSpy = vi.fn().mockResolvedValue(undefined);\n    const setSpy = vi.fn(() => ({ where: whereUpdateSpy }));\n    updateSpy = vi.fn(() => ({ set: setSpy }));\n\n    stripeCustomersCreateSpy",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/stripe-checkout-additional.test.ts",
        "start": 229,
        "end": 238,
        "startLoc": {
          "line": 229,
          "column": 2,
          "position": 3012
        },
        "endLoc": {
          "line": 238,
          "column": 25,
          "position": 3154
        }
      },
      "secondFile": {
        "name": "apps/web/tests/stripe-webhook-api.test.ts",
        "start": 83,
        "end": 36,
        "startLoc": {
          "line": 83,
          "column": 7,
          "position": 752
        },
        "endLoc": {
          "line": 36,
          "column": 10,
          "position": 472
        }
      }
    },
    {
      "format": "typescript",
      "lines": 9,
      "fragment": "});\n\n    const { POST } = await import(\"../app/api/stripe/checkout/route\");\n    const form = new FormData();\n    form.set(\"plan\", \"pro\");\n    const response = await POST(new Request(\"http://localhost/api/stripe/checkout\", { method: \"POST\", body: form }));\n\n    expect(response.status).toBe(303);\n    expect(stripeCustomersCreateSpy",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/stripe-checkout-additional.test.ts",
        "start": 240,
        "end": 248,
        "startLoc": {
          "line": 240,
          "column": 2,
          "position": 3222
        },
        "endLoc": {
          "line": 248,
          "column": 25,
          "position": 3326
        }
      },
      "secondFile": {
        "name": "apps/web/tests/stripe-checkout-api.test.ts",
        "start": 119,
        "end": 169,
        "startLoc": {
          "line": 119,
          "column": 2,
          "position": 1395
        },
        "endLoc": {
          "line": 169,
          "column": 9,
          "position": 2120
        }
      }
    },
    {
      "format": "typescript",
      "lines": 14,
      "fragment": ", async () => {\n    vi.resetModules();\n\n    validateSessionSpy = vi.fn().mockResolvedValue({ id: \"s1\", userId: \"u1\", expiresAt: new Date(Date.now() + 60_000) });\n\n    const whereSpy = vi.fn().mockResolvedValue([\n      { id: \"u1\", email: \"u1@example.com\", plan: \"free\", stripeCustomerId: \"cus_existing\" },\n    ]);\n    const fromSpy = vi.fn(() => ({ where: whereSpy }));\n    selectSpy = vi.fn(() => ({ from: fromSpy }));\n    updateSpy = vi.fn();\n\n    stripeSubscriptionsListSpy = vi.fn().mockResolvedValue({ data: [] });\n    stripeCheckoutSessionsCreateSpy = vi.fn().mockResolvedValue({ url",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/stripe-checkout-additional.test.ts",
        "start": 255,
        "end": 268,
        "startLoc": {
          "line": 255,
          "column": 29,
          "position": 3388
        },
        "endLoc": {
          "line": 268,
          "column": 4,
          "position": 3619
        }
      },
      "secondFile": {
        "name": "apps/web/tests/stripe-reconcile-api.test.ts",
        "start": 72,
        "end": 188,
        "startLoc": {
          "line": 72,
          "column": 60,
          "position": 756
        },
        "endLoc": {
          "line": 188,
          "column": 3,
          "position": 2377
        }
      }
    },
    {
      "format": "typescript",
      "lines": 8,
      "fragment": ");\n\n    stripeSubscriptionsListSpy = vi.fn().mockResolvedValue({ data: [] });\n    stripeCheckoutSessionsCreateSpy = vi.fn().mockResolvedValue({ url: \"https://checkout.stripe.com/session\" });\n\n    const { POST } = await import(\"../app/api/stripe/checkout/route\");\n    const form = new FormData();\n    form.set(\"plan\", \"team\"",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/stripe-checkout-additional.test.ts",
        "start": 265,
        "end": 272,
        "startLoc": {
          "line": 265,
          "column": 2,
          "position": 3575
        },
        "endLoc": {
          "line": 272,
          "column": 7,
          "position": 3670
        }
      },
      "secondFile": {
        "name": "apps/web/tests/stripe-checkout-additional.test.ts",
        "start": 238,
        "end": 244,
        "startLoc": {
          "line": 238,
          "column": 2,
          "position": 3174
        },
        "endLoc": {
          "line": 244,
          "column": 6,
          "position": 3268
        }
      }
    },
    {
      "format": "typescript",
      "lines": 7,
      "fragment": ", async () => {\n    vi.resetModules();\n\n    validateSessionSpy = vi.fn().mockResolvedValue({ id: \"s1\", userId: \"u1\", expiresAt: new Date(Date.now() + 60_000) });\n\n    const whereSpy = vi.fn().mockResolvedValue([\n      { id: \"u1\", email: \"u1@example.com\", plan: \"pro\", stripeCustomerId: \"cus_existing\"",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/stripe-checkout-additional.test.ts",
        "start": 286,
        "end": 292,
        "startLoc": {
          "line": 286,
          "column": 56,
          "position": 3816
        },
        "endLoc": {
          "line": 292,
          "column": 15,
          "position": 3928
        }
      },
      "secondFile": {
        "name": "apps/web/tests/stripe-reconcile-api.test.ts",
        "start": 72,
        "end": 110,
        "startLoc": {
          "line": 72,
          "column": 60,
          "position": 756
        },
        "endLoc": {
          "line": 110,
          "column": 10,
          "position": 1254
        }
      }
    },
    {
      "format": "typescript",
      "lines": 8,
      "fragment": ", stripeCustomerId: \"cus_existing\" },\n    ]);\n    const fromSpy = vi.fn(() => ({ where: whereSpy }));\n    selectSpy = vi.fn(() => ({ from: fromSpy }));\n    updateSpy = vi.fn();\n\n    stripeSubscriptionsListSpy = vi.fn().mockResolvedValue({\n      data: [{ id: \"sub_1\", status: \"trialing\"",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/stripe-checkout-additional.test.ts",
        "start": 292,
        "end": 299,
        "startLoc": {
          "line": 292,
          "column": 6,
          "position": 3923
        },
        "endLoc": {
          "line": 299,
          "column": 11,
          "position": 4038
        }
      },
      "secondFile": {
        "name": "apps/web/tests/stripe-checkout-additional.test.ts",
        "start": 158,
        "end": 117,
        "startLoc": {
          "line": 158,
          "column": 7,
          "position": 1906
        },
        "endLoc": {
          "line": 117,
          "column": 9,
          "position": 1364
        }
      }
    },
    {
      "format": "typescript",
      "lines": 8,
      "fragment": "});\n\n    const { POST } = await import(\"../app/api/stripe/checkout/route\");\n    const form = new FormData();\n    form.set(\"plan\", \"team\");\n    const response = await POST(new Request(\"http://localhost/api/stripe/checkout\", { method: \"POST\", body: form }));\n\n    expect(response.status).toBe(409",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/stripe-checkout-additional.test.ts",
        "start": 301,
        "end": 308,
        "startLoc": {
          "line": 301,
          "column": 2,
          "position": 4069
        },
        "endLoc": {
          "line": 308,
          "column": 4,
          "position": 4166
        }
      },
      "secondFile": {
        "name": "apps/web/tests/stripe-checkout-additional.test.ts",
        "start": 268,
        "end": 275,
        "startLoc": {
          "line": 268,
          "column": 2,
          "position": 3624
        },
        "endLoc": {
          "line": 275,
          "column": 4,
          "position": 3721
        }
      }
    },
    {
      "format": "typescript",
      "lines": 7,
      "fragment": ");\n    const response = await POST(new Request(\"http://localhost/api/stripe/checkout\", { method: \"POST\", body: form }));\n\n    expect(response.status).toBe(409);\n    await expect(response.json()).resolves.toEqual({\n      error: \"Subscription already exists\",\n      manageUrl: \"https://billing.stripe.com/portal\"",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/stripe-checkout-additional.test.ts",
        "start": 305,
        "end": 311,
        "startLoc": {
          "line": 305,
          "column": 7,
          "position": 4116
        },
        "endLoc": {
          "line": 311,
          "column": 36,
          "position": 4199
        }
      },
      "secondFile": {
        "name": "apps/web/tests/stripe-checkout-api.test.ts",
        "start": 123,
        "end": 129,
        "startLoc": {
          "line": 123,
          "column": 6,
          "position": 1442
        },
        "endLoc": {
          "line": 129,
          "column": 33,
          "position": 1525
        }
      }
    },
    {
      "format": "typescript",
      "lines": 14,
      "fragment": ", async () => {\n    vi.resetModules();\n\n    validateSessionSpy = vi.fn().mockResolvedValue({ id: \"s1\", userId: \"u1\", expiresAt: new Date(Date.now() + 60_000) });\n\n    const whereSpy = vi.fn().mockResolvedValue([\n      { id: \"u1\", email: \"u1@example.com\", plan: \"pro\", stripeCustomerId: \"cus_existing\" },\n    ]);\n    const fromSpy = vi.fn(() => ({ where: whereSpy }));\n    selectSpy = vi.fn(() => ({ from: fromSpy }));\n    updateSpy = vi.fn();\n\n    stripeSubscriptionsListSpy = vi.fn().mockResolvedValue({\n      data: [{ id: \"sub_1\", status: \"past_due\"",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/stripe-checkout-additional.test.ts",
        "start": 315,
        "end": 328,
        "startLoc": {
          "line": 315,
          "column": 56,
          "position": 4217
        },
        "endLoc": {
          "line": 328,
          "column": 11,
          "position": 4439
        }
      },
      "secondFile": {
        "name": "apps/web/tests/stripe-reconcile-api.test.ts",
        "start": 72,
        "end": 117,
        "startLoc": {
          "line": 72,
          "column": 60,
          "position": 756
        },
        "endLoc": {
          "line": 117,
          "column": 9,
          "position": 1364
        }
      }
    },
    {
      "format": "typescript",
      "lines": 9,
      "fragment": "});\n\n    const { POST } = await import(\"../app/api/stripe/checkout/route\");\n    const form = new FormData();\n    form.set(\"plan\", \"pro\");\n    const response = await POST(new Request(\"http://localhost/api/stripe/checkout\", { method: \"POST\", body: form }));\n\n    expect(response.status).toBe(409);\n  }",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/stripe-checkout-additional.test.ts",
        "start": 330,
        "end": 338,
        "startLoc": {
          "line": 330,
          "column": 2,
          "position": 4470
        },
        "endLoc": {
          "line": 338,
          "column": 2,
          "position": 4572
        }
      },
      "secondFile": {
        "name": "apps/web/tests/stripe-checkout-api.test.ts",
        "start": 119,
        "end": 127,
        "startLoc": {
          "line": 119,
          "column": 2,
          "position": 1395
        },
        "endLoc": {
          "line": 127,
          "column": 6,
          "position": 1497
        }
      }
    },
    {
      "format": "typescript",
      "lines": 15,
      "fragment": ", async () => {\n    vi.resetModules();\n\n    validateSessionSpy = vi.fn().mockResolvedValue({ id: \"s1\", userId: \"u1\", expiresAt: new Date(Date.now() + 60_000) });\n\n    const whereSpy = vi.fn().mockResolvedValue([\n      { id: \"u1\", email: \"u1@example.com\", plan: \"free\", stripeCustomerId: \"cus_existing\" },\n    ]);\n    const fromSpy = vi.fn(() => ({ where: whereSpy }));\n    selectSpy = vi.fn(() => ({ from: fromSpy }));\n    updateSpy = vi.fn();\n\n    stripeSubscriptionsListSpy = vi.fn().mockResolvedValue({\n      data: [\n        { id: \"sub_1\", status: \"canceled\"",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/stripe-checkout-additional.test.ts",
        "start": 340,
        "end": 354,
        "startLoc": {
          "line": 340,
          "column": 54,
          "position": 4581
        },
        "endLoc": {
          "line": 354,
          "column": 11,
          "position": 4805
        }
      },
      "secondFile": {
        "name": "apps/web/tests/stripe-reconcile-api.test.ts",
        "start": 72,
        "end": 117,
        "startLoc": {
          "line": 72,
          "column": 60,
          "position": 756
        },
        "endLoc": {
          "line": 117,
          "column": 9,
          "position": 1364
        }
      }
    },
    {
      "format": "typescript",
      "lines": 10,
      "fragment": "});\n    stripeCheckoutSessionsCreateSpy = vi.fn().mockResolvedValue({ url: \"https://checkout.stripe.com/session\" });\n\n    const { POST } = await import(\"../app/api/stripe/checkout/route\");\n    const form = new FormData();\n    form.set(\"plan\", \"pro\");\n    const response = await POST(new Request(\"http://localhost/api/stripe/checkout\", { method: \"POST\", body: form }));\n\n    expect(response.status).toBe(303);\n    expect(response.headers.get(\"location\")).toBe(\"https://checkout.stripe.com/session\"",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/stripe-checkout-additional.test.ts",
        "start": 357,
        "end": 366,
        "startLoc": {
          "line": 357,
          "column": 5,
          "position": 4832
        },
        "endLoc": {
          "line": 366,
          "column": 38,
          "position": 4972
        }
      },
      "secondFile": {
        "name": "apps/web/tests/stripe-checkout-additional.test.ts",
        "start": 239,
        "end": 169,
        "startLoc": {
          "line": 239,
          "column": 2,
          "position": 3198
        },
        "endLoc": {
          "line": 169,
          "column": 35,
          "position": 2132
        }
      }
    },
    {
      "format": "typescript",
      "lines": 18,
      "fragment": ";\n\n    validateSessionSpy = vi.fn().mockResolvedValue({ id: \"s1\", userId: \"u1\", expiresAt: new Date(Date.now() + 60_000) });\n\n    const whereSpy = vi.fn().mockResolvedValue([\n      { id: \"u1\", email: \"u1@example.com\", plan: \"free\", stripeCustomerId: \"cus_existing\" },\n    ]);\n    const fromSpy = vi.fn(() => ({ where: whereSpy }));\n    selectSpy = vi.fn(() => ({ from: fromSpy }));\n    updateSpy = vi.fn();\n\n    stripeSubscriptionsListSpy = vi.fn().mockResolvedValue({ data: [] });\n    stripeCheckoutSessionsCreateSpy = vi.fn().mockResolvedValue({ url: \"https://checkout.stripe.com/session\" });\n\n    const { POST } = await import(\"../app/api/stripe/checkout/route\");\n    const form = new FormData();\n    form.set(\"plan\", \"pro\");\n    await",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/stripe-checkout-additional.test.ts",
        "start": 371,
        "end": 388,
        "startLoc": {
          "line": 371,
          "column": 25,
          "position": 5015
        },
        "endLoc": {
          "line": 388,
          "column": 6,
          "position": 5285
        }
      },
      "secondFile": {
        "name": "apps/web/tests/stripe-reconcile-api.test.ts",
        "start": 73,
        "end": 245,
        "startLoc": {
          "line": 73,
          "column": 2,
          "position": 773
        },
        "endLoc": {
          "line": 245,
          "column": 6,
          "position": 3273
        }
      }
    },
    {
      "format": "typescript",
      "lines": 13,
      "fragment": ",\n}));\n\nvi.mock(\"../lib/db/client\", () => ({\n  db: {\n    select: (...args: unknown[]) => {\n      if (!selectSpy) throw new Error(\"selectSpy not initialized\");\n      return selectSpy(...args);\n    },\n  },\n}));\n\nvi.mock(\"../app/(dashboard)/settings/stripe-reconcile-client\"",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/settings-page.test.ts",
        "start": 14,
        "end": 26,
        "startLoc": {
          "line": 14,
          "column": 2,
          "position": 164
        },
        "endLoc": {
          "line": 26,
          "column": 54,
          "position": 257
        }
      },
      "secondFile": {
        "name": "apps/web/tests/stripe-reconcile-api.test.ts",
        "start": 13,
        "end": 24,
        "startLoc": {
          "line": 13,
          "column": 2,
          "position": 164
        },
        "endLoc": {
          "line": 24,
          "column": 23,
          "position": 238
        }
      }
    },
    {
      "format": "typescript",
      "lines": 8,
      "fragment": ";\n    const expiresAt = new Date(\"2025-01-31T00:00:00.000Z\");\n\n    const returningSpy = vi.fn().mockResolvedValue([{ id: sessionId, userId, expiresAt }]);\n    const valuesSpy = vi.fn(() => ({ returning: returningSpy }));\n    insertSpy = vi.fn(() => ({ values: valuesSpy }));\n\n    const { SESSION_COOKIE_NAME }",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/session.test.ts",
        "start": 81,
        "end": 88,
        "startLoc": {
          "line": 81,
          "column": 39,
          "position": 836
        },
        "endLoc": {
          "line": 88,
          "column": 2,
          "position": 952
        }
      },
      "secondFile": {
        "name": "apps/web/tests/session.test.ts",
        "start": 43,
        "end": 50,
        "startLoc": {
          "line": 43,
          "column": 39,
          "position": 458
        },
        "endLoc": {
          "line": 50,
          "column": 2,
          "position": 573
        }
      }
    },
    {
      "format": "typescript",
      "lines": 7,
      "fragment": ");\n\n    const whereSpy = vi.fn().mockResolvedValue([]);\n    const fromSpy = vi.fn(() => ({ where: whereSpy }));\n    selectSpy = vi.fn(() => ({ from: fromSpy }));\n\n    const",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/session.test.ts",
        "start": 140,
        "end": 146,
        "startLoc": {
          "line": 140,
          "column": 2,
          "position": 1499
        },
        "endLoc": {
          "line": 146,
          "column": 6,
          "position": 1581
        }
      },
      "secondFile": {
        "name": "apps/web/tests/stripe-checkout-additional.test.ts",
        "start": 113,
        "end": 118,
        "startLoc": {
          "line": 113,
          "column": 2,
          "position": 1226
        },
        "endLoc": {
          "line": 118,
          "column": 10,
          "position": 1307
        }
      }
    },
    {
      "format": "typescript",
      "lines": 9,
      "fragment": "]);\n    const fromSpy = vi.fn(() => ({ where: whereSpy }));\n    selectSpy = vi.fn(() => ({ from: fromSpy }));\n\n    const { SESSION_COOKIE_NAME } = await import(\"../lib/auth/cookies\");\n    const { validateSession } = await import(\"../lib/auth/session\");\n\n    const request = new Request(\"http://localhost\", {\n      headers: { cookie: `${SESSION_COOKIE_NAME}=missing`",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/session.test.ts",
        "start": 142,
        "end": 150,
        "startLoc": {
          "line": 142,
          "column": 2,
          "position": 1519
        },
        "endLoc": {
          "line": 150,
          "column": 10,
          "position": 1648
        }
      },
      "secondFile": {
        "name": "apps/web/tests/session.test.ts",
        "start": 115,
        "end": 123,
        "startLoc": {
          "line": 115,
          "column": 2,
          "position": 1193
        },
        "endLoc": {
          "line": 123,
          "column": 2,
          "position": 1322
        }
      }
    },
    {
      "format": "typescript",
      "lines": 9,
      "fragment": "]);\n    const fromSpy = vi.fn(() => ({ where: whereSpy }));\n    selectSpy = vi.fn(() => ({ from: fromSpy }));\n\n    const { SESSION_COOKIE_NAME } = await import(\"../lib/auth/cookies\");\n    const { validateSession } = await import(\"../lib/auth/session\");\n\n    const request = new Request(\"http://localhost\", {\n      headers: { cookie: `${SESSION_COOKIE_NAME}=sess`",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/session.test.ts",
        "start": 168,
        "end": 176,
        "startLoc": {
          "line": 168,
          "column": 5,
          "position": 1781
        },
        "endLoc": {
          "line": 176,
          "column": 7,
          "position": 1910
        }
      },
      "secondFile": {
        "name": "apps/web/tests/session.test.ts",
        "start": 115,
        "end": 123,
        "startLoc": {
          "line": 115,
          "column": 2,
          "position": 1193
        },
        "endLoc": {
          "line": 123,
          "column": 2,
          "position": 1322
        }
      }
    },
    {
      "format": "typescript",
      "lines": 10,
      "fragment": ": ReturnType<typeof vi.fn> | undefined;\nlet insertSpy: ReturnType<typeof vi.fn> | undefined;\n\nvi.mock(\"../lib/db/client\", () => ({\n  db: {\n    select: (...args: unknown[]) => {\n      if (!selectSpy) throw new Error(\"selectSpy not initialized\");\n      return selectSpy(...args);\n    },\n    insert",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/regenerate-requests-queries.test.ts",
        "start": 3,
        "end": 12,
        "startLoc": {
          "line": 3,
          "column": 10,
          "position": 26
        },
        "endLoc": {
          "line": 12,
          "column": 7,
          "position": 134
        }
      },
      "secondFile": {
        "name": "apps/web/tests/users-queries.test.ts",
        "start": 4,
        "end": 13,
        "startLoc": {
          "line": 4,
          "column": 10,
          "position": 45
        },
        "endLoc": {
          "line": 13,
          "column": 7,
          "position": 153
        }
      }
    },
    {
      "format": "typescript",
      "lines": 13,
      "fragment": "}]);\n      const fromSpy = vi.fn(() => ({ where: whereSpy }));\n      selectSpy = vi.fn(() => ({ from: fromSpy }));\n      insertSpy = vi.fn();\n\n      const { countRecentRegenerateRequests } = await import(\"../lib/db/queries/regenerate-requests\");\n      const count = await countRecentRegenerateRequests({\n        userId: \"u1\",\n        projectId: \"proj_123\",\n        since: new Date(\"2024-01-01T00:00:00Z\"),\n      });\n\n      expect(count).toBe(0",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/regenerate-requests-queries.test.ts",
        "start": 45,
        "end": 57,
        "startLoc": {
          "line": 45,
          "column": 2,
          "position": 495
        },
        "endLoc": {
          "line": 57,
          "column": 2,
          "position": 641
        }
      },
      "secondFile": {
        "name": "apps/web/tests/regenerate-requests-queries.test.ts",
        "start": 24,
        "end": 36,
        "startLoc": {
          "line": 24,
          "column": 2,
          "position": 265
        },
        "endLoc": {
          "line": 36,
          "column": 2,
          "position": 411
        }
      }
    },
    {
      "format": "typescript",
      "lines": 7,
      "fragment": ", async () => {\n      vi.resetModules();\n\n      const whereSpy = vi.fn().mockResolvedValue([]);\n      const fromSpy = vi.fn(() => ({ where: whereSpy }));\n      selectSpy = vi.fn(() => ({ from: fromSpy }));\n      insertSpy",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/regenerate-requests-queries.test.ts",
        "start": 60,
        "end": 66,
        "startLoc": {
          "line": 60,
          "column": 38,
          "position": 655
        },
        "endLoc": {
          "line": 66,
          "column": 10,
          "position": 752
        }
      },
      "secondFile": {
        "name": "apps/web/tests/session.test.ts",
        "start": 139,
        "end": 118,
        "startLoc": {
          "line": 139,
          "column": 67,
          "position": 1483
        },
        "endLoc": {
          "line": 118,
          "column": 10,
          "position": 1307
        }
      }
    },
    {
      "format": "typescript",
      "lines": 16,
      "fragment": "]);\n      const fromSpy = vi.fn(() => ({ where: whereSpy }));\n      selectSpy = vi.fn(() => ({ from: fromSpy }));\n      insertSpy = vi.fn();\n\n      const { countRecentRegenerateRequests } = await import(\"../lib/db/queries/regenerate-requests\");\n      const count = await countRecentRegenerateRequests({\n        userId: \"u1\",\n        projectId: \"proj_123\",\n        since: new Date(\"2024-01-01T00:00:00Z\"),\n      });\n\n      expect(count).toBe(0);\n    });\n\n    it(\"converts string count to number\"",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/regenerate-requests-queries.test.ts",
        "start": 63,
        "end": 78,
        "startLoc": {
          "line": 63,
          "column": 2,
          "position": 691
        },
        "endLoc": {
          "line": 78,
          "column": 34,
          "position": 849
        }
      },
      "secondFile": {
        "name": "apps/web/tests/regenerate-requests-queries.test.ts",
        "start": 24,
        "end": 60,
        "startLoc": {
          "line": 24,
          "column": 2,
          "position": 266
        },
        "endLoc": {
          "line": 60,
          "column": 38,
          "position": 654
        }
      }
    },
    {
      "format": "typescript",
      "lines": 13,
      "fragment": "}]);\n      const fromSpy = vi.fn(() => ({ where: whereSpy }));\n      selectSpy = vi.fn(() => ({ from: fromSpy }));\n      insertSpy = vi.fn();\n\n      const { countRecentRegenerateRequests } = await import(\"../lib/db/queries/regenerate-requests\");\n      const count = await countRecentRegenerateRequests({\n        userId: \"u1\",\n        projectId: \"proj_123\",\n        since: new Date(\"2024-01-01T00:00:00Z\"),\n      });\n\n      expect(count).toBe(10",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/regenerate-requests-queries.test.ts",
        "start": 81,
        "end": 93,
        "startLoc": {
          "line": 81,
          "column": 2,
          "position": 893
        },
        "endLoc": {
          "line": 93,
          "column": 3,
          "position": 1039
        }
      },
      "secondFile": {
        "name": "apps/web/tests/regenerate-requests-queries.test.ts",
        "start": 24,
        "end": 36,
        "startLoc": {
          "line": 24,
          "column": 2,
          "position": 265
        },
        "endLoc": {
          "line": 36,
          "column": 2,
          "position": 411
        }
      }
    },
    {
      "format": "typescript",
      "lines": 14,
      "fragment": "(...args);\n  },\n}));\n\nvi.mock(\"../lib/db/client\", () => ({\n  db: {\n    select: (...args: unknown[]) => {\n      if (!selectSpy) throw new Error(\"selectSpy not initialized\");\n      return selectSpy(...args);\n    },\n  },\n}));\n\nvi.mock(\"../lib/db/queries/regenerate-requests\"",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/regenerate-api.test.ts",
        "start": 12,
        "end": 25,
        "startLoc": {
          "line": 12,
          "column": 22,
          "position": 174
        },
        "endLoc": {
          "line": 25,
          "column": 40,
          "position": 275
        }
      },
      "secondFile": {
        "name": "apps/web/tests/stripe-reconcile-api.test.ts",
        "start": 12,
        "end": 24,
        "startLoc": {
          "line": 12,
          "column": 19,
          "position": 156
        },
        "endLoc": {
          "line": 24,
          "column": 23,
          "position": 238
        }
      }
    },
    {
      "format": "typescript",
      "lines": 6,
      "fragment": "});\n    const whereSpy = vi.fn().mockResolvedValue([]);\n    const fromSpy = vi.fn(() => ({ where: whereSpy }));\n    selectSpy = vi.fn(() => ({ from: fromSpy }));\n\n    countRecentRegenerateRequestsSpy",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/regenerate-api.test.ts",
        "start": 65,
        "end": 70,
        "startLoc": {
          "line": 65,
          "column": 2,
          "position": 706
        },
        "endLoc": {
          "line": 70,
          "column": 33,
          "position": 788
        }
      },
      "secondFile": {
        "name": "apps/web/tests/stripe-checkout-additional.test.ts",
        "start": 113,
        "end": 118,
        "startLoc": {
          "line": 113,
          "column": 2,
          "position": 1225
        },
        "endLoc": {
          "line": 118,
          "column": 10,
          "position": 1307
        }
      }
    },
    {
      "format": "typescript",
      "lines": 13,
      "fragment": ");\n\n    countRecentRegenerateRequestsSpy = vi.fn();\n    createRegenerateRequestSpy = vi.fn();\n    analyzeRepositorySpy = vi.fn();\n\n    const { POST } = await import(\"../app/api/projects/[id]/regenerate/route\");\n\n    const response = await POST(new Request(\"http://localhost/api/projects/proj_123/regenerate\", { method: \"POST\" }), {\n      params: { id: \"proj_123\" },\n    });\n\n    expect(response.status).toBe(404",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/regenerate-api.test.ts",
        "start": 68,
        "end": 80,
        "startLoc": {
          "line": 68,
          "column": 2,
          "position": 783
        },
        "endLoc": {
          "line": 80,
          "column": 4,
          "position": 905
        }
      },
      "secondFile": {
        "name": "apps/web/tests/regenerate-api.test.ts",
        "start": 48,
        "end": 59,
        "startLoc": {
          "line": 48,
          "column": 2,
          "position": 525
        },
        "endLoc": {
          "line": 59,
          "column": 4,
          "position": 646
        }
      }
    },
    {
      "format": "typescript",
      "lines": 15,
      "fragment": "]);\n    const fromSpy = vi.fn(() => ({ where: whereSpy }));\n    selectSpy = vi.fn(() => ({ from: fromSpy }));\n\n    countRecentRegenerateRequestsSpy = vi.fn();\n    createRegenerateRequestSpy = vi.fn();\n    analyzeRepositorySpy = vi.fn();\n\n    const { POST } = await import(\"../app/api/projects/[id]/regenerate/route\");\n\n    const response = await POST(new Request(\"http://localhost/api/projects/proj_123/regenerate\", { method: \"POST\" }), {\n      params: { id: \"proj_123\" },\n    });\n\n    expect(response.status).toBe(400",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/regenerate-api.test.ts",
        "start": 95,
        "end": 109,
        "startLoc": {
          "line": 95,
          "column": 5,
          "position": 1031
        },
        "endLoc": {
          "line": 109,
          "column": 4,
          "position": 1210
        }
      },
      "secondFile": {
        "name": "apps/web/tests/regenerate-api.test.ts",
        "start": 66,
        "end": 59,
        "startLoc": {
          "line": 66,
          "column": 2,
          "position": 726
        },
        "endLoc": {
          "line": 59,
          "column": 4,
          "position": 646
        }
      }
    },
    {
      "format": "typescript",
      "lines": 8,
      "fragment": ", async () => {\n    vi.resetModules();\n\n    getUserFromRequestSpy = vi.fn().mockResolvedValue({ id: \"u1\", email: \"u1@example.com\" });\n    const whereSpy = vi.fn().mockResolvedValue([\n      {\n        id: \"proj_123\",\n        status: \"analysis_failed\"",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/regenerate-api.test.ts",
        "start": 112,
        "end": 119,
        "startLoc": {
          "line": 112,
          "column": 32,
          "position": 1224
        },
        "endLoc": {
          "line": 119,
          "column": 18,
          "position": 1305
        }
      },
      "secondFile": {
        "name": "apps/web/tests/regenerate-api.test.ts",
        "start": 83,
        "end": 90,
        "startLoc": {
          "line": 83,
          "column": 50,
          "position": 919
        },
        "endLoc": {
          "line": 90,
          "column": 13,
          "position": 1000
        }
      }
    },
    {
      "format": "typescript",
      "lines": 10,
      "fragment": ",\n        repoId: 1n,\n        repoFullName: \"octo/repo\",\n        installationId: 2n,\n      },\n    ]);\n    const fromSpy = vi.fn(() => ({ where: whereSpy }));\n    selectSpy = vi.fn(() => ({ from: fromSpy }));\n\n    countRecentRegenerateRequestsSpy = vi.fn().",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/regenerate-api.test.ts",
        "start": 119,
        "end": 128,
        "startLoc": {
          "line": 119,
          "column": 18,
          "position": 1306
        },
        "endLoc": {
          "line": 128,
          "column": 2,
          "position": 1407
        }
      },
      "secondFile": {
        "name": "apps/web/tests/regenerate-api.test.ts",
        "start": 90,
        "end": 99,
        "startLoc": {
          "line": 90,
          "column": 13,
          "position": 1001
        },
        "endLoc": {
          "line": 99,
          "column": 2,
          "position": 1102
        }
      }
    },
    {
      "format": "typescript",
      "lines": 11,
      "fragment": ");\n    createRegenerateRequestSpy = vi.fn();\n    analyzeRepositorySpy = vi.fn();\n\n    const { POST } = await import(\"../app/api/projects/[id]/regenerate/route\");\n\n    const response = await POST(new Request(\"http://localhost/api/projects/proj_123/regenerate\", { method: \"POST\" }), {\n      params: { id: \"proj_123\" },\n    });\n\n    expect(response.status).toBe(429",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/regenerate-api.test.ts",
        "start": 128,
        "end": 138,
        "startLoc": {
          "line": 128,
          "column": 2,
          "position": 1411
        },
        "endLoc": {
          "line": 138,
          "column": 4,
          "position": 1520
        }
      },
      "secondFile": {
        "name": "apps/web/tests/regenerate-api.test.ts",
        "start": 49,
        "end": 59,
        "startLoc": {
          "line": 49,
          "column": 2,
          "position": 537
        },
        "endLoc": {
          "line": 59,
          "column": 4,
          "position": 646
        }
      }
    },
    {
      "format": "typescript",
      "lines": 17,
      "fragment": ", async () => {\n    vi.resetModules();\n\n    getUserFromRequestSpy = vi.fn().mockResolvedValue({ id: \"u1\", email: \"u1@example.com\" });\n    const whereSpy = vi.fn().mockResolvedValue([\n      {\n        id: \"proj_123\",\n        status: \"analysis_failed\",\n        repoId: 1n,\n        repoFullName: \"octo/repo\",\n        installationId: 2n,\n      },\n    ]);\n    const fromSpy = vi.fn(() => ({ where: whereSpy }));\n    selectSpy = vi.fn(() => ({ from: fromSpy }));\n\n    countRecentRegenerateRequestsSpy = vi.fn().mockResolvedValue(0",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/regenerate-api.test.ts",
        "start": 143,
        "end": 159,
        "startLoc": {
          "line": 143,
          "column": 53,
          "position": 1560
        },
        "endLoc": {
          "line": 159,
          "column": 2,
          "position": 1746
        }
      },
      "secondFile": {
        "name": "apps/web/tests/regenerate-api.test.ts",
        "start": 83,
        "end": 128,
        "startLoc": {
          "line": 83,
          "column": 50,
          "position": 919
        },
        "endLoc": {
          "line": 128,
          "column": 2,
          "position": 1410
        }
      }
    },
    {
      "format": "typescript",
      "lines": 9,
      "fragment": ");\n\n    const { POST } = await import(\"../app/api/projects/[id]/regenerate/route\");\n\n    const response = await POST(new Request(\"http://localhost/api/projects/proj_123/regenerate\", { method: \"POST\" }), {\n      params: { id: \"proj_123\" },\n    });\n\n    expect(response.status).toBe(200",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/regenerate-api.test.ts",
        "start": 161,
        "end": 169,
        "startLoc": {
          "line": 161,
          "column": 10,
          "position": 1781
        },
        "endLoc": {
          "line": 169,
          "column": 4,
          "position": 1866
        }
      },
      "secondFile": {
        "name": "apps/web/tests/regenerate-api.test.ts",
        "start": 51,
        "end": 59,
        "startLoc": {
          "line": 51,
          "column": 2,
          "position": 561
        },
        "endLoc": {
          "line": 59,
          "column": 4,
          "position": 646
        }
      }
    },
    {
      "format": "typescript",
      "lines": 8,
      "fragment": ", async () => {\n    vi.resetModules();\n\n    getUserFromRequestSpy = vi.fn().mockResolvedValue({ id: \"u1\", email: \"u1@example.com\" });\n    const whereSpy = vi.fn().mockResolvedValue([\n      {\n        id: \"proj_123\",\n        status: \"unsupported\"",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/regenerate-api.test.ts",
        "start": 175,
        "end": 182,
        "startLoc": {
          "line": 175,
          "column": 47,
          "position": 1976
        },
        "endLoc": {
          "line": 182,
          "column": 14,
          "position": 2057
        }
      },
      "secondFile": {
        "name": "apps/web/tests/regenerate-api.test.ts",
        "start": 83,
        "end": 90,
        "startLoc": {
          "line": 83,
          "column": 50,
          "position": 919
        },
        "endLoc": {
          "line": 90,
          "column": 13,
          "position": 1000
        }
      }
    },
    {
      "format": "typescript",
      "lines": 25,
      "fragment": ",\n        repoId: 1n,\n        repoFullName: \"octo/repo\",\n        installationId: 2n,\n      },\n    ]);\n    const fromSpy = vi.fn(() => ({ where: whereSpy }));\n    selectSpy = vi.fn(() => ({ from: fromSpy }));\n\n    countRecentRegenerateRequestsSpy = vi.fn().mockResolvedValue(0);\n    createRegenerateRequestSpy = vi.fn().mockResolvedValue(undefined);\n    analyzeRepositorySpy = vi.fn().mockResolvedValue(undefined);\n\n    const { POST } = await import(\"../app/api/projects/[id]/regenerate/route\");\n\n    const response = await POST(new Request(\"http://localhost/api/projects/proj_123/regenerate\", { method: \"POST\" }), {\n      params: { id: \"proj_123\" },\n    });\n\n    expect(response.status).toBe(200);\n    await expect(response.json()).resolves.toEqual({ success: true, message: expect.any(String) });\n    expect(createRegenerateRequestSpy).toHaveBeenCalledWith({ userId: \"u1\", projectId: \"proj_123\" });\n    expect(analyzeRepositorySpy).toHaveBeenCalledWith({ repoId: 1n, repoFullName: \"octo/repo\", installationId: 2n });\n  });\n}",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/regenerate-api.test.ts",
        "start": 182,
        "end": 206,
        "startLoc": {
          "line": 182,
          "column": 14,
          "position": 2058
        },
        "endLoc": {
          "line": 206,
          "column": 2,
          "position": 2387
        }
      },
      "secondFile": {
        "name": "apps/web/tests/regenerate-api.test.ts",
        "start": 90,
        "end": 175,
        "startLoc": {
          "line": 90,
          "column": 13,
          "position": 1001
        },
        "endLoc": {
          "line": 175,
          "column": 3,
          "position": 1973
        }
      }
    },
    {
      "format": "typescript",
      "lines": 9,
      "fragment": ": ReturnType<typeof vi.fn> | undefined;\n\nvi.mock(\"../lib/db/client\", () => ({\n  db: {\n    insert: (...args: unknown[]) => {\n      if (!insertSpy) throw new Error(\"insertSpy not initialized\");\n      return insertSpy(...args);\n    },\n    delete",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/projects-queries.test.ts",
        "start": 4,
        "end": 12,
        "startLoc": {
          "line": 4,
          "column": 10,
          "position": 45
        },
        "endLoc": {
          "line": 12,
          "column": 7,
          "position": 134
        }
      },
      "secondFile": {
        "name": "apps/web/tests/session.test.ts",
        "start": 6,
        "end": 14,
        "startLoc": {
          "line": 6,
          "column": 13,
          "position": 83
        },
        "endLoc": {
          "line": 14,
          "column": 7,
          "position": 172
        }
      }
    },
    {
      "format": "typescript",
      "lines": 19,
      "fragment": ": ReturnType<typeof vi.fn> | undefined;\n\nvi.mock(\"../lib/auth/get-user\", () => ({\n  getUserFromRequest: (...args: unknown[]) => {\n    if (!getUserFromRequestSpy) throw new Error(\"getUserFromRequestSpy not initialized\");\n    return getUserFromRequestSpy(...args);\n  },\n}));\n\nvi.mock(\"../lib/db/client\", () => ({\n  db: {\n    select: (...args: unknown[]) => {\n      if (!selectSpy) throw new Error(\"selectSpy not initialized\");\n      return selectSpy(...args);\n    },\n  },\n}));\n\nvi.mock(\"../lib/tinybird/client\"",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/projects-list-api.test.ts",
        "start": 5,
        "end": 23,
        "startLoc": {
          "line": 5,
          "column": 15,
          "position": 64
        },
        "endLoc": {
          "line": 23,
          "column": 25,
          "position": 237
        }
      },
      "secondFile": {
        "name": "apps/web/tests/regenerate-api.test.ts",
        "start": 7,
        "end": 24,
        "startLoc": {
          "line": 7,
          "column": 21,
          "position": 102
        },
        "endLoc": {
          "line": 24,
          "column": 23,
          "position": 238
        }
      }
    },
    {
      "format": "typescript",
      "lines": 22,
      "fragment": ",\n        createdAt: new Date(\"2024-01-01T00:00:00.000Z\"),\n      },\n    ]);\n    const whereSpy = vi.fn(() => ({ orderBy: orderBySpy }));\n    const fromSpy = vi.fn(() => ({ where: whereSpy }));\n    selectSpy = vi.fn(() => ({ from: fromSpy }));\n\n    const { GET } = await import(\"../app/api/projects/route\");\n    const response = await GET(new Request(\"http://localhost/api/projects\"));\n\n    expect(response.status).toBe(200);\n    await expect(response.json()).resolves.toEqual({\n      projects: [\n        {\n          id: \"proj_123\",\n          githubRepoFullName: \"octo/repo\",\n          status: \"active\",\n          prUrl: \"https://github.com/octo/repo/pull/1\",\n          detectedFramework: \"nextjs-app\",\n          eventsThisMonth: 42,\n          lastEventAt: \"2025-02-01T12:34:56.789Z\"",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/projects-list-api.test.ts",
        "start": 103,
        "end": 124,
        "startLoc": {
          "line": 103,
          "column": 5,
          "position": 1052
        },
        "endLoc": {
          "line": 124,
          "column": 27,
          "position": 1288
        }
      },
      "secondFile": {
        "name": "apps/web/tests/projects-list-api.test.ts",
        "start": 59,
        "end": 80,
        "startLoc": {
          "line": 59,
          "column": 2,
          "position": 622
        },
        "endLoc": {
          "line": 80,
          "column": 27,
          "position": 858
        }
      }
    },
    {
      "format": "typescript",
      "lines": 16,
      "fragment": ", () => {\n    const queryClient = new QueryClient();\n    queryClient.setQueryData([\"project\", \"proj_123\"], {\n      project: {\n        id: \"proj_123\",\n        githubRepoFullName: \"octo/repo\",\n        status: \"active\",\n      },\n    });\n\n    const html = renderToStaticMarkup(\n      React.createElement(QueryClientProvider, {\n        client: queryClient,\n        children: React.createElement(\n          ProjectLayout,\n          { params: { id: \"proj_123\" }, children: React.createElement(\"div\", null",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/project-layout.test.ts",
        "start": 37,
        "end": 52,
        "startLoc": {
          "line": 37,
          "column": 33,
          "position": 325
        },
        "endLoc": {
          "line": 52,
          "column": 5,
          "position": 466
        }
      },
      "secondFile": {
        "name": "apps/web/tests/project-layout.test.ts",
        "start": 13,
        "end": 28,
        "startLoc": {
          "line": 13,
          "column": 40,
          "position": 120
        },
        "endLoc": {
          "line": 28,
          "column": 2,
          "position": 261
        }
      }
    },
    {
      "format": "typescript",
      "lines": 21,
      "fragment": ", () => {\n    const queryClient = new QueryClient();\n    queryClient.setQueryData([\"project\", \"proj_123\"], {\n      project: {\n        id: \"proj_123\",\n        githubRepoFullName: \"octo/repo\",\n        status: \"active\",\n      },\n    });\n\n    const html = renderToStaticMarkup(\n      React.createElement(QueryClientProvider, {\n        client: queryClient,\n        children: React.createElement(\n          ProjectLayout,\n          { params: { id: \"proj_123\" }, children: React.createElement(\"div\", null, \"Child\") },\n        ),\n      }),\n    );\n\n    expect(html).toContain(\"Active\"",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/project-layout.test.ts",
        "start": 60,
        "end": 80,
        "startLoc": {
          "line": 60,
          "column": 48,
          "position": 511
        },
        "endLoc": {
          "line": 80,
          "column": 9,
          "position": 683
        }
      },
      "secondFile": {
        "name": "apps/web/tests/project-layout.test.ts",
        "start": 13,
        "end": 57,
        "startLoc": {
          "line": 13,
          "column": 40,
          "position": 120
        },
        "endLoc": {
          "line": 57,
          "column": 12,
          "position": 497
        }
      }
    },
    {
      "format": "typescript",
      "lines": 21,
      "fragment": ", () => {\n    const queryClient = new QueryClient();\n    queryClient.setQueryData([\"project\", \"proj_123\"], {\n      project: {\n        id: \"proj_123\",\n        githubRepoFullName: \"octo/repo\",\n        status: \"active\",\n      },\n    });\n\n    const html = renderToStaticMarkup(\n      React.createElement(QueryClientProvider, {\n        client: queryClient,\n        children: React.createElement(\n          ProjectLayout,\n          { params: { id: \"proj_123\" }, children: React.createElement(\"div\", null, \"Child\") },\n        ),\n      }),\n    );\n\n    expect(html).toContain('href=\"/projects/proj_123\"'",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/project-layout.test.ts",
        "start": 83,
        "end": 103,
        "startLoc": {
          "line": 83,
          "column": 44,
          "position": 697
        },
        "endLoc": {
          "line": 103,
          "column": 28,
          "position": 869
        }
      },
      "secondFile": {
        "name": "apps/web/tests/project-layout.test.ts",
        "start": 13,
        "end": 57,
        "startLoc": {
          "line": 13,
          "column": 40,
          "position": 120
        },
        "endLoc": {
          "line": 57,
          "column": 12,
          "position": 497
        }
      }
    },
    {
      "format": "typescript",
      "lines": 18,
      "fragment": ", () => {\n    const queryClient = new QueryClient();\n    queryClient.setQueryData([\"project\", \"proj_123\"], {\n      project: {\n        id: \"proj_123\",\n        githubRepoFullName: \"octo/repo\",\n        status: \"active\",\n      },\n    });\n\n    const html = renderToStaticMarkup(\n      React.createElement(QueryClientProvider, {\n        client: queryClient,\n        children: React.createElement(\n          ProjectLayout,\n          {\n            params: { id: \"proj_123\" },\n            children: React.createElement(\"div\", { className",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/project-layout.test.ts",
        "start": 152,
        "end": 169,
        "startLoc": {
          "line": 152,
          "column": 27,
          "position": 1288
        },
        "endLoc": {
          "line": 169,
          "column": 10,
          "position": 1433
        }
      },
      "secondFile": {
        "name": "apps/web/tests/project-layout.test.ts",
        "start": 13,
        "end": 28,
        "startLoc": {
          "line": 13,
          "column": 40,
          "position": 120
        },
        "endLoc": {
          "line": 28,
          "column": 14,
          "position": 263
        }
      }
    },
    {
      "format": "typescript",
      "lines": 21,
      "fragment": ", () => {\n    const queryClient = new QueryClient();\n    queryClient.setQueryData([\"project\", \"proj_123\"], {\n      project: {\n        id: \"proj_123\",\n        githubRepoFullName: \"octo/repo\",\n        status: \"active\",\n      },\n    });\n\n    const html = renderToStaticMarkup(\n      React.createElement(QueryClientProvider, {\n        client: queryClient,\n        children: React.createElement(\n          ProjectLayout,\n          { params: { id: \"proj_123\" }, children: React.createElement(\"div\", null, \"Child\") },\n        ),\n      }),\n    );\n\n    expect(html).toContain(\"bg-slate-900\"",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/project-layout.test.ts",
        "start": 179,
        "end": 199,
        "startLoc": {
          "line": 179,
          "column": 46,
          "position": 1497
        },
        "endLoc": {
          "line": 199,
          "column": 15,
          "position": 1669
        }
      },
      "secondFile": {
        "name": "apps/web/tests/project-layout.test.ts",
        "start": 13,
        "end": 57,
        "startLoc": {
          "line": 13,
          "column": 40,
          "position": 120
        },
        "endLoc": {
          "line": 57,
          "column": 12,
          "position": 497
        }
      }
    },
    {
      "format": "typescript",
      "lines": 31,
      "fragment": "import { describe, expect, it, vi } from \"vitest\";\n\nlet getUserFromRequestSpy: ReturnType<typeof vi.fn> | undefined;\nlet selectSpy: ReturnType<typeof vi.fn> | undefined;\nlet tinybirdSqlSpy: ReturnType<typeof vi.fn> | undefined;\n\nvi.mock(\"../lib/auth/get-user\", () => ({\n  getUserFromRequest: (...args: unknown[]) => {\n    if (!getUserFromRequestSpy) throw new Error(\"getUserFromRequestSpy not initialized\");\n    return getUserFromRequestSpy(...args);\n  },\n}));\n\nvi.mock(\"../lib/db/client\", () => ({\n  db: {\n    select: (...args: unknown[]) => {\n      if (!selectSpy) throw new Error(\"selectSpy not initialized\");\n      return selectSpy(...args);\n    },\n  },\n}));\n\nvi.mock(\"../lib/tinybird/client\", () => ({\n  createTinybirdClientFromEnv: () => ({ apiUrl: \"https://api.tinybird.example\", token: \"test-token\" }),\n  tinybirdSql: (...args: unknown[]) => {\n    if (!tinybirdSqlSpy) throw new Error(\"tinybirdSqlSpy not initialized\");\n    return tinybirdSqlSpy(...args);\n  },\n}));\n\ndescribe(\"GET /api/projects/[id]\"",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/project-detail-api.test.ts",
        "start": 1,
        "end": 31,
        "startLoc": {
          "line": 1,
          "column": 1,
          "position": 0
        },
        "endLoc": {
          "line": 31,
          "column": 25,
          "position": 333
        }
      },
      "secondFile": {
        "name": "apps/web/tests/projects-list-api.test.ts",
        "start": 1,
        "end": 31,
        "startLoc": {
          "line": 1,
          "column": 1,
          "position": 0
        },
        "endLoc": {
          "line": 31,
          "column": 20,
          "position": 333
        }
      }
    },
    {
      "format": "typescript",
      "lines": 9,
      "fragment": ", () => {\n  it(\"returns 401 when unauthenticated\", async () => {\n    vi.resetModules();\n\n    getUserFromRequestSpy = vi.fn().mockResolvedValue(null);\n    selectSpy = vi.fn();\n    tinybirdSqlSpy = vi.fn();\n\n    const { GET } = await import(\"../app/api/projects/[id]/route\"",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/project-detail-api.test.ts",
        "start": 31,
        "end": 39,
        "startLoc": {
          "line": 31,
          "column": 25,
          "position": 334
        },
        "endLoc": {
          "line": 39,
          "column": 33,
          "position": 424
        }
      },
      "secondFile": {
        "name": "apps/web/tests/projects-list-api.test.ts",
        "start": 31,
        "end": 39,
        "startLoc": {
          "line": 31,
          "column": 20,
          "position": 334
        },
        "endLoc": {
          "line": 39,
          "column": 28,
          "position": 424
        }
      }
    },
    {
      "format": "typescript",
      "lines": 10,
      "fragment": "});\n\n    expect(response.status).toBe(401);\n  });\n\n  it(\"returns 404 when project is not found\", async () => {\n    vi.resetModules();\n\n    getUserFromRequestSpy = vi.fn().mockResolvedValue({ id: \"u1\", email: \"u1@example.com\" });\n    selectSpy",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/project-detail-api.test.ts",
        "start": 40,
        "end": 49,
        "startLoc": {
          "line": 40,
          "column": 2,
          "position": 461
        },
        "endLoc": {
          "line": 49,
          "column": 10,
          "position": 541
        }
      },
      "secondFile": {
        "name": "apps/web/tests/regenerate-api.test.ts",
        "start": 57,
        "end": 66,
        "startLoc": {
          "line": 57,
          "column": 5,
          "position": 631
        },
        "endLoc": {
          "line": 66,
          "column": 6,
          "position": 711
        }
      }
    },
    {
      "format": "typescript",
      "lines": 7,
      "fragment": ");\n    tinybirdSqlSpy = vi.fn();\n\n    const { GET } = await import(\"../app/api/projects/[id]/route\");\n    const response = await GET(new Request(\"http://localhost/api/projects/proj_123\"), { params: { id: \"proj_123\" } });\n\n    expect(response.status).toBe(404",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/project-detail-api.test.ts",
        "start": 49,
        "end": 55,
        "startLoc": {
          "line": 49,
          "column": 2,
          "position": 592
        },
        "endLoc": {
          "line": 55,
          "column": 4,
          "position": 675
        }
      },
      "secondFile": {
        "name": "apps/web/tests/project-detail-api.test.ts",
        "start": 36,
        "end": 42,
        "startLoc": {
          "line": 36,
          "column": 2,
          "position": 393
        },
        "endLoc": {
          "line": 42,
          "column": 4,
          "position": 476
        }
      }
    },
    {
      "format": "typescript",
      "lines": 7,
      "fragment": ", async () => {\n    vi.resetModules();\n\n    getUserFromRequestSpy = vi.fn().mockResolvedValue({ id: \"u1\", email: \"u1@example.com\" });\n    tinybirdSqlSpy = vi.fn().mockResolvedValue({ data: [] });\n\n    const projectWhereSpy",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/project-detail-api.test.ts",
        "start": 58,
        "end": 64,
        "startLoc": {
          "line": 58,
          "column": 42,
          "position": 689
        },
        "endLoc": {
          "line": 64,
          "column": 16,
          "position": 768
        }
      },
      "secondFile": {
        "name": "apps/web/tests/projects-list-api.test.ts",
        "start": 45,
        "end": 51,
        "startLoc": {
          "line": 45,
          "column": 50,
          "position": 473
        },
        "endLoc": {
          "line": 51,
          "column": 11,
          "position": 552
        }
      }
    },
    {
      "format": "typescript",
      "lines": 9,
      "fragment": ",\n    });\n  });\n\n  it(\"returns Tinybird last_event_at when the project has events but the DB column is null\", async () => {\n    vi.resetModules();\n\n    getUserFromRequestSpy = vi.fn().mockResolvedValue({ id: \"u1\", email: \"u1@example.com\" });\n    tinybirdSqlSpy = vi.fn().mockResolvedValue({ data: [{ last_event_at",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/project-detail-api.test.ts",
        "start": 110,
        "end": 118,
        "startLoc": {
          "line": 110,
          "column": 7,
          "position": 1233
        },
        "endLoc": {
          "line": 118,
          "column": 14,
          "position": 1321
        }
      },
      "secondFile": {
        "name": "apps/web/tests/projects-list-api.test.ts",
        "start": 83,
        "end": 92,
        "startLoc": {
          "line": 83,
          "column": 2,
          "position": 874
        },
        "endLoc": {
          "line": 92,
          "column": 11,
          "position": 963
        }
      }
    },
    {
      "format": "typescript",
      "lines": 42,
      "fragment": "] });\n\n    const projectWhereSpy = vi.fn().mockResolvedValue([\n      {\n        id: \"proj_123\",\n        githubRepoFullName: \"octo/repo\",\n        status: \"analysis_failed\",\n        prNumber: 1,\n        prUrl: \"https://github.com/octo/repo/pull/1\",\n        detectedFramework: \"nextjs-app\",\n        detectedAnalytics: [\"posthog\"],\n        eventsThisMonth: 12n,\n        lastEventAt: null,\n        createdAt: new Date(\"2024-01-01T00:00:00.000Z\"),\n        updatedAt: new Date(\"2024-01-02T00:00:00.000Z\"),\n      },\n    ]);\n    const projectFromSpy = vi.fn(() => ({ where: projectWhereSpy }));\n\n    const userWhereSpy = vi.fn().mockResolvedValue([{ plan: \"free\" }]);\n    const userFromSpy = vi.fn(() => ({ where: userWhereSpy }));\n\n    selectSpy = vi\n      .fn()\n      .mockImplementationOnce(() => ({ from: projectFromSpy }))\n      .mockImplementationOnce(() => ({ from: userFromSpy }));\n\n    const { GET } = await import(\"../app/api/projects/[id]/route\");\n    const response = await GET(new Request(\"http://localhost/api/projects/proj_123\"), { params: { id: \"proj_123\" } });\n\n    expect(response.status).toBe(200);\n    await expect(response.json()).resolves.toEqual({\n      project: {\n        id: \"proj_123\",\n        githubRepoFullName: \"octo/repo\",\n        status: \"analysis_failed\",\n        prNumber: 1,\n        prUrl: \"https://github.com/octo/repo/pull/1\",\n        detectedFramework: \"nextjs-app\",\n        detectedAnalytics: [\"posthog\"],\n        eventsThisMonth: 12,\n        lastEventAt: \"2025-02-01T12:34:56.789Z\"",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/project-detail-api.test.ts",
        "start": 118,
        "end": 159,
        "startLoc": {
          "line": 118,
          "column": 2,
          "position": 1327
        },
        "endLoc": {
          "line": 159,
          "column": 27,
          "position": 1755
        }
      },
      "secondFile": {
        "name": "apps/web/tests/project-detail-api.test.ts",
        "start": 62,
        "end": 103,
        "startLoc": {
          "line": 62,
          "column": 2,
          "position": 758
        },
        "endLoc": {
          "line": 103,
          "column": 5,
          "position": 1186
        }
      }
    },
    {
      "format": "typescript",
      "lines": 9,
      "fragment": ", async () => {\n    vi.resetModules();\n    setProjectPullRequestByRepoIdSpy = vi.fn();\n\n    const reposGet = vi.fn().mockResolvedValue({ data: { default_branch: \"main\" } });\n    const gitGetRef = vi.fn().mockResolvedValue({ data: { object: { sha: \"sha_main\" } } });\n    const gitCreateRef = vi\n      .fn()\n      .mockRejectedValueOnce",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/pr-generator.test.ts",
        "start": 41,
        "end": 49,
        "startLoc": {
          "line": 41,
          "column": 64,
          "position": 476
        },
        "endLoc": {
          "line": 49,
          "column": 22,
          "position": 598
        }
      },
      "secondFile": {
        "name": "apps/web/tests/pr-generator.test.ts",
        "start": 13,
        "end": 19,
        "startLoc": {
          "line": 13,
          "column": 44,
          "position": 130
        },
        "endLoc": {
          "line": 19,
          "column": 18,
          "position": 248
        }
      }
    },
    {
      "format": "typescript",
      "lines": 10,
      "fragment": "(undefined);\n\n    const octokit = {\n      repos: { get: reposGet },\n      git: { getRef: gitGetRef, createRef: gitCreateRef },\n    };\n\n    const { createAnalyticsBranch } = await import(\"../lib/github/pr-generator\");\n    await expect(createAnalyticsBranch(octokit as never, { owner: \"octo\", repo: \"repo\" })).resolves.toBe(\n      \"add-fast-pr-analytics-2\"",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/pr-generator.test.ts",
        "start": 50,
        "end": 59,
        "startLoc": {
          "line": 50,
          "column": 22,
          "position": 613
        },
        "endLoc": {
          "line": 59,
          "column": 26,
          "position": 723
        }
      },
      "secondFile": {
        "name": "apps/web/tests/pr-generator.test.ts",
        "start": 19,
        "end": 28,
        "startLoc": {
          "line": 19,
          "column": 18,
          "position": 249
        },
        "endLoc": {
          "line": 28,
          "column": 24,
          "position": 359
        }
      }
    },
    {
      "format": "typescript",
      "lines": 26,
      "fragment": ", async () => {\n    vi.resetModules();\n    setProjectPullRequestByRepoIdSpy = vi.fn();\n\n    const defaultBranch = \"main\";\n    const entryPoint = \"app/layout.tsx\";\n    const projectId = \"proj_123\";\n\n    const reposGet = vi.fn().mockResolvedValue({ data: { default_branch: defaultBranch } });\n    const gitGetRef = vi.fn().mockResolvedValue({ data: { object: { sha: \"sha_main\" } } });\n    const gitCreateRef = vi.fn().mockResolvedValue(undefined);\n\n    const layoutBefore = [\n      \"export default function RootLayout({ children }: { children: React.ReactNode }) {\",\n      \"  return (\",\n      \"    <html>\",\n      \"      <body>{children}</body>\",\n      \"    </html>\",\n      \"  );\",\n      \"}\",\n      \"\",\n    ].join(\"\\\\n\");\n\n    const reposGetContent = vi.fn(async ({ path }: { path: string }) => {\n      if (path === \"tsconfig.json\") throw { status: 404 };\n      if (path === \"components/fast-pr-analytics.tsx\"",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/pr-generator.test.ts",
        "start": 141,
        "end": 166,
        "startLoc": {
          "line": 141,
          "column": 55,
          "position": 1578
        },
        "endLoc": {
          "line": 166,
          "column": 35,
          "position": 1851
        }
      },
      "secondFile": {
        "name": "apps/web/tests/pr-generator.test.ts",
        "start": 66,
        "end": 91,
        "startLoc": {
          "line": 66,
          "column": 57,
          "position": 769
        },
        "endLoc": {
          "line": 91,
          "column": 11,
          "position": 1042
        }
      }
    },
    {
      "format": "typescript",
      "lines": 39,
      "fragment": "if (path === entryPoint) {\n        return {\n          data: {\n            type: \"file\",\n            sha: \"sha_layout\",\n            encoding: \"base64\",\n            content: Buffer.from(layoutBefore, \"utf8\").toString(\"base64\"),\n          },\n        };\n      }\n      throw { status: 404 };\n    });\n\n    const createOrUpdateFileContents = vi.fn().mockResolvedValue(undefined);\n\n    const octokit = {\n      repos: {\n        get: reposGet,\n        getContent: reposGetContent,\n        createOrUpdateFileContents,\n      },\n      git: { getRef: gitGetRef, createRef: gitCreateRef },\n    };\n\n    const { createAnalyticsBranch, commitAnalyticsFiles } = await import(\"../lib/github/pr-generator\");\n    const branch = await createAnalyticsBranch(octokit as never, { owner: \"octo\", repo: \"repo\" });\n\n    await commitAnalyticsFiles(octokit as never, {\n      owner: \"octo\",\n      repo: \"repo\",\n      branch,\n      defaultBranch,\n      projectId,\n      detection: { framework: \"nextjs-app\", entryPoint },\n      eventsUrl: \"https://events.example.com\",\n    });\n\n    const calls = createOrUpdateFileContents.mock.calls as unknown[][];\n    const",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/pr-generator.test.ts",
        "start": 176,
        "end": 214,
        "startLoc": {
          "line": 176,
          "column": 7,
          "position": 1920
        },
        "endLoc": {
          "line": 214,
          "column": 6,
          "position": 2247
        }
      },
      "secondFile": {
        "name": "apps/web/tests/pr-generator.test.ts",
        "start": 91,
        "end": 129,
        "startLoc": {
          "line": 91,
          "column": 7,
          "position": 1035
        },
        "endLoc": {
          "line": 129,
          "column": 7,
          "position": 1362
        }
      }
    },
    {
      "format": "typescript",
      "lines": 14,
      "fragment": "} };\n\n    const { openAnalyticsPullRequest } = await import(\"../lib/github/pr-generator\");\n    await expect(\n      openAnalyticsPullRequest(octokit as never, {\n        repoId: 123n,\n        owner: \"octo\",\n        repo: \"repo\",\n        branch: \"add-fast-pr-analytics\",\n        defaultBranch: \"main\",\n        projectId: \"proj_123\",\n        entryPoint: \"app/layout.tsx\",\n      }),\n    ).resolves.toEqual({ prNumber: 77",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/pr-generator.test.ts",
        "start": 255,
        "end": 268,
        "startLoc": {
          "line": 255,
          "column": 2,
          "position": 2731
        },
        "endLoc": {
          "line": 268,
          "column": 3,
          "position": 2841
        }
      },
      "secondFile": {
        "name": "apps/web/tests/pr-generator.test.ts",
        "start": 224,
        "end": 237,
        "startLoc": {
          "line": 224,
          "column": 2,
          "position": 2422
        },
        "endLoc": {
          "line": 237,
          "column": 3,
          "position": 2532
        }
      }
    },
    {
      "format": "typescript",
      "lines": 26,
      "fragment": "import React from \"react\";\nimport { renderToStaticMarkup } from \"react-dom/server\";\nimport { describe, expect, it, vi } from \"vitest\";\n\nlet cookieGetSpy: ReturnType<typeof vi.fn> | undefined;\nlet selectSpy: ReturnType<typeof vi.fn> | undefined;\n\nvi.mock(\"next/headers\", () => ({\n  cookies: () => ({\n    get: (...args: unknown[]) => {\n      if (!cookieGetSpy) throw new Error(\"cookieGetSpy not initialized\");\n      return cookieGetSpy(...args);\n    },\n  }),\n}));\n\nvi.mock(\"../lib/db/client\", () => ({\n  db: {\n    select: (...args: unknown[]) => {\n      if (!selectSpy) throw new Error(\"selectSpy not initialized\");\n      return selectSpy(...args);\n    },\n  },\n}));\n\ndescribe",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/marketing-pricing-page.test.ts",
        "start": 1,
        "end": 26,
        "startLoc": {
          "line": 1,
          "column": 1,
          "position": 0
        },
        "endLoc": {
          "line": 26,
          "column": 9,
          "position": 253
        }
      },
      "secondFile": {
        "name": "apps/web/tests/settings-page.test.ts",
        "start": 1,
        "end": 24,
        "startLoc": {
          "line": 1,
          "column": 1,
          "position": 0
        },
        "endLoc": {
          "line": 24,
          "column": 3,
          "position": 234
        }
      }
    },
    {
      "format": "typescript",
      "lines": 9,
      "fragment": ", async () => {\n    vi.resetModules();\n    cookieGetSpy = vi.fn().mockReturnValue(null);\n    selectSpy = vi.fn();\n\n    const { default: PricingPage } = await import(\"../app/(marketing)/pricing/page\");\n    const element = await PricingPage();\n    const html = renderToStaticMarkup(element);\n    expect(html).toContain(\"Compare plans\"",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/marketing-pricing-page.test.ts",
        "start": 46,
        "end": 54,
        "startLoc": {
          "line": 46,
          "column": 39,
          "position": 452
        },
        "endLoc": {
          "line": 54,
          "column": 16,
          "position": 558
        }
      },
      "secondFile": {
        "name": "apps/web/tests/marketing-pricing-page.test.ts",
        "start": 27,
        "end": 37,
        "startLoc": {
          "line": 27,
          "column": 54,
          "position": 269
        },
        "endLoc": {
          "line": 37,
          "column": 7,
          "position": 377
        }
      }
    },
    {
      "format": "typescript",
      "lines": 11,
      "fragment": ", async () => {\n    vi.resetModules();\n\n    cookieGetSpy = vi.fn().mockReturnValue(null);\n    selectSpy = vi.fn();\n\n    const { default: PricingPage } = await import(\"../app/(marketing)/pricing/page\");\n    const element = await PricingPage();\n    const html = renderToStaticMarkup(element);\n\n    expect(html).toContain('href=\"/api/auth/github\"'",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/marketing-pricing-page.test.ts",
        "start": 60,
        "end": 70,
        "startLoc": {
          "line": 60,
          "column": 57,
          "position": 608
        },
        "endLoc": {
          "line": 70,
          "column": 26,
          "position": 716
        }
      },
      "secondFile": {
        "name": "apps/web/tests/marketing-pricing-page.test.ts",
        "start": 27,
        "end": 37,
        "startLoc": {
          "line": 27,
          "column": 54,
          "position": 269
        },
        "endLoc": {
          "line": 37,
          "column": 7,
          "position": 377
        }
      }
    },
    {
      "format": "typescript",
      "lines": 9,
      "fragment": ", async () => {\n    vi.resetModules();\n\n    cookieGetSpy = vi.fn().mockReturnValue({ value: \"sess_123\" });\n\n    const sessionWhereSpy = vi.fn().mockResolvedValue([{ userId: \"u1\", expiresAt: new Date(\"2030-01-01T00:00:00.000Z\") }]);\n    const sessionFromSpy = vi.fn(() => ({ where: sessionWhereSpy }));\n\n    const userWhereSpy = vi.fn().mockResolvedValue([{ plan",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/marketing-pricing-page.test.ts",
        "start": 73,
        "end": 81,
        "startLoc": {
          "line": 73,
          "column": 54,
          "position": 730
        },
        "endLoc": {
          "line": 81,
          "column": 5,
          "position": 862
        }
      },
      "secondFile": {
        "name": "apps/web/tests/settings-page.test.ts",
        "start": 31,
        "end": 41,
        "startLoc": {
          "line": 31,
          "column": 41,
          "position": 302
        },
        "endLoc": {
          "line": 41,
          "column": 6,
          "position": 437
        }
      }
    },
    {
      "format": "typescript",
      "lines": 8,
      "fragment": "}));\n\n    const userWhereSpy = vi.fn().mockResolvedValue([{ plan: \"free\" }]);\n    const userFromSpy = vi.fn(() => ({ where: userWhereSpy }));\n\n    selectSpy = vi\n      .fn()\n      .mockImplementationOnce(() => ({ from: sessionFromSpy",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/marketing-pricing-page.test.ts",
        "start": 79,
        "end": 86,
        "startLoc": {
          "line": 79,
          "column": 2,
          "position": 838
        },
        "endLoc": {
          "line": 86,
          "column": 15,
          "position": 930
        }
      },
      "secondFile": {
        "name": "apps/web/tests/project-detail-api.test.ts",
        "start": 79,
        "end": 86,
        "startLoc": {
          "line": 79,
          "column": 2,
          "position": 908
        },
        "endLoc": {
          "line": 86,
          "column": 15,
          "position": 1000
        }
      }
    },
    {
      "format": "typescript",
      "lines": 9,
      "fragment": "]);\n    const userFromSpy = vi.fn(() => ({ where: userWhereSpy }));\n\n    selectSpy = vi\n      .fn()\n      .mockImplementationOnce(() => ({ from: sessionFromSpy }))\n      .mockImplementationOnce(() => ({ from: userFromSpy }));\n\n    const { default: PricingPage",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/marketing-pricing-page.test.ts",
        "start": 81,
        "end": 89,
        "startLoc": {
          "line": 81,
          "column": 2,
          "position": 868
        },
        "endLoc": {
          "line": 89,
          "column": 12,
          "position": 967
        }
      },
      "secondFile": {
        "name": "apps/web/tests/settings-page.test.ts",
        "start": 47,
        "end": 55,
        "startLoc": {
          "line": 47,
          "column": 5,
          "position": 476
        },
        "endLoc": {
          "line": 55,
          "column": 13,
          "position": 575
        }
      }
    },
    {
      "format": "typescript",
      "lines": 12,
      "fragment": ": ReturnType<typeof vi.fn> | undefined;\n\nvi.mock(\"next/headers\", () => ({\n  cookies: () => ({\n    get: (...args: unknown[]) => {\n      if (!cookieGetSpy) throw new Error(\"cookieGetSpy not initialized\");\n      return cookieGetSpy(...args);\n    },\n  }),\n}));\n\nasync",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/marketing-landing-page.test.ts",
        "start": 5,
        "end": 16,
        "startLoc": {
          "line": 5,
          "column": 13,
          "position": 48
        },
        "endLoc": {
          "line": 16,
          "column": 6,
          "position": 153
        }
      },
      "secondFile": {
        "name": "apps/web/tests/settings-page.test.ts",
        "start": 6,
        "end": 17,
        "startLoc": {
          "line": 6,
          "column": 10,
          "position": 67
        },
        "endLoc": {
          "line": 17,
          "column": 3,
          "position": 172
        }
      }
    },
    {
      "format": "typescript",
      "lines": 12,
      "fragment": "import { describe, expect, it, vi } from \"vitest\";\n\nlet destroySessionSpy: ReturnType<typeof vi.fn> | undefined;\n\nvi.mock(\"../lib/auth/session\", () => ({\n  destroySession: (...args: unknown[]) => {\n    if (!destroySessionSpy) throw new Error(\"destroySessionSpy not initialized\");\n    return destroySessionSpy(...args);\n  },\n}));\n\ndescribe(\"POST /api/auth/logout\"",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/logout-api.test.ts",
        "start": 1,
        "end": 12,
        "startLoc": {
          "line": 1,
          "column": 1,
          "position": 0
        },
        "endLoc": {
          "line": 12,
          "column": 24,
          "position": 116
        }
      },
      "secondFile": {
        "name": "apps/web/tests/logout-no-cookie.test.ts",
        "start": 1,
        "end": 12,
        "startLoc": {
          "line": 1,
          "column": 1,
          "position": 0
        },
        "endLoc": {
          "line": 12,
          "column": 36,
          "position": 116
        }
      }
    },
    {
      "format": "typescript",
      "lines": 9,
      "fragment": ");\n    expect(new URL(response.headers.get(\"location\") ?? \"\", \"http://localhost\").pathname).toBe(\"/\");\n\n    const setCookie = response.headers.get(\"set-cookie\");\n    expect(setCookie).toContain(`${SESSION_COOKIE_NAME}=`);\n    expect(setCookie).toContain(\"Max-Age=0\");\n    expect(setCookie).toContain(\"Expires=\");\n  });\n});",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/logout-api.test.ts",
        "start": 30,
        "end": 38,
        "startLoc": {
          "line": 30,
          "column": 4,
          "position": 314
        },
        "endLoc": {
          "line": 38,
          "column": 2,
          "position": 416
        }
      },
      "secondFile": {
        "name": "apps/web/tests/logout-no-cookie.test.ts",
        "start": 21,
        "end": 29,
        "startLoc": {
          "line": 21,
          "column": 2,
          "position": 241
        },
        "endLoc": {
          "line": 29,
          "column": 2,
          "position": 343
        }
      }
    },
    {
      "format": "typescript",
      "lines": 10,
      "fragment": "});\n\n    const html = renderToStaticMarkup(\n      React.createElement(QueryClientProvider, {\n        client: queryClient,\n        children: React.createElement(LiveFeedPage, { params: { id: \"proj_123\" } }),\n      }),\n    );\n\n    expect(html).toContain(\"page_view\"",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/live-feed-page.test.ts",
        "start": 43,
        "end": 52,
        "startLoc": {
          "line": 43,
          "column": 5,
          "position": 388
        },
        "endLoc": {
          "line": 52,
          "column": 12,
          "position": 467
        }
      },
      "secondFile": {
        "name": "apps/web/tests/live-feed-page.test.ts",
        "start": 16,
        "end": 25,
        "startLoc": {
          "line": 16,
          "column": 2,
          "position": 178
        },
        "endLoc": {
          "line": 25,
          "column": 12,
          "position": 257
        }
      }
    },
    {
      "format": "typescript",
      "lines": 18,
      "fragment": ", async () => {\n    vi.resetModules();\n    process.env.GITHUB_WEBHOOK_SECRET = \"test_secret\";\n    handleInstallationWebhookSpy = vi.fn();\n    handleInstallationRepositoriesWebhookSpy = vi.fn();\n    handlePullRequestWebhookSpy = vi.fn();\n    handlePushWebhookSpy = vi.fn();\n\n    const body = JSON.stringify({ hello: \"world\" });\n\n    const { POST } = await import(\"../app/api/webhooks/github/route\");\n    const response = await POST(\n      new Request(\"http://localhost/api/webhooks/github\", {\n        method: \"POST\",\n        headers: {\n          \"content-type\": \"application/json\",\n          \"x-github-event\": \"pull_request\",\n        }",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/github-webhooks-api.test.ts",
        "start": 96,
        "end": 113,
        "startLoc": {
          "line": 96,
          "column": 51,
          "position": 974
        },
        "endLoc": {
          "line": 113,
          "column": 2,
          "position": 1146
        }
      },
      "secondFile": {
        "name": "apps/web/tests/github-webhooks-api.test.ts",
        "start": 70,
        "end": 87,
        "startLoc": {
          "line": 70,
          "column": 39,
          "position": 748
        },
        "endLoc": {
          "line": 87,
          "column": 22,
          "position": 920
        }
      }
    },
    {
      "format": "typescript",
      "lines": 9,
      "fragment": ", async () => {\n    vi.resetModules();\n    process.env.GITHUB_WEBHOOK_SECRET = \"test_secret\";\n    handleInstallationWebhookSpy = vi.fn();\n    handleInstallationRepositoriesWebhookSpy = vi.fn();\n    handlePullRequestWebhookSpy = vi.fn();\n    handlePushWebhookSpy = vi.fn();\n\n    const body = \"{not_json\"",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/github-webhooks-api.test.ts",
        "start": 121,
        "end": 129,
        "startLoc": {
          "line": 121,
          "column": 54,
          "position": 1187
        },
        "endLoc": {
          "line": 129,
          "column": 12,
          "position": 1274
        }
      },
      "secondFile": {
        "name": "apps/web/tests/github-webhooks-api.test.ts",
        "start": 70,
        "end": 78,
        "startLoc": {
          "line": 70,
          "column": 39,
          "position": 748
        },
        "endLoc": {
          "line": 78,
          "column": 5,
          "position": 835
        }
      }
    },
    {
      "format": "typescript",
      "lines": 17,
      "fragment": ";\n    const signature = signBody(body, process.env.GITHUB_WEBHOOK_SECRET);\n\n    const { POST } = await import(\"../app/api/webhooks/github/route\");\n    const response = await POST(\n      new Request(\"http://localhost/api/webhooks/github\", {\n        method: \"POST\",\n        headers: {\n          \"content-type\": \"application/json\",\n          \"x-github-event\": \"pull_request\",\n          \"x-hub-signature-256\": signature,\n        },\n        body,\n      }),\n    );\n\n    expect(response.status).toBe(400",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/github-webhooks-api.test.ts",
        "start": 129,
        "end": 145,
        "startLoc": {
          "line": 129,
          "column": 12,
          "position": 1275
        },
        "endLoc": {
          "line": 145,
          "column": 4,
          "position": 1401
        }
      },
      "secondFile": {
        "name": "apps/web/tests/github-webhooks-api.test.ts",
        "start": 49,
        "end": 65,
        "startLoc": {
          "line": 49,
          "column": 2,
          "position": 556
        },
        "endLoc": {
          "line": 65,
          "column": 4,
          "position": 682
        }
      }
    },
    {
      "format": "typescript",
      "lines": 10,
      "fragment": ");\n    const signature = signBody(body, process.env.GITHUB_WEBHOOK_SECRET);\n\n    const { POST } = await import(\"../app/api/webhooks/github/route\");\n    const response = await POST(\n      new Request(\"http://localhost/api/webhooks/github\", {\n        method: \"POST\",\n        headers: {\n          \"content-type\": \"application/json\",\n          \"x-github-event\": \"installation_repositories\"",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/github-webhooks-api.test.ts",
        "start": 157,
        "end": 166,
        "startLoc": {
          "line": 157,
          "column": 8,
          "position": 1563
        },
        "endLoc": {
          "line": 166,
          "column": 28,
          "position": 1652
        }
      },
      "secondFile": {
        "name": "apps/web/tests/github-webhooks-api.test.ts",
        "start": 49,
        "end": 58,
        "startLoc": {
          "line": 49,
          "column": 2,
          "position": 555
        },
        "endLoc": {
          "line": 58,
          "column": 15,
          "position": 644
        }
      }
    },
    {
      "format": "typescript",
      "lines": 7,
      "fragment": ", async () => {\n    vi.resetModules();\n    process.env.GITHUB_WEBHOOK_SECRET = \"test_secret\";\n    handleInstallationWebhookSpy = vi.fn();\n    handleInstallationRepositoriesWebhookSpy = vi.fn();\n    handlePullRequestWebhookSpy = vi.fn();\n    handlePushWebhookSpy = vi.fn().",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/github-webhooks-api.test.ts",
        "start": 178,
        "end": 184,
        "startLoc": {
          "line": 178,
          "column": 44,
          "position": 1749
        },
        "endLoc": {
          "line": 184,
          "column": 2,
          "position": 1826
        }
      },
      "secondFile": {
        "name": "apps/web/tests/github-webhooks-api.test.ts",
        "start": 70,
        "end": 76,
        "startLoc": {
          "line": 70,
          "column": 39,
          "position": 748
        },
        "endLoc": {
          "line": 76,
          "column": 2,
          "position": 825
        }
      }
    },
    {
      "format": "typescript",
      "lines": 11,
      "fragment": "};\n    const body = JSON.stringify(payload);\n    const signature = signBody(body, process.env.GITHUB_WEBHOOK_SECRET);\n\n    const { POST } = await import(\"../app/api/webhooks/github/route\");\n    const response = await POST(\n      new Request(\"http://localhost/api/webhooks/github\", {\n        method: \"POST\",\n        headers: {\n          \"content-type\": \"application/json\",\n          \"x-github-event\": \"push\"",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/github-webhooks-api.test.ts",
        "start": 186,
        "end": 196,
        "startLoc": {
          "line": 186,
          "column": 2,
          "position": 1886
        },
        "endLoc": {
          "line": 196,
          "column": 7,
          "position": 1990
        }
      },
      "secondFile": {
        "name": "apps/web/tests/github-webhooks-api.test.ts",
        "start": 156,
        "end": 58,
        "startLoc": {
          "line": 156,
          "column": 2,
          "position": 1548
        },
        "endLoc": {
          "line": 58,
          "column": 15,
          "position": 644
        }
      }
    },
    {
      "format": "typescript",
      "lines": 11,
      "fragment": "};\n    const body = JSON.stringify(payload);\n    const signature = signBody(body, process.env.GITHUB_WEBHOOK_SECRET);\n\n    const { POST } = await import(\"../app/api/webhooks/github/route\");\n    const response = await POST(\n      new Request(\"http://localhost/api/webhooks/github\", {\n        method: \"POST\",\n        headers: {\n          \"content-type\": \"application/json\",\n          \"x-github-event\": \"some_unknown_event\"",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/github-webhooks-api.test.ts",
        "start": 224,
        "end": 234,
        "startLoc": {
          "line": 224,
          "column": 2,
          "position": 2261
        },
        "endLoc": {
          "line": 234,
          "column": 21,
          "position": 2365
        }
      },
      "secondFile": {
        "name": "apps/web/tests/github-webhooks-api.test.ts",
        "start": 156,
        "end": 58,
        "startLoc": {
          "line": 156,
          "column": 2,
          "position": 1548
        },
        "endLoc": {
          "line": 58,
          "column": 15,
          "position": 644
        }
      }
    },
    {
      "format": "typescript",
      "lines": 12,
      "fragment": "(...args);\n  },\n}));\n\nvi.mock(\"../lib/github/analyze\", () => ({\n  analyzeRepository: (...args: unknown[]) => {\n    if (!analyzeRepositorySpy) throw new Error(\"analyzeRepositorySpy not initialized\");\n    return analyzeRepositorySpy(...args);\n  },\n}));\n\ndescribe(\"handlePushWebhook\"",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/github-webhook-push-handler.test.ts",
        "start": 9,
        "end": 20,
        "startLoc": {
          "line": 9,
          "column": 28,
          "position": 117
        },
        "endLoc": {
          "line": 20,
          "column": 20,
          "position": 206
        }
      },
      "secondFile": {
        "name": "apps/web/tests/regenerate-api.test.ts",
        "start": 32,
        "end": 43,
        "startLoc": {
          "line": 32,
          "column": 27,
          "position": 376
        },
        "endLoc": {
          "line": 43,
          "column": 37,
          "position": 465
        }
      }
    },
    {
      "format": "typescript",
      "lines": 14,
      "fragment": "import { describe, expect, it, vi } from \"vitest\";\n\nlet updateSpy: ReturnType<typeof vi.fn> | undefined;\n\nvi.mock(\"../lib/db/client\", () => ({\n  db: {\n    update: (...args: unknown[]) => {\n      if (!updateSpy) throw new Error(\"updateSpy not initialized\");\n      return updateSpy(...args);\n    },\n  },\n}));\n\ndescribe(\"GitHub pull request webhook handler\"",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/github-webhook-pull-request-handler.test.ts",
        "start": 1,
        "end": 14,
        "startLoc": {
          "line": 1,
          "column": 1,
          "position": 0
        },
        "endLoc": {
          "line": 14,
          "column": 38,
          "position": 126
        }
      },
      "secondFile": {
        "name": "apps/web/tests/link-github-users-script.test.ts",
        "start": 1,
        "end": 14,
        "startLoc": {
          "line": 1,
          "column": 1,
          "position": 0
        },
        "endLoc": {
          "line": 14,
          "column": 27,
          "position": 126
        }
      }
    },
    {
      "format": "typescript",
      "lines": 17,
      "fragment": ", async () => {\n    vi.resetModules();\n\n    const schema = await import(\"../lib/db/schema\");\n\n    const whereSpy = vi.fn().mockResolvedValue(undefined);\n    const setSpy = vi.fn(() => ({ where: whereSpy }));\n    updateSpy = vi.fn((table: unknown) => {\n      expect(table).toBe(schema.projects);\n      return { set: setSpy };\n    });\n\n    const { handlePullRequestWebhook } = await import(\"../lib/github/handlers/pull-request\");\n\n    await handlePullRequestWebhook({\n      action: \"closed\",\n      pull_request: { number: 10, merged: false",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/github-webhook-pull-request-handler.test.ts",
        "start": 39,
        "end": 55,
        "startLoc": {
          "line": 39,
          "column": 63,
          "position": 392
        },
        "endLoc": {
          "line": 55,
          "column": 6,
          "position": 578
        }
      },
      "secondFile": {
        "name": "apps/web/tests/github-webhook-pull-request-handler.test.ts",
        "start": 15,
        "end": 31,
        "startLoc": {
          "line": 15,
          "column": 56,
          "position": 140
        },
        "endLoc": {
          "line": 31,
          "column": 5,
          "position": 326
        }
      }
    },
    {
      "format": "typescript",
      "lines": 13,
      "fragment": ": ReturnType<typeof vi.fn> | undefined;\n\nvi.mock(\"../lib/db/client\", () => ({\n  db: {\n    select: (...args: unknown[]) => {\n      if (!selectSpy) throw new Error(\"selectSpy not initialized\");\n      return selectSpy(...args);\n    },\n    insert: (...args: unknown[]) => {\n      if (!insertSpy) throw new Error(\"insertSpy not initialized\");\n      return insertSpy(...args);\n    },\n    delete",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/github-webhook-installation-handler.test.ts",
        "start": 6,
        "end": 18,
        "startLoc": {
          "line": 6,
          "column": 21,
          "position": 83
        },
        "endLoc": {
          "line": 18,
          "column": 7,
          "position": 222
        }
      },
      "secondFile": {
        "name": "apps/web/tests/users-queries.test.ts",
        "start": 5,
        "end": 16,
        "startLoc": {
          "line": 5,
          "column": 10,
          "position": 64
        },
        "endLoc": {
          "line": 16,
          "column": 2,
          "position": 184
        }
      }
    },
    {
      "format": "typescript",
      "lines": 12,
      "fragment": "insert: (...args: unknown[]) => {\n      if (!insertSpy) throw new Error(\"insertSpy not initialized\");\n      return insertSpy(...args);\n    },\n    delete: (...args: unknown[]) => {\n      if (!deleteSpy) throw new Error(\"deleteSpy not initialized\");\n      return deleteSpy(...args);\n    },\n  },\n}));\n\nvi",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/github-webhook-installation-handler.test.ts",
        "start": 14,
        "end": 25,
        "startLoc": {
          "line": 14,
          "column": 5,
          "position": 172
        },
        "endLoc": {
          "line": 25,
          "column": 3,
          "position": 281
        }
      },
      "secondFile": {
        "name": "apps/web/tests/projects-queries.test.ts",
        "start": 8,
        "end": 19,
        "startLoc": {
          "line": 8,
          "column": 5,
          "position": 84
        },
        "endLoc": {
          "line": 19,
          "column": 9,
          "position": 193
        }
      }
    },
    {
      "format": "typescript",
      "lines": 10,
      "fragment": "(...args);\n    },\n    delete: (...args: unknown[]) => {\n      if (!deleteSpy) throw new Error(\"deleteSpy not initialized\");\n      return deleteSpy(...args);\n    },\n  },\n}));\n\nvi.mock(\"../lib/github/analyze\"",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/github-webhook-installation-handler.test.ts",
        "start": 16,
        "end": 25,
        "startLoc": {
          "line": 16,
          "column": 10,
          "position": 211
        },
        "endLoc": {
          "line": 25,
          "column": 24,
          "position": 285
        }
      },
      "secondFile": {
        "name": "apps/web/tests/session.test.ts",
        "start": 16,
        "end": 25,
        "startLoc": {
          "line": 16,
          "column": 10,
          "position": 211
        },
        "endLoc": {
          "line": 25,
          "column": 15,
          "position": 285
        }
      }
    },
    {
      "format": "typescript",
      "lines": 11,
      "fragment": "},\n}));\n\nvi.mock(\"../lib/github/analyze\", () => ({\n  analyzeRepository: (...args: unknown[]) => {\n    if (!analyzeRepositorySpy) throw new Error(\"analyzeRepositorySpy not initialized\");\n    return analyzeRepositorySpy(...args);\n  },\n}));\n\ndescribe(\"GitHub installation webhook handlers\"",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/github-webhook-installation-handler.test.ts",
        "start": 22,
        "end": 32,
        "startLoc": {
          "line": 22,
          "column": 3,
          "position": 272
        },
        "endLoc": {
          "line": 32,
          "column": 39,
          "position": 354
        }
      },
      "secondFile": {
        "name": "apps/web/tests/regenerate-api.test.ts",
        "start": 33,
        "end": 43,
        "startLoc": {
          "line": 33,
          "column": 3,
          "position": 383
        },
        "endLoc": {
          "line": 43,
          "column": 37,
          "position": 465
        }
      }
    },
    {
      "format": "typescript",
      "lines": 16,
      "fragment": ", async () => {\n    vi.resetModules();\n\n    analyzeRepositorySpy = vi.fn().mockResolvedValue(undefined);\n\n    const schema = await import(\"../lib/db/schema\");\n    selectSpy = vi.fn();\n    insertSpy = vi.fn();\n\n    const whereDeleteSpy = vi.fn().mockResolvedValue(undefined);\n    deleteSpy = vi.fn((table: unknown) => {\n      expect(table).toBe(schema.projects);\n      return { where: whereDeleteSpy };\n    });\n\n    const { handleInstallationRepositoriesWebhook",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/github-webhook-installation-handler.test.ts",
        "start": 113,
        "end": 128,
        "startLoc": {
          "line": 113,
          "column": 71,
          "position": 1203
        },
        "endLoc": {
          "line": 128,
          "column": 38,
          "position": 1358
        }
      },
      "secondFile": {
        "name": "apps/web/tests/github-webhook-installation-handler.test.ts",
        "start": 87,
        "end": 103,
        "startLoc": {
          "line": 87,
          "column": 61,
          "position": 976
        },
        "endLoc": {
          "line": 103,
          "column": 26,
          "position": 1132
        }
      }
    },
    {
      "format": "typescript",
      "lines": 25,
      "fragment": ", async () => {\n    vi.resetModules();\n\n    analyzeRepositorySpy = vi.fn().mockResolvedValue(undefined);\n\n    const schema = await import(\"../lib/db/schema\");\n    const userId = \"11111111-1111-1111-1111-111111111111\";\n\n    const whereSelectSpy = vi.fn().mockResolvedValue([{ userId }]);\n    const fromSelectSpy = vi.fn((table: unknown) => {\n      expect(table).toBe(schema.githubTokens);\n      return { where: whereSelectSpy };\n    });\n    selectSpy = vi.fn(() => ({ from: fromSelectSpy }));\n\n    const onConflictDoUpdateSpy = vi.fn().mockResolvedValue(undefined);\n    const valuesSpy = vi.fn(() => ({ onConflictDoUpdate: onConflictDoUpdateSpy }));\n    insertSpy = vi.fn((table: unknown) => {\n      expect(table).toBe(schema.projects);\n      return { values: valuesSpy };\n    });\n\n    deleteSpy = vi.fn();\n\n    const { handleInstallationRepositoriesWebhook",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/github-webhook-installation-handler.test.ts",
        "start": 139,
        "end": 163,
        "startLoc": {
          "line": 139,
          "column": 74,
          "position": 1451
        },
        "endLoc": {
          "line": 163,
          "column": 38,
          "position": 1741
        }
      },
      "secondFile": {
        "name": "apps/web/tests/github-webhook-installation-handler.test.ts",
        "start": 33,
        "end": 57,
        "startLoc": {
          "line": 33,
          "column": 64,
          "position": 368
        },
        "endLoc": {
          "line": 57,
          "column": 26,
          "position": 658
        }
      }
    },
    {
      "format": "typescript",
      "lines": 13,
      "fragment": ": ReturnType<typeof vi.fn> | undefined;\n\nvi.mock(\"../lib/db/client\", () => ({\n  db: {\n    insert: (...args: unknown[]) => {\n      if (!insertSpy) throw new Error(\"insertSpy not initialized\");\n      return insertSpy(...args);\n    },\n    select: (...args: unknown[]) => {\n      if (!selectSpy) throw new Error(\"selectSpy not initialized\");\n      return selectSpy(...args);\n    },\n  }",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/github-tokens.test.ts",
        "start": 4,
        "end": 16,
        "startLoc": {
          "line": 4,
          "column": 10,
          "position": 45
        },
        "endLoc": {
          "line": 16,
          "column": 2,
          "position": 184
        }
      },
      "secondFile": {
        "name": "apps/web/tests/session.test.ts",
        "start": 6,
        "end": 18,
        "startLoc": {
          "line": 6,
          "column": 13,
          "position": 83
        },
        "endLoc": {
          "line": 18,
          "column": 7,
          "position": 222
        }
      }
    },
    {
      "format": "typescript",
      "lines": 8,
      "fragment": ", async () => {\n    vi.resetModules();\n\n    const onConflictDoUpdateSpy = vi.fn().mockResolvedValue(undefined);\n    const valuesSpy = vi.fn(() => ({ onConflictDoUpdate: onConflictDoUpdateSpy }));\n    insertSpy = vi.fn(() => ({ values: valuesSpy }));\n\n    const { upsertInstallationToken",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/github-tokens.test.ts",
        "start": 38,
        "end": 45,
        "startLoc": {
          "line": 38,
          "column": 66,
          "position": 410
        },
        "endLoc": {
          "line": 45,
          "column": 24,
          "position": 511
        }
      },
      "secondFile": {
        "name": "apps/web/tests/github-tokens.test.ts",
        "start": 20,
        "end": 27,
        "startLoc": {
          "line": 20,
          "column": 84,
          "position": 209
        },
        "endLoc": {
          "line": 27,
          "column": 23,
          "position": 310
        }
      }
    },
    {
      "format": "typescript",
      "lines": 10,
      "fragment": "]);\n    const fromSpy = vi.fn(() => ({ where: whereSpy }));\n    selectSpy = vi.fn(() => ({ from: fromSpy }));\n\n    const { getStoredInstallationToken } = await import(\"../lib/db/queries/github-tokens\");\n    await expect(\n      getStoredInstallationToken({\n        userId: \"11111111-1111-1111-1111-111111111111\",\n        installationId: 123n,\n        now: new Date(\"2029-01-01T00:00:00.000Z\"",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/github-tokens.test.ts",
        "start": 92,
        "end": 101,
        "startLoc": {
          "line": 92,
          "column": 2,
          "position": 940
        },
        "endLoc": {
          "line": 101,
          "column": 27,
          "position": 1054
        }
      },
      "secondFile": {
        "name": "apps/web/tests/github-tokens.test.ts",
        "start": 73,
        "end": 83,
        "startLoc": {
          "line": 73,
          "column": 5,
          "position": 734
        },
        "endLoc": {
          "line": 83,
          "column": 27,
          "position": 849
        }
      }
    },
    {
      "format": "typescript",
      "lines": 8,
      "fragment": ", async () => {\n    vi.resetModules();\n\n    const expiresAt = new Date(\"2030-01-01T00:00:00.000Z\");\n    const whereSpy = vi.fn().mockResolvedValue([{ token: \"t1\", expiresAt }]);\n    const fromSpy = vi.fn(() => ({ where: whereSpy }));\n    selectSpy = vi.fn(() => ({ from: fromSpy }));\n    insertSpy",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/github-tokens.test.ts",
        "start": 106,
        "end": 113,
        "startLoc": {
          "line": 106,
          "column": 74,
          "position": 1094
        },
        "endLoc": {
          "line": 113,
          "column": 10,
          "position": 1217
        }
      },
      "secondFile": {
        "name": "apps/web/tests/github-tokens.test.ts",
        "start": 88,
        "end": 96,
        "startLoc": {
          "line": 88,
          "column": 58,
          "position": 878
        },
        "endLoc": {
          "line": 96,
          "column": 6,
          "position": 1002
        }
      }
    },
    {
      "format": "typescript",
      "lines": 6,
      "fragment": "}]);\n    const fromSpy = vi.fn(() => ({ where: whereSpy }));\n    selectSpy = vi.fn(() => ({ from: fromSpy }));\n    insertSpy = vi.fn();\n\n    const refreshSpy",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/github-tokens.test.ts",
        "start": 110,
        "end": 115,
        "startLoc": {
          "line": 110,
          "column": 2,
          "position": 1155
        },
        "endLoc": {
          "line": 115,
          "column": 11,
          "position": 1232
        }
      },
      "secondFile": {
        "name": "apps/web/tests/regenerate-requests-queries.test.ts",
        "start": 24,
        "end": 29,
        "startLoc": {
          "line": 24,
          "column": 2,
          "position": 265
        },
        "endLoc": {
          "line": 29,
          "column": 2,
          "position": 342
        }
      }
    },
    {
      "format": "typescript",
      "lines": 6,
      "fragment": ", async () => {\n    vi.resetModules();\n\n    selectSpy = vi.fn(() => ({ from: () => ({ where: vi.fn().mockResolvedValue([]) }) }));\n    insertSpy = vi.fn();\n    const refreshSpy = vi.fn().mockResolvedValue({ token: \"t1\", expiresAt: \"not-a-date\"",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/github-tokens.test.ts",
        "start": 151,
        "end": 156,
        "startLoc": {
          "line": 151,
          "column": 75,
          "position": 1578
        },
        "endLoc": {
          "line": 156,
          "column": 13,
          "position": 1687
        }
      },
      "secondFile": {
        "name": "apps/web/tests/github-tokens.test.ts",
        "start": 130,
        "end": 137,
        "startLoc": {
          "line": 130,
          "column": 90,
          "position": 1358
        },
        "endLoc": {
          "line": 137,
          "column": 4,
          "position": 1469
        }
      }
    },
    {
      "format": "typescript",
      "lines": 8,
      "fragment": ", async () => {\n    vi.resetModules();\n\n    const whereSpy = vi.fn().mockResolvedValue([]);\n    const fromSpy = vi.fn(() => ({ where: whereSpy }));\n    selectSpy = vi.fn(() => ({ from: fromSpy }));\n\n    const onConflictDoUpdateSpy",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/github-tokens.test.ts",
        "start": 168,
        "end": 175,
        "startLoc": {
          "line": 168,
          "column": 74,
          "position": 1772
        },
        "endLoc": {
          "line": 175,
          "column": 22,
          "position": 1872
        }
      },
      "secondFile": {
        "name": "apps/web/tests/session.test.ts",
        "start": 139,
        "end": 146,
        "startLoc": {
          "line": 139,
          "column": 67,
          "position": 1483
        },
        "endLoc": {
          "line": 146,
          "column": 2,
          "position": 1583
        }
      }
    },
    {
      "format": "typescript",
      "lines": 7,
      "fragment": ");\n\n    const onConflictDoUpdateSpy = vi.fn().mockResolvedValue(undefined);\n    const valuesSpy = vi.fn(() => ({ onConflictDoUpdate: onConflictDoUpdateSpy }));\n    insertSpy = vi.fn(() => ({ values: valuesSpy }));\n\n    const refreshSpy",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/github-tokens.test.ts",
        "start": 173,
        "end": 179,
        "startLoc": {
          "line": 173,
          "column": 2,
          "position": 1865
        },
        "endLoc": {
          "line": 179,
          "column": 11,
          "position": 1948
        }
      },
      "secondFile": {
        "name": "apps/web/tests/github-tokens.test.ts",
        "start": 21,
        "end": 27,
        "startLoc": {
          "line": 21,
          "column": 2,
          "position": 225
        },
        "endLoc": {
          "line": 27,
          "column": 2,
          "position": 308
        }
      }
    },
    {
      "format": "typescript",
      "lines": 15,
      "fragment": ");\n    expect(code).toContain(\"event_type: 'session_start'\");\n    expect(code).toContain(\"event_type: 'page_view'\");\n    expect(code).toContain(\"navigator.doNotTrack === '1'\");\n    expect(code).toContain(\"engagement_time_ms\");\n    expect(code).toContain(\"scroll_depth\");\n    expect(code).toContain(\"cta_clicks\");\n    expect(code).toContain(\"visitor_id\");\n    expect(code).toContain(\"is_returning\");\n    expect(code).toContain(\"utm_source\");\n    expect(code).toContain(\"beforeunload\");\n    expect(code).toContain(\"visibilitychange\");\n    expect(code).toContain(\"tally_vid\");\n    expect(code).not.toContain(\"@tally-analytics/sdk\");\n  }",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/github-templates.test.ts",
        "start": 35,
        "end": 49,
        "startLoc": {
          "line": 35,
          "column": 15,
          "position": 423
        },
        "endLoc": {
          "line": 49,
          "column": 2,
          "position": 585
        }
      },
      "secondFile": {
        "name": "apps/web/tests/github-templates.test.ts",
        "start": 11,
        "end": 25,
        "startLoc": {
          "line": 11,
          "column": 18,
          "position": 138
        },
        "endLoc": {
          "line": 25,
          "column": 7,
          "position": 300
        }
      }
    },
    {
      "format": "typescript",
      "lines": 8,
      "fragment": ", async () => {\n      vi.resetModules();\n      process.env.GITHUB_OAUTH_CLIENT_ID = \"client-id\";\n      process.env.GITHUB_OAUTH_CLIENT_SECRET = \"client-secret\";\n\n      global.fetch = vi.fn().mockResolvedValue({\n        ok: true,\n        json: () => Promise.resolve({ error",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/github-oauth.test.ts",
        "start": 50,
        "end": 57,
        "startLoc": {
          "line": 50,
          "column": 47,
          "position": 550
        },
        "endLoc": {
          "line": 57,
          "column": 6,
          "position": 633
        }
      },
      "secondFile": {
        "name": "apps/web/tests/github-oauth.test.ts",
        "start": 36,
        "end": 43,
        "startLoc": {
          "line": 36,
          "column": 45,
          "position": 404
        },
        "endLoc": {
          "line": 43,
          "column": 13,
          "position": 487
        }
      }
    },
    {
      "format": "typescript",
      "lines": 9,
      "fragment": ", async () => {\n      vi.resetModules();\n\n      global.fetch = vi.fn().mockResolvedValue({\n        ok: true,\n        json: () =>\n          Promise.resolve([\n            { email: \"unverified@example.com\", primary: true, verified: false },\n            { email: \"verified@example.com\"",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/github-oauth.test.ts",
        "start": 101,
        "end": 109,
        "startLoc": {
          "line": 101,
          "column": 75,
          "position": 1084
        },
        "endLoc": {
          "line": 109,
          "column": 23,
          "position": 1173
        }
      },
      "secondFile": {
        "name": "apps/web/tests/github-oauth.test.ts",
        "start": 84,
        "end": 92,
        "startLoc": {
          "line": 84,
          "column": 52,
          "position": 896
        },
        "endLoc": {
          "line": 92,
          "column": 22,
          "position": 985
        }
      }
    },
    {
      "format": "typescript",
      "lines": 6,
      "fragment": ", async () => {\n      vi.resetModules();\n\n      global.fetch = vi.fn().mockResolvedValue({\n        ok: true,\n        json: () => Promise.resolve([{ email: \"unverified@example.com\", primary: true, verified: false }]",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/github-oauth.test.ts",
        "start": 117,
        "end": 122,
        "startLoc": {
          "line": 117,
          "column": 39,
          "position": 1249
        },
        "endLoc": {
          "line": 122,
          "column": 2,
          "position": 1327
        }
      },
      "secondFile": {
        "name": "apps/web/tests/github-oauth.test.ts",
        "start": 84,
        "end": 91,
        "startLoc": {
          "line": 84,
          "column": 52,
          "position": 896
        },
        "endLoc": {
          "line": 91,
          "column": 2,
          "position": 977
        }
      }
    },
    {
      "format": "typescript",
      "lines": 11,
      "fragment": ";\n\nfunction getSetCookies(response: Response): string[] {\n  const headers = response.headers as unknown as { getSetCookie?: () => string[] };\n  if (typeof headers.getSetCookie === \"function\") return headers.getSetCookie();\n\n  const single = response.headers.get(\"set-cookie\");\n  return single ? [single] : [];\n}\n\ndescribe",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/github-oauth-callback.test.ts",
        "start": 36,
        "end": 46,
        "startLoc": {
          "line": 36,
          "column": 2,
          "position": 429
        },
        "endLoc": {
          "line": 46,
          "column": 9,
          "position": 546
        }
      },
      "secondFile": {
        "name": "apps/web/tests/github-oauth-redirect.test.ts",
        "start": 1,
        "end": 11,
        "startLoc": {
          "line": 1,
          "column": 9,
          "position": 20
        },
        "endLoc": {
          "line": 11,
          "column": 9,
          "position": 137
        }
      }
    },
    {
      "format": "typescript",
      "lines": 12,
      "fragment": ", async () => {\n    vi.resetModules();\n\n    exchangeSpy = vi.fn();\n    fetchUserSpy = vi.fn();\n    fetchEmailSpy = vi.fn();\n    findOrCreateSpy = vi.fn();\n    createSessionSpy = vi.fn();\n\n    const { GET } = await import(\"../app/api/auth/github/callback/route\");\n\n    const missingCode",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/github-oauth-callback.test.ts",
        "start": 70,
        "end": 81,
        "startLoc": {
          "line": 70,
          "column": 72,
          "position": 827
        },
        "endLoc": {
          "line": 81,
          "column": 12,
          "position": 931
        }
      },
      "secondFile": {
        "name": "apps/web/tests/github-oauth-callback.test.ts",
        "start": 47,
        "end": 57,
        "startLoc": {
          "line": 47,
          "column": 72,
          "position": 562
        },
        "endLoc": {
          "line": 57,
          "column": 9,
          "position": 665
        }
      }
    },
    {
      "format": "typescript",
      "lines": 13,
      "fragment": ", async () => {\n    vi.resetModules();\n\n    exchangeSpy = vi.fn();\n    fetchUserSpy = vi.fn();\n    fetchEmailSpy = vi.fn();\n    findOrCreateSpy = vi.fn();\n    createSessionSpy = vi.fn();\n\n    const { GET } = await import(\"../app/api/auth/github/callback/route\");\n\n    const response = await GET(\n      new Request(\"http://localhost/api/auth/github/callback?code=abc&state=param-state\"",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/github-oauth-callback.test.ts",
        "start": 96,
        "end": 108,
        "startLoc": {
          "line": 96,
          "column": 81,
          "position": 1129
        },
        "endLoc": {
          "line": 108,
          "column": 71,
          "position": 1247
        }
      },
      "secondFile": {
        "name": "apps/web/tests/github-oauth-callback.test.ts",
        "start": 47,
        "end": 58,
        "startLoc": {
          "line": 47,
          "column": 72,
          "position": 562
        },
        "endLoc": {
          "line": 58,
          "column": 96,
          "position": 679
        }
      }
    },
    {
      "format": "typescript",
      "lines": 7,
      "fragment": "),\n    );\n\n    expect(response.status).toBe(302);\n    const location = response.headers.get(\"location\");\n    expect(new URL(location ?? \"\", \"http://localhost\").pathname).toBe(\"/login\");\n    expect(new URL(location ?? \"\", \"http://localhost\").searchParams.get(\"error\")).toBe(\"invalid_state\"",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/github-oauth-callback.test.ts",
        "start": 110,
        "end": 116,
        "startLoc": {
          "line": 110,
          "column": 2,
          "position": 1268
        },
        "endLoc": {
          "line": 116,
          "column": 16,
          "position": 1362
        }
      },
      "secondFile": {
        "name": "apps/web/tests/github-oauth-callback.test.ts",
        "start": 58,
        "end": 64,
        "startLoc": {
          "line": 58,
          "column": 96,
          "position": 680
        },
        "endLoc": {
          "line": 64,
          "column": 18,
          "position": 774
        }
      }
    },
    {
      "format": "typescript",
      "lines": 10,
      "fragment": ");\n    fetchUserSpy = vi.fn();\n    fetchEmailSpy = vi.fn();\n    findOrCreateSpy = vi.fn();\n    createSessionSpy = vi.fn();\n\n    const { GET } = await import(\"../app/api/auth/github/callback/route\");\n\n    const response = await GET(\n      new Request(\"http://localhost/api/auth/github/callback?code=bad&state=state\"",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/github-oauth-callback.test.ts",
        "start": 125,
        "end": 134,
        "startLoc": {
          "line": 125,
          "column": 2,
          "position": 1454
        },
        "endLoc": {
          "line": 134,
          "column": 65,
          "position": 1543
        }
      },
      "secondFile": {
        "name": "apps/web/tests/github-oauth-callback.test.ts",
        "start": 50,
        "end": 58,
        "startLoc": {
          "line": 50,
          "column": 2,
          "position": 591
        },
        "endLoc": {
          "line": 58,
          "column": 96,
          "position": 679
        }
      }
    },
    {
      "format": "typescript",
      "lines": 8,
      "fragment": "},\n      }),\n    );\n\n    expect(response.status).toBe(302);\n    const location = response.headers.get(\"location\");\n    expect(new URL(location ?? \"\", \"http://localhost\").pathname).toBe(\"/login\");\n    expect(new URL(location ?? \"\", \"http://localhost\").searchParams.get(\"error\")).toBe(\"github_error\"",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/github-oauth-callback.test.ts",
        "start": 135,
        "end": 142,
        "startLoc": {
          "line": 135,
          "column": 2,
          "position": 1559
        },
        "endLoc": {
          "line": 142,
          "column": 15,
          "position": 1658
        }
      },
      "secondFile": {
        "name": "apps/web/tests/github-oauth-callback.test.ts",
        "start": 109,
        "end": 64,
        "startLoc": {
          "line": 109,
          "column": 2,
          "position": 1263
        },
        "endLoc": {
          "line": 64,
          "column": 18,
          "position": 774
        }
      }
    },
    {
      "format": "typescript",
      "lines": 12,
      "fragment": ", async () => {\n      vi.resetModules();\n      setProjectStatusByRepoIdSpy = vi.fn().mockResolvedValue(undefined);\n      getInstallationOctokitSpy = vi.fn();\n      createAnalyticsBranchSpy = vi.fn();\n      commitAnalyticsFilesSpy = vi.fn();\n      openAnalyticsPullRequestSpy = vi.fn();\n\n      const { generatePullRequestForDetection } = await import(\"../lib/github/generate\");\n      await generatePullRequestForDetection({\n        repoId: BigInt(123),\n        repoFullName: \"owner/repo\"",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/github-generate.test.ts",
        "start": 146,
        "end": 157,
        "startLoc": {
          "line": 146,
          "column": 65,
          "position": 1524
        },
        "endLoc": {
          "line": 157,
          "column": 13,
          "position": 1649
        }
      },
      "secondFile": {
        "name": "apps/web/tests/github-generate.test.ts",
        "start": 116,
        "end": 127,
        "startLoc": {
          "line": 116,
          "column": 59,
          "position": 1272
        },
        "endLoc": {
          "line": 127,
          "column": 20,
          "position": 1397
        }
      }
    },
    {
      "format": "typescript",
      "lines": 16,
      "fragment": ", async () => {\n      vi.resetModules();\n      setProjectStatusByRepoIdSpy = vi.fn().mockResolvedValue(undefined);\n      getInstallationOctokitSpy = vi.fn();\n      createAnalyticsBranchSpy = vi.fn();\n      commitAnalyticsFilesSpy = vi.fn();\n      openAnalyticsPullRequestSpy = vi.fn();\n\n      const { generatePullRequestForDetection } = await import(\"../lib/github/generate\");\n      await generatePullRequestForDetection({\n        repoId: BigInt(123),\n        repoFullName: \"owner/repo\",\n        installationId: BigInt(456),\n        projectId: \"proj_123\",\n        detection: {\n          framework: \"nextjs-app\"",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/github-generate.test.ts",
        "start": 175,
        "end": 190,
        "startLoc": {
          "line": 175,
          "column": 67,
          "position": 1763
        },
        "endLoc": {
          "line": 190,
          "column": 13,
          "position": 1918
        }
      },
      "secondFile": {
        "name": "apps/web/tests/github-generate.test.ts",
        "start": 116,
        "end": 161,
        "startLoc": {
          "line": 116,
          "column": 59,
          "position": 1272
        },
        "endLoc": {
          "line": 161,
          "column": 5,
          "position": 1679
        }
      }
    },
    {
      "format": "typescript",
      "lines": 14,
      "fragment": ");\n      createAnalyticsBranchSpy = vi.fn();\n      commitAnalyticsFilesSpy = vi.fn();\n      openAnalyticsPullRequestSpy = vi.fn();\n\n      const { generatePullRequestForDetection } = await import(\"../lib/github/generate\");\n      await generatePullRequestForDetection({\n        repoId: BigInt(123),\n        repoFullName: \"owner/repo\",\n        installationId: BigInt(456),\n        projectId: \"proj_123\",\n        detection: {\n          framework: \"nextjs-app\",\n          entryPoint: \"app/layout.tsx\"",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/github-generate.test.ts",
        "start": 260,
        "end": 273,
        "startLoc": {
          "line": 260,
          "column": 2,
          "position": 2535
        },
        "endLoc": {
          "line": 273,
          "column": 17,
          "position": 2652
        }
      },
      "secondFile": {
        "name": "apps/web/tests/github-generate.test.ts",
        "start": 119,
        "end": 191,
        "startLoc": {
          "line": 119,
          "column": 2,
          "position": 1317
        },
        "endLoc": {
          "line": 191,
          "column": 5,
          "position": 1925
        }
      }
    },
    {
      "format": "typescript",
      "lines": 18,
      "fragment": ");\n\n      const { generatePullRequestForDetection } = await import(\"../lib/github/generate\");\n      await generatePullRequestForDetection({\n        repoId: BigInt(123),\n        repoFullName: \"owner/repo\",\n        installationId: BigInt(456),\n        projectId: \"proj_123\",\n        detection: {\n          framework: \"nextjs-app\",\n          entryPoint: \"app/layout.tsx\",\n          existingAnalytics: [],\n          isMonorepo: false,\n          error: null,\n        },\n      });\n\n      expect(setProjectStatusByRepoIdSpy",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/github-generate.test.ts",
        "start": 263,
        "end": 280,
        "startLoc": {
          "line": 263,
          "column": 2,
          "position": 2571
        },
        "endLoc": {
          "line": 280,
          "column": 28,
          "position": 2690
        }
      },
      "secondFile": {
        "name": "apps/web/tests/github-generate.test.ts",
        "start": 218,
        "end": 235,
        "startLoc": {
          "line": 218,
          "column": 2,
          "position": 2190
        },
        "endLoc": {
          "line": 235,
          "column": 26,
          "position": 2309
        }
      }
    },
    {
      "format": "typescript",
      "lines": 17,
      "fragment": ",\n        installationId: BigInt(456),\n        projectId: \"proj_123\",\n        detection: {\n          framework: \"nextjs-app\",\n          entryPoint: \"app/layout.tsx\",\n          existingAnalytics: [],\n          isMonorepo: false,\n          error: null,\n        },\n      });\n\n      expect(setProjectStatusByRepoIdSpy).toHaveBeenCalledWith({\n        repoId: BigInt(123),\n        status: \"analysis_failed\",\n      });\n    }",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/github-generate.test.ts",
        "start": 268,
        "end": 284,
        "startLoc": {
          "line": 268,
          "column": 13,
          "position": 2616
        },
        "endLoc": {
          "line": 284,
          "column": 2,
          "position": 2720
        }
      },
      "secondFile": {
        "name": "apps/web/tests/github-generate.test.ts",
        "start": 127,
        "end": 143,
        "startLoc": {
          "line": 127,
          "column": 20,
          "position": 1398
        },
        "endLoc": {
          "line": 143,
          "column": 7,
          "position": 1502
        }
      }
    },
    {
      "format": "typescript",
      "lines": 12,
      "fragment": ", async () => {\n      vi.resetModules();\n      setProjectStatusByRepoIdSpy = vi.fn().mockResolvedValue(undefined);\n      getInstallationOctokitSpy = vi.fn();\n      createAnalyticsBranchSpy = vi.fn();\n      commitAnalyticsFilesSpy = vi.fn();\n      openAnalyticsPullRequestSpy = vi.fn();\n\n      const { generatePullRequestForDetection } = await import(\"../lib/github/generate\");\n      await generatePullRequestForDetection({\n        repoId: BigInt(123),\n        repoFullName: \"owner/repo/extra\"",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/github-generate.test.ts",
        "start": 286,
        "end": 297,
        "startLoc": {
          "line": 286,
          "column": 40,
          "position": 2729
        },
        "endLoc": {
          "line": 297,
          "column": 19,
          "position": 2854
        }
      },
      "secondFile": {
        "name": "apps/web/tests/github-generate.test.ts",
        "start": 116,
        "end": 127,
        "startLoc": {
          "line": 116,
          "column": 59,
          "position": 1272
        },
        "endLoc": {
          "line": 127,
          "column": 20,
          "position": 1397
        }
      }
    },
    {
      "format": "typescript",
      "lines": 19,
      "fragment": ",\n        installationId: BigInt(456),\n        projectId: \"proj_123\",\n        detection: {\n          framework: \"nextjs-app\",\n          entryPoint: \"app/layout.tsx\",\n          existingAnalytics: [],\n          isMonorepo: false,\n          error: null,\n        },\n      });\n\n      expect(setProjectStatusByRepoIdSpy).toHaveBeenCalledWith({\n        repoId: BigInt(123),\n        status: \"analysis_failed\",\n      });\n    });\n\n    it(\"uses fallback events URL when env vars are not set\"",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/github-generate.test.ts",
        "start": 297,
        "end": 315,
        "startLoc": {
          "line": 297,
          "column": 19,
          "position": 2855
        },
        "endLoc": {
          "line": 315,
          "column": 53,
          "position": 2967
        }
      },
      "secondFile": {
        "name": "apps/web/tests/github-generate.test.ts",
        "start": 127,
        "end": 286,
        "startLoc": {
          "line": 127,
          "column": 20,
          "position": 1398
        },
        "endLoc": {
          "line": 286,
          "column": 40,
          "position": 2728
        }
      }
    },
    {
      "format": "typescript",
      "lines": 30,
      "fragment": ";\n\n      setProjectStatusByRepoIdSpy = vi.fn().mockResolvedValue(undefined);\n\n      const mockOctokit = {\n        repos: {\n          get: vi.fn().mockResolvedValue({ data: { default_branch: \"main\" } }),\n        },\n      };\n      getInstallationOctokitSpy = vi.fn().mockResolvedValue(mockOctokit);\n      createAnalyticsBranchSpy = vi.fn().mockResolvedValue(\"add-fast-pr-analytics\");\n      commitAnalyticsFilesSpy = vi.fn().mockResolvedValue({ componentFilePath: \"components/fast-pr-analytics.tsx\" });\n      openAnalyticsPullRequestSpy = vi.fn().mockResolvedValue({ prNumber: 1, prUrl: \"https://github.com/owner/repo/pull/1\" });\n\n      const { generatePullRequestForDetection } = await import(\"../lib/github/generate\");\n      await generatePullRequestForDetection({\n        repoId: BigInt(123),\n        repoFullName: \"owner/repo\",\n        installationId: BigInt(456),\n        projectId: \"proj_123\",\n        detection: {\n          framework: \"nextjs-app\",\n          entryPoint: \"app/layout.tsx\",\n          existingAnalytics: [],\n          isMonorepo: false,\n          error: null,\n        },\n      });\n\n      expect(commitAnalyticsFilesSpy",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/github-generate.test.ts",
        "start": 318,
        "end": 347,
        "startLoc": {
          "line": 318,
          "column": 20,
          "position": 3005
        },
        "endLoc": {
          "line": 347,
          "column": 24,
          "position": 3283
        }
      },
      "secondFile": {
        "name": "apps/web/tests/github-generate.test.ts",
        "start": 206,
        "end": 235,
        "startLoc": {
          "line": 206,
          "column": 29,
          "position": 2031
        },
        "endLoc": {
          "line": 235,
          "column": 26,
          "position": 2309
        }
      }
    },
    {
      "format": "typescript",
      "lines": 33,
      "fragment": ";\n\n      setProjectStatusByRepoIdSpy = vi.fn().mockResolvedValue(undefined);\n\n      const mockOctokit = {\n        repos: {\n          get: vi.fn().mockResolvedValue({ data: { default_branch: \"main\" } }),\n        },\n      };\n      getInstallationOctokitSpy = vi.fn().mockResolvedValue(mockOctokit);\n      createAnalyticsBranchSpy = vi.fn().mockResolvedValue(\"add-fast-pr-analytics\");\n      commitAnalyticsFilesSpy = vi.fn().mockResolvedValue({ componentFilePath: \"components/fast-pr-analytics.tsx\" });\n      openAnalyticsPullRequestSpy = vi.fn().mockResolvedValue({ prNumber: 1, prUrl: \"https://github.com/owner/repo/pull/1\" });\n\n      const { generatePullRequestForDetection } = await import(\"../lib/github/generate\");\n      await generatePullRequestForDetection({\n        repoId: BigInt(123),\n        repoFullName: \"owner/repo\",\n        installationId: BigInt(456),\n        projectId: \"proj_123\",\n        detection: {\n          framework: \"nextjs-app\",\n          entryPoint: \"app/layout.tsx\",\n          existingAnalytics: [],\n          isMonorepo: false,\n          error: null,\n        },\n      });\n\n      expect(commitAnalyticsFilesSpy).toHaveBeenCalledWith(\n        mockOctokit,\n        expect.objectContaining({\n          eventsUrl: \"https://events.myproduct.io\"",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/github-generate.test.ts",
        "start": 358,
        "end": 390,
        "startLoc": {
          "line": 358,
          "column": 27,
          "position": 3365
        },
        "endLoc": {
          "line": 390,
          "column": 30,
          "position": 3664
        }
      },
      "secondFile": {
        "name": "apps/web/tests/github-generate.test.ts",
        "start": 206,
        "end": 350,
        "startLoc": {
          "line": 206,
          "column": 29,
          "position": 2031
        },
        "endLoc": {
          "line": 350,
          "column": 33,
          "position": 3304
        }
      }
    },
    {
      "format": "typescript",
      "lines": 8,
      "fragment": ") return { data: { type: \"file\", content: \"\", encoding: \"base64\" } };\n      throw { status: 404 };\n    });\n    const octokit = { repos: { getContent } };\n\n    const { detectNextRouter } = await import(\"../lib/github/detection\");\n    await expect(detectNextRouter(octokit, \"octo\", \"repo\")).resolves.toEqual({\n      framework: \"nextjs-pages\"",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/github-detection.test.ts",
        "start": 68,
        "end": 75,
        "startLoc": {
          "line": 68,
          "column": 17,
          "position": 812
        },
        "endLoc": {
          "line": 75,
          "column": 15,
          "position": 931
        }
      },
      "secondFile": {
        "name": "apps/web/tests/github-detection.test.ts",
        "start": 52,
        "end": 59,
        "startLoc": {
          "line": 52,
          "column": 21,
          "position": 604
        },
        "endLoc": {
          "line": 59,
          "column": 13,
          "position": 723
        }
      }
    },
    {
      "format": "typescript",
      "lines": 9,
      "fragment": "if (path === \"pages/_app.tsx\") return { data: { type: \"file\", content: \"\", encoding: \"base64\" } };\n      throw { status: 404 };\n    });\n    const octokit = { repos: { getContent } };\n\n    const { detectNextRouter } = await import(\"../lib/github/detection\");\n    await expect(detectNextRouter(octokit, \"octo\", \"repo\")).resolves.toEqual({\n      framework: \"nextjs-app\",\n      entryPoint: \"app/layout.tsx\"",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/github-detection.test.ts",
        "start": 85,
        "end": 93,
        "startLoc": {
          "line": 85,
          "column": 7,
          "position": 1054
        },
        "endLoc": {
          "line": 93,
          "column": 17,
          "position": 1188
        }
      },
      "secondFile": {
        "name": "apps/web/tests/github-detection.test.ts",
        "start": 68,
        "end": 60,
        "startLoc": {
          "line": 68,
          "column": 7,
          "position": 804
        },
        "endLoc": {
          "line": 60,
          "column": 21,
          "position": 730
        }
      }
    },
    {
      "format": "typescript",
      "lines": 9,
      "fragment": ", \"utf8\").toString(\"base64\");\n        return { data: { type: \"file\", content, encoding: \"base64\" } };\n      }\n      throw { status: 404 };\n    });\n    const octokit = { repos: { getContent } };\n\n    const { detectMonorepo } = await import(\"../lib/github/detection\");\n    await expect(detectMonorepo(octokit, \"octo\", \"repo\", {})).resolves.toBe(false",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/github-detection.test.ts",
        "start": 131,
        "end": 139,
        "startLoc": {
          "line": 131,
          "column": 21,
          "position": 1658
        },
        "endLoc": {
          "line": 139,
          "column": 6,
          "position": 1785
        }
      },
      "secondFile": {
        "name": "apps/web/tests/github-detection.test.ts",
        "start": 115,
        "end": 123,
        "startLoc": {
          "line": 115,
          "column": 37,
          "position": 1437
        },
        "endLoc": {
          "line": 123,
          "column": 5,
          "position": 1564
        }
      }
    },
    {
      "format": "typescript",
      "lines": 8,
      "fragment": "throw { status: 404 };\n    });\n    const octokit = { repos: { getContent } };\n\n    const { detectMonorepo } = await import(\"../lib/github/detection\");\n    await expect(detectMonorepo(octokit, \"octo\", \"repo\", {})).resolves.toBe(false);\n  });\n}",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/github-detection.test.ts",
        "start": 146,
        "end": 153,
        "startLoc": {
          "line": 146,
          "column": 7,
          "position": 1840
        },
        "endLoc": {
          "line": 153,
          "column": 2,
          "position": 1932
        }
      },
      "secondFile": {
        "name": "apps/web/tests/github-detection.test.ts",
        "start": 118,
        "end": 142,
        "startLoc": {
          "line": 118,
          "column": 7,
          "position": 1481
        },
        "endLoc": {
          "line": 142,
          "column": 3,
          "position": 1796
        }
      }
    },
    {
      "format": "typescript",
      "lines": 10,
      "fragment": ": ReturnType<typeof vi.fn> | undefined;\n\nvi.mock(\"../lib/auth/get-user\", () => ({\n  getUserFromRequest: (...args: unknown[]) => {\n    if (!getUserFromRequestSpy) throw new Error(\"getUserFromRequestSpy not initialized\");\n    return getUserFromRequestSpy(...args);\n  },\n}));\n\nvi.mock(\"../lib/db/queries/github-tokens\"",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/github-callback-api.test.ts",
        "start": 5,
        "end": 14,
        "startLoc": {
          "line": 5,
          "column": 26,
          "position": 64
        },
        "endLoc": {
          "line": 14,
          "column": 34,
          "position": 156
        }
      },
      "secondFile": {
        "name": "apps/web/tests/regenerate-api.test.ts",
        "start": 7,
        "end": 16,
        "startLoc": {
          "line": 7,
          "column": 21,
          "position": 102
        },
        "endLoc": {
          "line": 16,
          "column": 19,
          "position": 194
        }
      }
    },
    {
      "format": "typescript",
      "lines": 8,
      "fragment": ", async () => {\n    vi.resetModules();\n    getUserFromRequestSpy = vi.fn().mockResolvedValue({\n      id: \"11111111-1111-1111-1111-111111111111\",\n      email: \"test@example.com\",\n    });\n    upsertInstallationLinkSpy = vi.fn().mockResolvedValue(undefined);\n    getOrRefreshInstallationTokenSpy = vi.fn().mockRejectedValue",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/github-callback-api.test.ts",
        "start": 60,
        "end": 67,
        "startLoc": {
          "line": 60,
          "column": 57,
          "position": 602
        },
        "endLoc": {
          "line": 67,
          "column": 18,
          "position": 683
        }
      },
      "secondFile": {
        "name": "apps/web/tests/github-callback-api.test.ts",
        "start": 26,
        "end": 33,
        "startLoc": {
          "line": 26,
          "column": 86,
          "position": 289
        },
        "endLoc": {
          "line": 33,
          "column": 18,
          "position": 370
        }
      }
    },
    {
      "format": "typescript",
      "lines": 7,
      "fragment": ");\n\n    const { GET } = await import(\"../app/api/github/callback/route\");\n    const response = await GET(new Request(\"http://localhost/api/github/callback?installation_id=123\"));\n\n    const location = response.headers.get(\"location\");\n    expect(new URL(location ?? \"\", \"http://localhost\").pathname).toBe(\"/login\"",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/github-callback-api.test.ts",
        "start": 84,
        "end": 90,
        "startLoc": {
          "line": 84,
          "column": 2,
          "position": 906
        },
        "endLoc": {
          "line": 90,
          "column": 9,
          "position": 990
        }
      },
      "secondFile": {
        "name": "apps/web/tests/github-callback-api.test.ts",
        "start": 69,
        "end": 74,
        "startLoc": {
          "line": 69,
          "column": 10,
          "position": 720
        },
        "endLoc": {
          "line": 74,
          "column": 13,
          "position": 803
        }
      }
    },
    {
      "format": "typescript",
      "lines": 8,
      "fragment": ",\n    });\n    await expect(client.getInstallationAccessToken(1)).resolves.toEqual({\n      token: \"t1\",\n      expiresAt: new Date(60_000).toISOString(),\n    });\n    await expect(client.getInstallationAccessToken(1)).resolves.toEqual({\n      token: \"t2\"",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/github-app.test.ts",
        "start": 79,
        "end": 86,
        "startLoc": {
          "line": 79,
          "column": 2,
          "position": 800
        },
        "endLoc": {
          "line": 86,
          "column": 5,
          "position": 878
        }
      },
      "secondFile": {
        "name": "apps/web/tests/github-app.test.ts",
        "start": 74,
        "end": 82,
        "startLoc": {
          "line": 74,
          "column": 6,
          "position": 751
        },
        "endLoc": {
          "line": 82,
          "column": 5,
          "position": 830
        }
      }
    },
    {
      "format": "typescript",
      "lines": 9,
      "fragment": ");\n\n    if (previousAppId === undefined) delete process.env.GITHUB_APP_ID;\n    else process.env.GITHUB_APP_ID = previousAppId;\n    if (previousPrivateKey === undefined) delete process.env.GITHUB_APP_PRIVATE_KEY;\n    else process.env.GITHUB_APP_PRIVATE_KEY = previousPrivateKey;\n  });\n\n  it(\"throws when installation auth response is missing expiresAt\"",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/github-app.test.ts",
        "start": 128,
        "end": 136,
        "startLoc": {
          "line": 128,
          "column": 24,
          "position": 1372
        },
        "endLoc": {
          "line": 136,
          "column": 62,
          "position": 1453
        }
      },
      "secondFile": {
        "name": "apps/web/tests/github-app.test.ts",
        "start": 49,
        "end": 57,
        "startLoc": {
          "line": 49,
          "column": 2,
          "position": 461
        },
        "endLoc": {
          "line": 57,
          "column": 57,
          "position": 542
        }
      }
    },
    {
      "format": "typescript",
      "lines": 10,
      "fragment": "});\n    const client = createGitHubAppClient({\n      appId: 123,\n      privateKey: \"key\",\n      auth: authSpy,\n      now: () => 0,\n      createOctokit: () => ({}) as never,\n    });\n\n    await expect(client.getInstallationAccessToken(1)).rejects.toThrow(/invalid expiresAt/",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/github-app.test.ts",
        "start": 156,
        "end": 165,
        "startLoc": {
          "line": 156,
          "column": 2,
          "position": 1686
        },
        "endLoc": {
          "line": 165,
          "column": 20,
          "position": 1776
        }
      },
      "secondFile": {
        "name": "apps/web/tests/github-app.test.ts",
        "start": 140,
        "end": 149,
        "startLoc": {
          "line": 140,
          "column": 2,
          "position": 1515
        },
        "endLoc": {
          "line": 149,
          "column": 20,
          "position": 1605
        }
      }
    },
    {
      "format": "typescript",
      "lines": 8,
      "fragment": ": ReturnType<typeof vi.fn> | undefined;\n\nvi.mock(\"../lib/db/queries/projects\", () => ({\n  setProjectStatusByRepoId: (...args: unknown[]) => {\n    if (!setProjectStatusByRepoIdSpy) throw new Error(\"setProjectStatusByRepoIdSpy not initialized\");\n    return setProjectStatusByRepoIdSpy(...args);\n  },\n  updateProjectDetectionByRepoId",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/github-analyze.test.ts",
        "start": 8,
        "end": 15,
        "startLoc": {
          "line": 8,
          "column": 35,
          "position": 121
        },
        "endLoc": {
          "line": 15,
          "column": 31,
          "position": 204
        }
      },
      "secondFile": {
        "name": "apps/web/tests/github-generate.test.ts",
        "start": 7,
        "end": 14,
        "startLoc": {
          "line": 7,
          "column": 28,
          "position": 108
        },
        "endLoc": {
          "line": 14,
          "column": 2,
          "position": 190
        }
      }
    },
    {
      "format": "typescript",
      "lines": 12,
      "fragment": "(...args);\n  },\n}));\n\nvi.mock(\"../lib/github/app\", () => ({\n  getInstallationOctokit: (...args: unknown[]) => {\n    if (!getInstallationOctokitSpy) throw new Error(\"getInstallationOctokitSpy not initialized\");\n    return getInstallationOctokitSpy(...args);\n  },\n}));\n\nvi.mock(\"../lib/github/detect-framework\"",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/github-analyze.test.ts",
        "start": 21,
        "end": 32,
        "startLoc": {
          "line": 21,
          "column": 24,
          "position": 293
        },
        "endLoc": {
          "line": 32,
          "column": 33,
          "position": 384
        }
      },
      "secondFile": {
        "name": "apps/web/tests/github-generate.test.ts",
        "start": 12,
        "end": 23,
        "startLoc": {
          "line": 12,
          "column": 28,
          "position": 180
        },
        "endLoc": {
          "line": 23,
          "column": 29,
          "position": 271
        }
      }
    },
    {
      "format": "typescript",
      "lines": 9,
      "fragment": ", async () => {\n    vi.resetModules();\n\n    setProjectStatusByRepoIdSpy = vi.fn().mockResolvedValue(undefined);\n    updateProjectDetectionByRepoIdSpy = vi.fn().mockResolvedValue(undefined);\n    getProjectIdByRepoIdSpy = vi.fn().mockResolvedValue(\"proj_123\");\n    getInstallationOctokitSpy = vi.fn().mockResolvedValue({ some: \"octokit\" });\n    detectFrameworkSpy = vi.fn().mockResolvedValue({\n      framework: \"nextjs-app\"",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/github-analyze.test.ts",
        "start": 80,
        "end": 88,
        "startLoc": {
          "line": 80,
          "column": 38,
          "position": 875
        },
        "endLoc": {
          "line": 88,
          "column": 13,
          "position": 989
        }
      },
      "secondFile": {
        "name": "apps/web/tests/github-analyze.test.ts",
        "start": 47,
        "end": 55,
        "startLoc": {
          "line": 47,
          "column": 67,
          "position": 538
        },
        "endLoc": {
          "line": 55,
          "column": 5,
          "position": 652
        }
      }
    },
    {
      "format": "typescript",
      "lines": 15,
      "fragment": ",\n    });\n    generatePullRequestForDetectionSpy = vi.fn().mockResolvedValue(undefined);\n\n    const { analyzeRepository } = await import(\"../lib/github/analyze\");\n    await analyzeRepository({\n      repoId: 123n,\n      repoFullName: \"octo/repo\",\n      installationId: 456n,\n    });\n\n    expect(setProjectStatusByRepoIdSpy).toHaveBeenCalledWith({ repoId: 123n, status: \"analyzing\" });\n    expect(updateProjectDetectionByRepoIdSpy).toHaveBeenCalledWith({\n      repoId: 123n,\n      detectedFramework: \"nextjs-app\"",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/github-analyze.test.ts",
        "start": 92,
        "end": 106,
        "startLoc": {
          "line": 92,
          "column": 5,
          "position": 1020
        },
        "endLoc": {
          "line": 106,
          "column": 13,
          "position": 1148
        }
      },
      "secondFile": {
        "name": "apps/web/tests/github-analyze.test.ts",
        "start": 59,
        "end": 73,
        "startLoc": {
          "line": 59,
          "column": 24,
          "position": 682
        },
        "endLoc": {
          "line": 73,
          "column": 5,
          "position": 810
        }
      }
    },
    {
      "format": "typescript",
      "lines": 19,
      "fragment": ": ReturnType<typeof vi.fn> | undefined;\n\nvi.mock(\"../lib/auth/session\", () => ({\n  validateSession: (...args: unknown[]) => {\n    if (!validateSessionSpy) throw new Error(\"validateSessionSpy not initialized\");\n    return validateSessionSpy(...args);\n  },\n}));\n\nvi.mock(\"../lib/db/client\", () => ({\n  db: {\n    select: (...args: unknown[]) => {\n      if (!selectSpy) throw new Error(\"selectSpy not initialized\");\n      return selectSpy(...args);\n    },\n  },\n}));\n\ndescribe(\"getUserFromRequest\"",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/get-user.test.ts",
        "start": 4,
        "end": 22,
        "startLoc": {
          "line": 4,
          "column": 10,
          "position": 45
        },
        "endLoc": {
          "line": 22,
          "column": 21,
          "position": 216
        }
      },
      "secondFile": {
        "name": "apps/web/tests/stripe-reconcile-api.test.ts",
        "start": 7,
        "end": 26,
        "startLoc": {
          "line": 7,
          "column": 34,
          "position": 84
        },
        "endLoc": {
          "line": 26,
          "column": 25,
          "position": 255
        }
      }
    },
    {
      "format": "typescript",
      "lines": 10,
      "fragment": ", async () => {\n    vi.resetModules();\n    appendEvents.mockClear();\n    isProjectActive.mockClear();\n\n    const { POST } = await import(\"../../events/app/v1/track/route\");\n    const request = new Request(\"http://localhost/v1/track\", {\n      method: \"POST\",\n      headers: { \"Content-Type\": \"application/json\" },\n      body: JSON.stringify({ events: [{",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/events-track-route.test.ts",
        "start": 44,
        "end": 53,
        "startLoc": {
          "line": 44,
          "column": 46,
          "position": 443
        },
        "endLoc": {
          "line": 53,
          "column": 2,
          "position": 549
        }
      },
      "secondFile": {
        "name": "apps/web/tests/events-track-route.test.ts",
        "start": 24,
        "end": 33,
        "startLoc": {
          "line": 24,
          "column": 52,
          "position": 216
        },
        "endLoc": {
          "line": 33,
          "column": 11,
          "position": 322
        }
      }
    },
    {
      "format": "typescript",
      "lines": 14,
      "fragment": "import { describe, expect, it, vi } from \"vitest\";\n\nconst appendEvents = vi.fn(async () => undefined);\nconst isProjectActive = vi.fn(async () => true);\n\nvi.mock(\"../../events/lib/tinybird\", () => ({\n  createTinybirdClientFromEnv: () => ({ appendEvents }),\n}));\n\nvi.mock(\"../../events/lib/project-cache\", () => ({\n  createProjectCacheFromEnv: () => ({ isProjectActive }),\n}));\n\ndescribe(\"events track route - V2 schema (Task 2.1.A)\"",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/events-track-route-v2-schema.test.ts",
        "start": 1,
        "end": 14,
        "startLoc": {
          "line": 1,
          "column": 1,
          "position": 0
        },
        "endLoc": {
          "line": 14,
          "column": 46,
          "position": 146
        }
      },
      "secondFile": {
        "name": "apps/web/tests/events-track-route.test.ts",
        "start": 1,
        "end": 14,
        "startLoc": {
          "line": 1,
          "column": 1,
          "position": 0
        },
        "endLoc": {
          "line": 14,
          "column": 34,
          "position": 146
        }
      }
    },
    {
      "format": "typescript",
      "lines": 10,
      "fragment": ", async () => {\n    vi.resetModules();\n    appendEvents.mockClear();\n    isProjectActive.mockClear();\n\n    const { POST } = await import(\"../../events/app/v1/track/route\");\n    const request = new Request(\"http://localhost/v1/track\", {\n      method: \"POST\",\n      headers: { \"Content-Type\": \"application/json\" },\n      body: JSON.stringify({ events: [v1Event",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/events-track-route-v2-schema.test.ts",
        "start": 37,
        "end": 46,
        "startLoc": {
          "line": 37,
          "column": 64,
          "position": 330
        },
        "endLoc": {
          "line": 46,
          "column": 8,
          "position": 436
        }
      },
      "secondFile": {
        "name": "apps/web/tests/events-track-route.test.ts",
        "start": 24,
        "end": 33,
        "startLoc": {
          "line": 24,
          "column": 52,
          "position": 216
        },
        "endLoc": {
          "line": 33,
          "column": 11,
          "position": 322
        }
      }
    },
    {
      "format": "typescript",
      "lines": 7,
      "fragment": "] }),\n    });\n\n    const response = await POST(request);\n    expect(response.status).toBe(200);\n    expect(await response.json()).toEqual({ success: true, received: 1 });\n    expect(appendEvents).toHaveBeenCalledWith",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/events-track-route-v2-schema.test.ts",
        "start": 46,
        "end": 52,
        "startLoc": {
          "line": 46,
          "column": 8,
          "position": 437
        },
        "endLoc": {
          "line": 52,
          "column": 21,
          "position": 515
        }
      },
      "secondFile": {
        "name": "apps/web/tests/events-track-route.test.ts",
        "start": 33,
        "end": 39,
        "startLoc": {
          "line": 33,
          "column": 11,
          "position": 323
        },
        "endLoc": {
          "line": 39,
          "column": 22,
          "position": 401
        }
      }
    },
    {
      "format": "typescript",
      "lines": 7,
      "fragment": "] }),\n    });\n\n    const response = await POST(request);\n    expect(response.status).toBe(200);\n    expect(await response.json()).toEqual({ success: true, received: 1 });\n    expect(appendEvents).toHaveBeenCalledWith([v2Event",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/events-track-route-v2-schema.test.ts",
        "start": 66,
        "end": 72,
        "startLoc": {
          "line": 66,
          "column": 8,
          "position": 660
        },
        "endLoc": {
          "line": 72,
          "column": 8,
          "position": 741
        }
      },
      "secondFile": {
        "name": "apps/web/tests/events-track-route.test.ts",
        "start": 33,
        "end": 52,
        "startLoc": {
          "line": 33,
          "column": 11,
          "position": 323
        },
        "endLoc": {
          "line": 52,
          "column": 8,
          "position": 518
        }
      }
    },
    {
      "format": "typescript",
      "lines": 15,
      "fragment": "};\n\n    const { POST } = await import(\"../../events/app/v1/track/route\");\n    const request = new Request(\"http://localhost/v1/track\", {\n      method: \"POST\",\n      headers: { \"Content-Type\": \"application/json\" },\n      body: JSON.stringify({ events: [invalidEvent] }),\n    });\n\n    const response = await POST(request);\n    expect(response.status).toBe(400);\n    expect(appendEvents).not.toHaveBeenCalled();\n  });\n\n  it(\"rejects invalid is_returning (wrong type)\"",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/events-track-route-v2-schema.test.ts",
        "start": 122,
        "end": 136,
        "startLoc": {
          "line": 122,
          "column": 2,
          "position": 1208
        },
        "endLoc": {
          "line": 136,
          "column": 44,
          "position": 1346
        }
      },
      "secondFile": {
        "name": "apps/web/tests/events-track-route-v2-schema.test.ts",
        "start": 103,
        "end": 117,
        "startLoc": {
          "line": 103,
          "column": 2,
          "position": 1015
        },
        "endLoc": {
          "line": 117,
          "column": 44,
          "position": 1153
        }
      }
    },
    {
      "format": "typescript",
      "lines": 15,
      "fragment": "};\n\n    const { POST } = await import(\"../../events/app/v1/track/route\");\n    const request = new Request(\"http://localhost/v1/track\", {\n      method: \"POST\",\n      headers: { \"Content-Type\": \"application/json\" },\n      body: JSON.stringify({ events: [invalidEvent] }),\n    });\n\n    const response = await POST(request);\n    expect(response.status).toBe(400);\n    expect(appendEvents).not.toHaveBeenCalled();\n  });\n\n  it(\"rejects invalid visitor_id (wrong type)\"",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/events-track-route-v2-schema.test.ts",
        "start": 141,
        "end": 155,
        "startLoc": {
          "line": 141,
          "column": 2,
          "position": 1401
        },
        "endLoc": {
          "line": 155,
          "column": 42,
          "position": 1539
        }
      },
      "secondFile": {
        "name": "apps/web/tests/events-track-route-v2-schema.test.ts",
        "start": 103,
        "end": 117,
        "startLoc": {
          "line": 103,
          "column": 2,
          "position": 1015
        },
        "endLoc": {
          "line": 117,
          "column": 44,
          "position": 1153
        }
      }
    },
    {
      "format": "typescript",
      "lines": 14,
      "fragment": "};\n\n    const { POST } = await import(\"../../events/app/v1/track/route\");\n    const request = new Request(\"http://localhost/v1/track\", {\n      method: \"POST\",\n      headers: { \"Content-Type\": \"application/json\" },\n      body: JSON.stringify({ events: [invalidEvent] }),\n    });\n\n    const response = await POST(request);\n    expect(response.status).toBe(400);\n    expect(appendEvents).not.toHaveBeenCalled();\n  });\n}",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/events-track-route-v2-schema.test.ts",
        "start": 160,
        "end": 173,
        "startLoc": {
          "line": 160,
          "column": 2,
          "position": 1594
        },
        "endLoc": {
          "line": 173,
          "column": 2,
          "position": 1728
        }
      },
      "secondFile": {
        "name": "apps/web/tests/events-track-route-v2-schema.test.ts",
        "start": 103,
        "end": 117,
        "startLoc": {
          "line": 103,
          "column": 2,
          "position": 1015
        },
        "endLoc": {
          "line": 117,
          "column": 3,
          "position": 1151
        }
      }
    },
    {
      "format": "typescript",
      "lines": 11,
      "fragment": ");\n\nvi.mock(\"../../events/lib/tinybird\", () => ({\n  createTinybirdClientFromEnv: () => ({ appendEvents }),\n}));\n\nvi.mock(\"../../events/lib/project-cache\", () => ({\n  createProjectCacheFromEnv: () => ({ isProjectActive }),\n}));\n\ndescribe(\"events track route project validation (Task 4.3.A)\"",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/events-track-route-project-validation.test.ts",
        "start": 4,
        "end": 14,
        "startLoc": {
          "line": 4,
          "column": 6,
          "position": 62
        },
        "endLoc": {
          "line": 14,
          "column": 53,
          "position": 146
        }
      },
      "secondFile": {
        "name": "apps/web/tests/events-track-route.test.ts",
        "start": 4,
        "end": 14,
        "startLoc": {
          "line": 4,
          "column": 5,
          "position": 62
        },
        "endLoc": {
          "line": 14,
          "column": 34,
          "position": 146
        }
      }
    },
    {
      "format": "typescript",
      "lines": 9,
      "fragment": ", async () => {\n    vi.resetModules();\n    appendEvents.mockClear();\n    isProjectActive.mockClear();\n\n    const { POST } = await import(\"../../events/app/v1/track/route\");\n    const request = new Request(\"http://localhost/v1/track\", {\n      method: \"POST\",\n      headers: { \"Content-Type\": \"application/json\",",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/events-track-route-project-validation.test.ts",
        "start": 15,
        "end": 23,
        "startLoc": {
          "line": 15,
          "column": 66,
          "position": 160
        },
        "endLoc": {
          "line": 23,
          "column": 2,
          "position": 248
        }
      },
      "secondFile": {
        "name": "apps/web/tests/events-track-route.test.ts",
        "start": 24,
        "end": 32,
        "startLoc": {
          "line": 24,
          "column": 52,
          "position": 216
        },
        "endLoc": {
          "line": 32,
          "column": 2,
          "position": 305
        }
      }
    },
    {
      "format": "typescript",
      "lines": 7,
      "fragment": "}),\n    });\n\n    const response = await POST(request);\n    expect(response.status).toBe(200);\n    expect(await response.json()).toEqual({ success: true, received: 1 });\n    expect(isProjectActive",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/events-track-route-project-validation.test.ts",
        "start": 33,
        "end": 39,
        "startLoc": {
          "line": 33,
          "column": 7,
          "position": 314
        },
        "endLoc": {
          "line": 39,
          "column": 16,
          "position": 387
        }
      },
      "secondFile": {
        "name": "apps/web/tests/events-track-route.test.ts",
        "start": 33,
        "end": 39,
        "startLoc": {
          "line": 33,
          "column": 2,
          "position": 325
        },
        "endLoc": {
          "line": 39,
          "column": 13,
          "position": 398
        }
      }
    },
    {
      "format": "typescript",
      "lines": 14,
      "fragment": "import { describe, expect, it, vi } from \"vitest\";\n\nconst appendEvents = vi.fn(async () => undefined);\nconst isProjectActive = vi.fn(async () => true);\n\nvi.mock(\"../../events/lib/tinybird\", () => ({\n  createTinybirdClientFromEnv: () => ({ appendEvents }),\n}));\n\nvi.mock(\"../../events/lib/project-cache\", () => ({\n  createProjectCacheFromEnv: () => ({ isProjectActive }),\n}));\n\ndescribe(\"events track route CORS (Task 4.2.B)\"",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/events-track-route-cors.test.ts",
        "start": 1,
        "end": 14,
        "startLoc": {
          "line": 1,
          "column": 1,
          "position": 0
        },
        "endLoc": {
          "line": 14,
          "column": 39,
          "position": 146
        }
      },
      "secondFile": {
        "name": "apps/web/tests/events-track-route.test.ts",
        "start": 1,
        "end": 14,
        "startLoc": {
          "line": 1,
          "column": 1,
          "position": 0
        },
        "endLoc": {
          "line": 14,
          "column": 34,
          "position": 146
        }
      }
    },
    {
      "format": "typescript",
      "lines": 13,
      "fragment": ", async () => {\n    vi.resetModules();\n    appendEvents.mockClear();\n    isProjectActive.mockClear();\n\n    const { POST } = await import(\"../../events/app/v1/track/route\");\n    const request = new Request(\"http://localhost/v1/track\", {\n      method: \"POST\",\n      headers: { \"Content-Type\": \"application/json\", Origin: \"https://example.com\" },\n      body: JSON.stringify({\n        events: [\n          {\n            project_id: \"proj_test\"",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/events-track-route-cors.test.ts",
        "start": 27,
        "end": 39,
        "startLoc": {
          "line": 27,
          "column": 57,
          "position": 295
        },
        "endLoc": {
          "line": 39,
          "column": 12,
          "position": 416
        }
      },
      "secondFile": {
        "name": "apps/web/tests/events-track-route.test.ts",
        "start": 24,
        "end": 27,
        "startLoc": {
          "line": 24,
          "column": 52,
          "position": 216
        },
        "endLoc": {
          "line": 27,
          "column": 16,
          "position": 281
        }
      }
    },
    {
      "format": "typescript",
      "lines": 18,
      "fragment": ";\n\nvi.mock(\"../lib/auth/session\", () => ({\n  createSession: (...args: unknown[]) => {\n    if (!createSessionSpy) throw new Error(\"createSessionSpy not initialized\");\n    return createSessionSpy(...args);\n  },\n}));\n\nfunction getSetCookies(response: Response): string[] {\n  const headers = response.headers as unknown as { getSetCookie?: () => string[] };\n  if (typeof headers.getSetCookie === \"function\") return headers.getSetCookie();\n\n  const single = response.headers.get(\"set-cookie\");\n  return single ? [single] : [];\n}\n\ndescribe(\"POST /api/auth/e2e-login\"",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/e2e-login.test.ts",
        "start": 3,
        "end": 20,
        "startLoc": {
          "line": 3,
          "column": 10,
          "position": 40
        },
        "endLoc": {
          "line": 20,
          "column": 27,
          "position": 230
        }
      },
      "secondFile": {
        "name": "apps/web/tests/github-oauth-callback.test.ts",
        "start": 29,
        "end": 46,
        "startLoc": {
          "line": 29,
          "column": 2,
          "position": 358
        },
        "endLoc": {
          "line": 46,
          "column": 32,
          "position": 548
        }
      }
    },
    {
      "format": "typescript",
      "lines": 17,
      "fragment": ", {\n        method: \"POST\",\n        body: JSON.stringify({ userId: \"11111111-1111-1111-1111-111111111111\" }),\n        headers: { \"Content-Type\": \"application/json\" },\n      }),\n    );\n\n    expect(response.status).toBe(404);\n    expect(createSessionSpy).not.toHaveBeenCalled();\n\n    if (previousMode === undefined) delete process.env.E2E_TEST_MODE;\n    else process.env.E2E_TEST_MODE = previousMode;\n    if (previousEnv === undefined) delete (process.env as any).NODE_ENV;\n    else (process.env as any).NODE_ENV = previousEnv;\n  });\n\n  it(\"creates a session and sets a session cookie when enabled\"",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/e2e-login.test.ts",
        "start": 61,
        "end": 77,
        "startLoc": {
          "line": 61,
          "column": 42,
          "position": 674
        },
        "endLoc": {
          "line": 77,
          "column": 59,
          "position": 845
        }
      },
      "secondFile": {
        "name": "apps/web/tests/e2e-login.test.ts",
        "start": 33,
        "end": 49,
        "startLoc": {
          "line": 33,
          "column": 38,
          "position": 373
        },
        "endLoc": {
          "line": 49,
          "column": 63,
          "position": 544
        }
      }
    },
    {
      "format": "typescript",
      "lines": 13,
      "fragment": ");\n\n    const { POST } = await import(\"../app/api/auth/e2e-login/route\");\n\n    const response = await POST(\n      new Request(\"http://localhost/api/auth/e2e-login\", {\n        method: \"POST\",\n        body: JSON.stringify({ userId: \"11111111-1111-1111-1111-111111111111\" }),\n        headers: { \"Content-Type\": \"application/json\" },\n      }),\n    );\n\n    expect(response.status).toBe(200",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/e2e-login.test.ts",
        "start": 87,
        "end": 99,
        "startLoc": {
          "line": 87,
          "column": 2,
          "position": 967
        },
        "endLoc": {
          "line": 99,
          "column": 4,
          "position": 1073
        }
      },
      "secondFile": {
        "name": "apps/web/tests/e2e-login.test.ts",
        "start": 29,
        "end": 40,
        "startLoc": {
          "line": 29,
          "column": 2,
          "position": 332
        },
        "endLoc": {
          "line": 40,
          "column": 4,
          "position": 437
        }
      }
    },
    {
      "format": "typescript",
      "lines": 8,
      "fragment": ");\n\n    if (previousMode === undefined) delete process.env.E2E_TEST_MODE;\n    else process.env.E2E_TEST_MODE = previousMode;\n    if (previousEnv === undefined) delete (process.env as any).NODE_ENV;\n    else (process.env as any).NODE_ENV = previousEnv;\n  });\n}",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/e2e-login.test.ts",
        "start": 104,
        "end": 111,
        "startLoc": {
          "line": 104,
          "column": 5,
          "position": 1153
        },
        "endLoc": {
          "line": 111,
          "column": 2,
          "position": 1242
        }
      },
      "secondFile": {
        "name": "apps/web/tests/e2e-login.test.ts",
        "start": 41,
        "end": 49,
        "startLoc": {
          "line": 41,
          "column": 2,
          "position": 451
        },
        "endLoc": {
          "line": 49,
          "column": 3,
          "position": 542
        }
      }
    },
    {
      "format": "typescript",
      "lines": 20,
      "fragment": "};\n    const getContent = vi.fn(async ({ path }: { path: string }) => {\n      if (path === \"package.json\") {\n        return {\n          data: {\n            type: \"file\",\n            encoding: \"base64\",\n            content: Buffer.from(JSON.stringify(pkg), \"utf8\").toString(\"base64\"),\n          },\n        };\n      }\n      throw { status: 404 };\n    });\n    const octokit = { repos: { getContent } };\n\n    const { detectFramework } = await import(\"../lib/github/detect-framework\");\n    await expect(detectFramework(octokit, \"octo\", \"repo\")).resolves.toMatchObject({\n      framework: null,\n      entryPoint: null,\n      isMonorepo",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/detect-framework.test.ts",
        "start": 53,
        "end": 72,
        "startLoc": {
          "line": 53,
          "column": 2,
          "position": 592
        },
        "endLoc": {
          "line": 72,
          "column": 11,
          "position": 801
        }
      },
      "secondFile": {
        "name": "apps/web/tests/detect-framework.test.ts",
        "start": 27,
        "end": 46,
        "startLoc": {
          "line": 27,
          "column": 2,
          "position": 313
        },
        "endLoc": {
          "line": 46,
          "column": 6,
          "position": 522
        }
      }
    },
    {
      "format": "typescript",
      "lines": 13,
      "fragment": ";\n\n    const getContent = vi.fn(async ({ path }: { path: string }) => {\n      if (path === \"package.json\") {\n        return {\n          data: {\n            type: \"file\",\n            encoding: \"base64\",\n            content: Buffer.from(JSON.stringify(pkg), \"utf8\").toString(\"base64\"),\n          },\n        };\n      }\n      if",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/detect-framework.test.ts",
        "start": 81,
        "end": 93,
        "startLoc": {
          "line": 81,
          "column": 21,
          "position": 881
        },
        "endLoc": {
          "line": 93,
          "column": 3,
          "position": 994
        }
      },
      "secondFile": {
        "name": "apps/web/tests/detect-framework.test.ts",
        "start": 27,
        "end": 38,
        "startLoc": {
          "line": 27,
          "column": 2,
          "position": 314
        },
        "endLoc": {
          "line": 38,
          "column": 6,
          "position": 426
        }
      }
    },
    {
      "format": "typescript",
      "lines": 7,
      "fragment": "throw { status: 404 };\n    });\n    const octokit = { repos: { getContent } };\n\n    const { detectFramework } = await import(\"../lib/github/detect-framework\");\n    await expect(detectFramework(octokit, \"octo\", \"repo\")).resolves.toMatchObject({\n      framework: \"nextjs-app\"",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/detect-framework.test.ts",
        "start": 103,
        "end": 109,
        "startLoc": {
          "line": 103,
          "column": 7,
          "position": 1081
        },
        "endLoc": {
          "line": 109,
          "column": 13,
          "position": 1166
        }
      },
      "secondFile": {
        "name": "apps/web/tests/detect-framework.test.ts",
        "start": 38,
        "end": 44,
        "startLoc": {
          "line": 38,
          "column": 7,
          "position": 426
        },
        "endLoc": {
          "line": 44,
          "column": 5,
          "position": 511
        }
      }
    },
    {
      "format": "typescript",
      "lines": 20,
      "fragment": "} };\n    const getContent = vi.fn(async ({ path }: { path: string }) => {\n      if (path === \"package.json\") {\n        return {\n          data: {\n            type: \"file\",\n            encoding: \"base64\",\n            content: Buffer.from(JSON.stringify(pkg), \"utf8\").toString(\"base64\"),\n          },\n        };\n      }\n      throw { status: 404 };\n    });\n    const octokit = { repos: { getContent } };\n\n    const { detectFramework } = await import(\"../lib/github/detect-framework\");\n    await expect(detectFramework(octokit, \"octo\", \"repo\")).resolves.toMatchObject({\n      framework: null,\n      entryPoint: null,\n      error: \"entry_point_not_found\"",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/detect-framework.test.ts",
        "start": 119,
        "end": 138,
        "startLoc": {
          "line": 119,
          "column": 2,
          "position": 1244
        },
        "endLoc": {
          "line": 138,
          "column": 24,
          "position": 1458
        }
      },
      "secondFile": {
        "name": "apps/web/tests/detect-framework.test.ts",
        "start": 27,
        "end": 46,
        "startLoc": {
          "line": 27,
          "column": 2,
          "position": 311
        },
        "endLoc": {
          "line": 46,
          "column": 24,
          "position": 525
        }
      }
    },
    {
      "format": "typescript",
      "lines": 12,
      "fragment": "} };\n    const getContent = vi.fn(async ({ path }: { path: string }) => {\n      if (path === \"package.json\") {\n        return {\n          data: {\n            type: \"file\",\n            encoding: \"base64\",\n            content: Buffer.from(JSON.stringify(pkg), \"utf8\").toString(\"base64\"),\n          },\n        };\n      }\n      if (path === \"app/layout.tsx\"",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/detect-framework.test.ts",
        "start": 145,
        "end": 156,
        "startLoc": {
          "line": 145,
          "column": 2,
          "position": 1521
        },
        "endLoc": {
          "line": 156,
          "column": 17,
          "position": 1643
        }
      },
      "secondFile": {
        "name": "apps/web/tests/detect-framework.test.ts",
        "start": 27,
        "end": 93,
        "startLoc": {
          "line": 27,
          "column": 2,
          "position": 311
        },
        "endLoc": {
          "line": 93,
          "column": 22,
          "position": 1001
        }
      }
    },
    {
      "format": "typescript",
      "lines": 11,
      "fragment": ", \"utf8\").toString(\"base64\"),\n          },\n        };\n      }\n      if (path === \"app/layout.tsx\") return fileResponse();\n      throw { status: 404 };\n    });\n    const octokit = { repos: { getContent } };\n\n    const { detectFramework } = await import(\"../lib/github/detect-framework\");\n    await expect(detectFramework(octokit, \"octo\", \"repo\")).resolves.toEqual",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/detect-framework.test.ts",
        "start": 152,
        "end": 162,
        "startLoc": {
          "line": 152,
          "column": 2,
          "position": 1613
        },
        "endLoc": {
          "line": 162,
          "column": 8,
          "position": 1731
        }
      },
      "secondFile": {
        "name": "apps/web/tests/detect-framework.test.ts",
        "start": 98,
        "end": 108,
        "startLoc": {
          "line": 98,
          "column": 10,
          "position": 1040
        },
        "endLoc": {
          "line": 108,
          "column": 14,
          "position": 1158
        }
      }
    },
    {
      "format": "typescript",
      "lines": 8,
      "fragment": ", async () => {\n    vi.resetModules();\n    redirectSpy = vi.fn();\n    getUserFromSessionSpy = vi.fn().mockResolvedValue({ id: \"u1\", email: \"test@example.com\" });\n    getUserByIdSpy = vi.fn().mockResolvedValue({\n      id: \"u1\",\n      email: \"test@example.com\",\n      githubUsername: null",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/dashboard-shell.test.ts",
        "start": 57,
        "end": 64,
        "startLoc": {
          "line": 57,
          "column": 50,
          "position": 633
        },
        "endLoc": {
          "line": 64,
          "column": 5,
          "position": 727
        }
      },
      "secondFile": {
        "name": "apps/web/tests/dashboard-shell.test.ts",
        "start": 32,
        "end": 39,
        "startLoc": {
          "line": 32,
          "column": 56,
          "position": 344
        },
        "endLoc": {
          "line": 39,
          "column": 11,
          "position": 438
        }
      }
    },
    {
      "format": "typescript",
      "lines": 8,
      "fragment": ": ReturnType<typeof vi.fn> | undefined;\n\nvi.mock(\"next/navigation\", () => ({\n  redirect: (...args: unknown[]) => {\n    if (!redirectSpy) throw new Error(\"redirectSpy not initialized\");\n    return redirectSpy(...args);\n  },\n}",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/dashboard-page.test.ts",
        "start": 3,
        "end": 10,
        "startLoc": {
          "line": 3,
          "column": 12,
          "position": 26
        },
        "endLoc": {
          "line": 10,
          "column": 2,
          "position": 108
        }
      },
      "secondFile": {
        "name": "apps/web/tests/dashboard-shell.test.ts",
        "start": 7,
        "end": 14,
        "startLoc": {
          "line": 7,
          "column": 15,
          "position": 86
        },
        "endLoc": {
          "line": 14,
          "column": 12,
          "position": 169
        }
      }
    },
    {
      "format": "typescript",
      "lines": 21,
      "fragment": ": ReturnType<typeof vi.fn> | undefined;\nlet tinybirdSqlSpy: ReturnType<typeof vi.fn> | undefined;\n\nvi.mock(\"../lib/auth/get-user\", () => ({\n  getUserFromRequest: (...args: unknown[]) => {\n    if (!getUserFromRequestSpy) throw new Error(\"getUserFromRequestSpy not initialized\");\n    return getUserFromRequestSpy(...args);\n  },\n}));\n\nvi.mock(\"../lib/db/client\", () => ({\n  db: {\n    select: (...args: unknown[]) => {\n      if (!selectSpy) throw new Error(\"selectSpy not initialized\");\n      return selectSpy(...args);\n    },\n  },\n}));\n\nvi.mock(\"../lib/tinybird/client\", () => ({\n  createTinybirdClientFromEnv: (...",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/analytics-sessions-api.test.ts",
        "start": 6,
        "end": 26,
        "startLoc": {
          "line": 6,
          "column": 31,
          "position": 65
        },
        "endLoc": {
          "line": 26,
          "column": 4,
          "position": 273
        }
      },
      "secondFile": {
        "name": "apps/web/tests/projects-list-api.test.ts",
        "start": 4,
        "end": 24,
        "startLoc": {
          "line": 4,
          "column": 10,
          "position": 45
        },
        "endLoc": {
          "line": 24,
          "column": 2,
          "position": 253
        }
      }
    },
    {
      "format": "typescript",
      "lines": 11,
      "fragment": "), {\n      params: { id: \"proj_123\" },\n    });\n\n    expect(response.status).toBe(401);\n  });\n\n  it(\"returns 404 when project is not found\", async () => {\n    vi.resetModules();\n    getUserFromRequestSpy = vi.fn().mockResolvedValue({ id: \"u1\", email: \"u1@example.com\" });\n    selectSpy = vi.fn((",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/analytics-sessions-api.test.ts",
        "start": 45,
        "end": 55,
        "startLoc": {
          "line": 45,
          "column": 60,
          "position": 498
        },
        "endLoc": {
          "line": 55,
          "column": 2,
          "position": 605
        }
      },
      "secondFile": {
        "name": "apps/web/tests/regenerate-api.test.ts",
        "start": 55,
        "end": 49,
        "startLoc": {
          "line": 55,
          "column": 2,
          "position": 611
        },
        "endLoc": {
          "line": 49,
          "column": 2,
          "position": 549
        }
      }
    },
    {
      "format": "typescript",
      "lines": 10,
      "fragment": ");\n    createTinybirdClientFromEnvSpy = vi.fn();\n    tinybirdSqlSpy = vi.fn();\n\n    const { GET } = await import(\"../app/api/projects/[id]/analytics/sessions/route\");\n    const response = await GET(new Request(\"http://localhost/api/projects/proj_123/analytics/sessions\"), {\n      params: { id: \"proj_123\" },\n    });\n\n    expect(response.status).toBe(404",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/analytics-sessions-api.test.ts",
        "start": 55,
        "end": 64,
        "startLoc": {
          "line": 55,
          "column": 2,
          "position": 644
        },
        "endLoc": {
          "line": 64,
          "column": 4,
          "position": 742
        }
      },
      "secondFile": {
        "name": "apps/web/tests/analytics-sessions-api.test.ts",
        "start": 40,
        "end": 49,
        "startLoc": {
          "line": 40,
          "column": 2,
          "position": 435
        },
        "endLoc": {
          "line": 49,
          "column": 4,
          "position": 533
        }
      }
    },
    {
      "format": "typescript",
      "lines": 11,
      "fragment": "{\n      period: \"7d\",\n      totalSessions: 5,\n      newVisitors: 5,\n      returningVisitors: 0,\n      timeSeries: [\n        { date: \"2025-01-01\", newSessions: 2, returningSessions: 0 },\n        { date: \"2025-01-02\", newSessions: 3, returningSessions: 0 },\n      ],\n    });\n  }",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/analytics-sessions-api.test.ts",
        "start": 86,
        "end": 96,
        "startLoc": {
          "line": 86,
          "column": 2,
          "position": 1050
        },
        "endLoc": {
          "line": 96,
          "column": 2,
          "position": 1142
        }
      },
      "secondFile": {
        "name": "apps/web/tests/sessions-page.test.ts",
        "start": 11,
        "end": 22,
        "startLoc": {
          "line": 11,
          "column": 2,
          "position": 123
        },
        "endLoc": {
          "line": 22,
          "column": 6,
          "position": 216
        }
      }
    },
    {
      "format": "typescript",
      "lines": 36,
      "fragment": "import { describe, expect, it, vi } from \"vitest\";\n\nlet getUserFromRequestSpy: ReturnType<typeof vi.fn> | undefined;\nlet selectSpy: ReturnType<typeof vi.fn> | undefined;\n\nlet createTinybirdClientFromEnvSpy: ReturnType<typeof vi.fn> | undefined;\nlet tinybirdSqlSpy: ReturnType<typeof vi.fn> | undefined;\n\nvi.mock(\"../lib/auth/get-user\", () => ({\n  getUserFromRequest: (...args: unknown[]) => {\n    if (!getUserFromRequestSpy) throw new Error(\"getUserFromRequestSpy not initialized\");\n    return getUserFromRequestSpy(...args);\n  },\n}));\n\nvi.mock(\"../lib/db/client\", () => ({\n  db: {\n    select: (...args: unknown[]) => {\n      if (!selectSpy) throw new Error(\"selectSpy not initialized\");\n      return selectSpy(...args);\n    },\n  },\n}));\n\nvi.mock(\"../lib/tinybird/client\", () => ({\n  createTinybirdClientFromEnv: (...args: unknown[]) => {\n    if (!createTinybirdClientFromEnvSpy) throw new Error(\"createTinybirdClientFromEnvSpy not initialized\");\n    return createTinybirdClientFromEnvSpy(...args);\n  },\n  tinybirdSql: (...args: unknown[]) => {\n    if (!tinybirdSqlSpy) throw new Error(\"tinybirdSqlSpy not initialized\");\n    return tinybirdSqlSpy(...args);\n  },\n}));\n\ndescribe(\"GET /api/projects/[id]/analytics/overview\"",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/analytics-overview-api.test.ts",
        "start": 1,
        "end": 36,
        "startLoc": {
          "line": 1,
          "column": 1,
          "position": 0
        },
        "endLoc": {
          "line": 36,
          "column": 44,
          "position": 376
        }
      },
      "secondFile": {
        "name": "apps/web/tests/analytics-sessions-api.test.ts",
        "start": 1,
        "end": 36,
        "startLoc": {
          "line": 1,
          "column": 1,
          "position": 0
        },
        "endLoc": {
          "line": 36,
          "column": 44,
          "position": 376
        }
      }
    },
    {
      "format": "typescript",
      "lines": 9,
      "fragment": ", () => {\n  it(\"returns 401 when unauthenticated\", async () => {\n    vi.resetModules();\n    getUserFromRequestSpy = vi.fn().mockResolvedValue(null);\n    selectSpy = vi.fn();\n    createTinybirdClientFromEnvSpy = vi.fn();\n    tinybirdSqlSpy = vi.fn();\n\n    const { GET } = await import(\"../app/api/projects/[id]/analytics/overview/route\"",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/analytics-overview-api.test.ts",
        "start": 36,
        "end": 44,
        "startLoc": {
          "line": 36,
          "column": 44,
          "position": 377
        },
        "endLoc": {
          "line": 44,
          "column": 52,
          "position": 478
        }
      },
      "secondFile": {
        "name": "apps/web/tests/analytics-sessions-api.test.ts",
        "start": 36,
        "end": 44,
        "startLoc": {
          "line": 36,
          "column": 44,
          "position": 377
        },
        "endLoc": {
          "line": 44,
          "column": 52,
          "position": 478
        }
      }
    },
    {
      "format": "typescript",
      "lines": 15,
      "fragment": "), {\n      params: { id: \"proj_123\" },\n    });\n\n    expect(response.status).toBe(401);\n  });\n\n  it(\"returns 404 when project is not found\", async () => {\n    vi.resetModules();\n    getUserFromRequestSpy = vi.fn().mockResolvedValue({ id: \"u1\", email: \"u1@example.com\" });\n    selectSpy = vi.fn(() => ({ from: () => ({ where: vi.fn().mockResolvedValue([]) }) }));\n    createTinybirdClientFromEnvSpy = vi.fn();\n    tinybirdSqlSpy = vi.fn();\n\n    const { GET } = await import(\"../app/api/projects/[id]/analytics/overview/route\"",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/analytics-overview-api.test.ts",
        "start": 45,
        "end": 59,
        "startLoc": {
          "line": 45,
          "column": 60,
          "position": 498
        },
        "endLoc": {
          "line": 59,
          "column": 52,
          "position": 687
        }
      },
      "secondFile": {
        "name": "apps/web/tests/regenerate-api.test.ts",
        "start": 55,
        "end": 59,
        "startLoc": {
          "line": 55,
          "column": 2,
          "position": 611
        },
        "endLoc": {
          "line": 59,
          "column": 52,
          "position": 687
        }
      }
    },
    {
      "format": "typescript",
      "lines": 10,
      "fragment": ");\n    createTinybirdClientFromEnvSpy = vi.fn();\n    tinybirdSqlSpy = vi.fn();\n\n    const { GET } = await import(\"../app/api/projects/[id]/analytics/overview/route\");\n    const response = await GET(new Request(\"http://localhost/api/projects/proj_123/analytics/overview\"), {\n      params: { id: \"proj_123\" },\n    });\n\n    expect(response.status).toBe(404",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/analytics-overview-api.test.ts",
        "start": 55,
        "end": 64,
        "startLoc": {
          "line": 55,
          "column": 2,
          "position": 644
        },
        "endLoc": {
          "line": 64,
          "column": 4,
          "position": 742
        }
      },
      "secondFile": {
        "name": "apps/web/tests/analytics-overview-api.test.ts",
        "start": 40,
        "end": 49,
        "startLoc": {
          "line": 40,
          "column": 2,
          "position": 435
        },
        "endLoc": {
          "line": 49,
          "column": 4,
          "position": 533
        }
      }
    },
    {
      "format": "typescript",
      "lines": 10,
      "fragment": ", async () => {\n    vi.resetModules();\n    getUserFromRequestSpy = vi.fn().mockResolvedValue({ id: \"u1\", email: \"u1@example.com\" });\n    selectSpy = vi.fn(() => ({ from: () => ({ where: vi.fn().mockResolvedValue([{ id: \"proj_123\" }]) }) }));\n\n    createTinybirdClientFromEnvSpy = vi.fn().mockReturnValue({ apiUrl: \"x\", token: \"y\" });\n\n    tinybirdSqlSpy = vi\n      .fn()\n      // current page views timeseries",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/analytics-overview-api.test.ts",
        "start": 67,
        "end": 76,
        "startLoc": {
          "line": 67,
          "column": 61,
          "position": 756
        },
        "endLoc": {
          "line": 76,
          "column": 33,
          "position": 910
        }
      },
      "secondFile": {
        "name": "apps/web/tests/analytics-sessions-api.test.ts",
        "start": 52,
        "end": 73,
        "startLoc": {
          "line": 52,
          "column": 40,
          "position": 547
        },
        "endLoc": {
          "line": 73,
          "column": 2,
          "position": 905
        }
      }
    },
    {
      "format": "typescript",
      "lines": 36,
      "fragment": "import { describe, expect, it, vi } from \"vitest\";\n\nlet getUserFromRequestSpy: ReturnType<typeof vi.fn> | undefined;\nlet selectSpy: ReturnType<typeof vi.fn> | undefined;\n\nlet createTinybirdClientFromEnvSpy: ReturnType<typeof vi.fn> | undefined;\nlet tinybirdSqlSpy: ReturnType<typeof vi.fn> | undefined;\n\nvi.mock(\"../lib/auth/get-user\", () => ({\n  getUserFromRequest: (...args: unknown[]) => {\n    if (!getUserFromRequestSpy) throw new Error(\"getUserFromRequestSpy not initialized\");\n    return getUserFromRequestSpy(...args);\n  },\n}));\n\nvi.mock(\"../lib/db/client\", () => ({\n  db: {\n    select: (...args: unknown[]) => {\n      if (!selectSpy) throw new Error(\"selectSpy not initialized\");\n      return selectSpy(...args);\n    },\n  },\n}));\n\nvi.mock(\"../lib/tinybird/client\", () => ({\n  createTinybirdClientFromEnv: (...args: unknown[]) => {\n    if (!createTinybirdClientFromEnvSpy) throw new Error(\"createTinybirdClientFromEnvSpy not initialized\");\n    return createTinybirdClientFromEnvSpy(...args);\n  },\n  tinybirdSql: (...args: unknown[]) => {\n    if (!tinybirdSqlSpy) throw new Error(\"tinybirdSqlSpy not initialized\");\n    return tinybirdSqlSpy(...args);\n  },\n}));\n\ndescribe(\"GET /api/projects/[id]/analytics/live\"",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/analytics-live-feed-api.test.ts",
        "start": 1,
        "end": 36,
        "startLoc": {
          "line": 1,
          "column": 1,
          "position": 0
        },
        "endLoc": {
          "line": 36,
          "column": 40,
          "position": 376
        }
      },
      "secondFile": {
        "name": "apps/web/tests/analytics-sessions-api.test.ts",
        "start": 1,
        "end": 36,
        "startLoc": {
          "line": 1,
          "column": 1,
          "position": 0
        },
        "endLoc": {
          "line": 36,
          "column": 44,
          "position": 376
        }
      }
    },
    {
      "format": "typescript",
      "lines": 9,
      "fragment": ", () => {\n  it(\"returns 401 when unauthenticated\", async () => {\n    vi.resetModules();\n    getUserFromRequestSpy = vi.fn().mockResolvedValue(null);\n    selectSpy = vi.fn();\n    createTinybirdClientFromEnvSpy = vi.fn();\n    tinybirdSqlSpy = vi.fn();\n\n    const { GET } = await import(\"../app/api/projects/[id]/analytics/live/route\"",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/analytics-live-feed-api.test.ts",
        "start": 36,
        "end": 44,
        "startLoc": {
          "line": 36,
          "column": 40,
          "position": 377
        },
        "endLoc": {
          "line": 44,
          "column": 48,
          "position": 478
        }
      },
      "secondFile": {
        "name": "apps/web/tests/analytics-sessions-api.test.ts",
        "start": 36,
        "end": 44,
        "startLoc": {
          "line": 36,
          "column": 44,
          "position": 377
        },
        "endLoc": {
          "line": 44,
          "column": 52,
          "position": 478
        }
      }
    },
    {
      "format": "typescript",
      "lines": 8,
      "fragment": ", async () => {\n    vi.resetModules();\n    getUserFromRequestSpy = vi.fn().mockResolvedValue({ id: \"u1\", email: \"u1@example.com\" });\n    selectSpy = vi.fn(() => ({ from: () => ({ where: vi.fn().mockResolvedValue([]) }) }));\n    createTinybirdClientFromEnvSpy = vi.fn();\n    tinybirdSqlSpy = vi.fn();\n\n    const { GET } = await import(\"../app/api/projects/[id]/analytics/live/route\"",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/analytics-live-feed-api.test.ts",
        "start": 52,
        "end": 59,
        "startLoc": {
          "line": 52,
          "column": 59,
          "position": 547
        },
        "endLoc": {
          "line": 59,
          "column": 48,
          "position": 687
        }
      },
      "secondFile": {
        "name": "apps/web/tests/analytics-sessions-api.test.ts",
        "start": 52,
        "end": 59,
        "startLoc": {
          "line": 52,
          "column": 40,
          "position": 547
        },
        "endLoc": {
          "line": 59,
          "column": 52,
          "position": 687
        }
      }
    },
    {
      "format": "typescript",
      "lines": 10,
      "fragment": ");\n    createTinybirdClientFromEnvSpy = vi.fn();\n    tinybirdSqlSpy = vi.fn();\n\n    const { GET } = await import(\"../app/api/projects/[id]/analytics/live/route\");\n    const response = await GET(new Request(\"http://localhost/api/projects/proj_123/analytics/live\"), {\n      params: { id: \"proj_123\" },\n    });\n\n    expect(response.status).toBe(404",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/analytics-live-feed-api.test.ts",
        "start": 55,
        "end": 64,
        "startLoc": {
          "line": 55,
          "column": 2,
          "position": 644
        },
        "endLoc": {
          "line": 64,
          "column": 4,
          "position": 742
        }
      },
      "secondFile": {
        "name": "apps/web/tests/analytics-live-feed-api.test.ts",
        "start": 40,
        "end": 49,
        "startLoc": {
          "line": 40,
          "column": 2,
          "position": 435
        },
        "endLoc": {
          "line": 49,
          "column": 4,
          "position": 533
        }
      }
    },
    {
      "format": "typescript",
      "lines": 11,
      "fragment": ", async () => {\n    vi.resetModules();\n\n    getUserFromRequestSpy = vi.fn().mockResolvedValue({ id: \"u1\", email: \"u1@example.com\" });\n    selectSpy = vi.fn(() => ({ from: () => ({ where: vi.fn().mockResolvedValue([{ id: \"proj_123\" }]) }) }));\n\n    createTinybirdClientFromEnvSpy = vi.fn().mockReturnValue({ apiUrl: \"x\", token: \"y\" });\n    tinybirdSqlSpy = vi.fn().mockResolvedValue({\n      data: [\n        {\n          event_type",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/tests/analytics-live-feed-api.test.ts",
        "start": 67,
        "end": 77,
        "startLoc": {
          "line": 67,
          "column": 60,
          "position": 756
        },
        "endLoc": {
          "line": 77,
          "column": 11,
          "position": 921
        }
      },
      "secondFile": {
        "name": "apps/web/tests/analytics-sessions-api.test.ts",
        "start": 52,
        "end": 75,
        "startLoc": {
          "line": 52,
          "column": 40,
          "position": 547
        },
        "endLoc": {
          "line": 75,
          "column": 5,
          "position": 919
        }
      }
    },
    {
      "format": "javascript",
      "lines": 26,
      "fragment": "import { spawnSync } from \"node:child_process\";\nimport os from \"node:os\";\nimport fs from \"node:fs\";\nimport path from \"node:path\";\n\nconst browsersPath = path.resolve(process.cwd(), \".playwright-browsers\");\nconst pnpmCmd = process.platform === \"win32\" ? \"pnpm.cmd\" : \"pnpm\";\nconst extraArgs = process.argv.slice(2);\n\nfunction playwrightHostPlatformOverride() {\n  if (process.env.PLAYWRIGHT_HOST_PLATFORM_OVERRIDE) return undefined;\n  if (process.platform !== \"darwin\") return undefined;\n  if (process.arch !== \"arm64\") return undefined;\n\n  const darwinMajor = Number.parseInt(os.release().split(\".\")[0] ?? \"\", 10);\n  if (!Number.isFinite(darwinMajor)) return undefined;\n\n  const hasAppleCpuModel = os.cpus().some((cpu) => typeof cpu.model === \"string\" && cpu.model.includes(\"Apple\"));\n  if (hasAppleCpuModel) return undefined;\n\n  const LAST_STABLE_MACOS_MAJOR_VERSION = 15;\n  const macMajor = Math.min(darwinMajor - 9, LAST_STABLE_MACOS_MAJOR_VERSION);\n  return `mac${macMajor}-arm64`;\n}\n\nfunction removeMismatchedMacBrowserRevisions",
      "tokens": 0,
      "firstFile": {
        "name": "apps/web/scripts/playwright-install.mjs",
        "start": 1,
        "end": 26,
        "startLoc": {
          "line": 1,
          "column": 1,
          "position": 0
        },
        "endLoc": {
          "line": 26,
          "column": 36,
          "position": 321
        }
      },
      "secondFile": {
        "name": "apps/web/scripts/playwright-test.mjs",
        "start": 1,
        "end": 27,
        "startLoc": {
          "line": 1,
          "column": 1,
          "position": 0
        },
        "endLoc": {
          "line": 27,
          "column": 33,
          "position": 322
        }
      }
    },
    {
      "format": "typescript",
      "lines": 10,
      "fragment": ";\n};\n\nfunction readRequiredEnv(name: string): string {\n  const value = process.env[name];\n  if (typeof value === \"string\" && value.length > 0) return value;\n  throw new Error(`Missing required environment variable: ${name}`);\n}\n\nfunction",
      "tokens": 0,
      "firstFile": {
        "name": "apps/events/lib/tinybird.ts",
        "start": 16,
        "end": 25,
        "startLoc": {
          "line": 16,
          "column": 2,
          "position": 116
        },
        "endLoc": {
          "line": 25,
          "column": 9,
          "position": 198
        }
      },
      "secondFile": {
        "name": "apps/web/lib/tinybird/client.ts",
        "start": 3,
        "end": 12,
        "startLoc": {
          "line": 3,
          "column": 7,
          "position": 22
        },
        "endLoc": {
          "line": 12,
          "column": 7,
          "position": 104
        }
      }
    }
  ]
}