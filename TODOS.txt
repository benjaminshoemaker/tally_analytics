# TODOs (Deferred)

## Phase 6 Step 5 — Monitoring/Alerting Setup (Deferred)

### A) Vercel Web Analytics (for `usetally.xyz`)
Docs: https://vercel.com/docs/analytics/quickstart

1. Vercel Dashboard → select **web** project → **Analytics** tab → **Enable**.
   - Note: enabling adds routes under `/_vercel/insights/*` after the next deployment.
2. Install package:
   - `pnpm -C apps/web add @vercel/analytics`
3. Add to Next.js App Router root layout:
   - In `apps/web/app/layout.tsx`:
     - `import { Analytics } from "@vercel/analytics/next";`
     - Render `<Analytics />` inside `<body>` (usually after `{children}`).
4. Deploy to production (push to `main` / trigger Vercel deploy).
5. Verify:
   - Visit `https://usetally.xyz/`, open browser DevTools → Network.
   - Look for a request to `/_vercel/insights/view`.

### B) Vercel Speed Insights (optional but recommended)
Docs: https://vercel.com/docs/speed-insights/quickstart

1. Vercel Dashboard → select **web** project → **Speed Insights** tab → **Enable**.
   - Note: enabling adds routes under `/_vercel/speed-insights/*` after the next deployment.
2. Install package:
   - `pnpm -C apps/web add @vercel/speed-insights`
3. Add to Next.js App Router root layout:
   - In `apps/web/app/layout.tsx`:
     - `import { SpeedInsights } from "@vercel/speed-insights/next";`
     - Render `<SpeedInsights />` inside `<body>`.
4. Deploy to production.
5. Verify:
   - Load any page and confirm the HTML contains `/_vercel/speed-insights/script.js`.

### C) Vercel Alerts (error-rate / anomaly alerts)
Docs: https://vercel.com/docs/alerts

Notes:
- Vercel’s built-in alerts are anomaly-based; they are not strict “>1% 5xx for 10 minutes”-style threshold rules.

1. Vercel Dashboard → **Observability** → **Alerts**.
2. Click **Subscribe to Alerts**.
3. Configure delivery:
   - **Vercel Notifications**: click **Manage**, choose which alerts go to email/dashboard.
   - **Slack**: install the Vercel Slack integration; in a target channel run:
     - `/vercel subscribe [team/project] alerts`
     - (Vercel shows the exact command for your team/project.)
   - **Webhook**: choose **Webhook**, select projects, enter your endpoint URL.
4. Mapping to our checklist:
   - “High error rate” → Vercel **Error Anomaly** alert (5xx anomaly detection).
   - “Webhook handler latency spikes” → not a strict-threshold alert per this doc; treat as a metric to monitor in Observability views or forward to an external system for threshold-based alerting.

### D) Neon alerts (recommended via Datadog or OpenTelemetry integration)
Docs:
- Datadog integration: https://neon.tech/docs/guides/datadog
- OpenTelemetry integration: https://neon.tech/docs/guides/opentelemetry

Notes:
- Neon has in-console monitoring; alerting is typically done via an external observability platform.

1. Neon Console → open your **project** → **Integrations**.
2. Choose one:
   - Datadog: add integration, select site, enable Metrics (and optionally Postgres logs), confirm.
   - OpenTelemetry: configure OTLP endpoint + auth, enable metrics/logs, confirm.
3. Example monitors to create in the destination platform:
   - Connection saturation:
     - Get `max_connections` (e.g., run `SHOW max_connections;`).
     - Alert when active connections exceed ~80% of `max_connections`.
   - Slow queries / timeouts:
     - Use exported Postgres logs / query metrics in your platform to alert on sustained increases.

### E) Tinybird monitoring + alerting (ingestion + query errors)
Docs:
- Service data sources: https://www.tinybird.co/docs/forward/monitoring/service-datasources
- Health checks / ops log: https://www.tinybird.co/docs/forward/monitoring/health-checks
- Endpoint performance/error queries: https://www.tinybird.co/docs/forward/monitoring/analyze-endpoints-performance

1. Tinybird UI → Data sources → select `events`:
   - Check last updated, rows, quarantine rows, and the ops log.
2. Ingestion failures (non-2xx from `/v0/events`):
   - Use `tinybird.datasources_ops_log` to compute failure/quarantine rates.
   - Create a Tinybird API endpoint that returns the computed health status/metric.
   - Alert externally when it crosses a threshold.
3. Query errors / endpoint error rate:
   - Use `tinybird.pipe_stats_rt` and group by `pipe_name` + `status_code` (example “errors in the last hour”).
   - Create a Tinybird API endpoint that returns error count/rate.
   - Alert externally when it crosses a threshold.

## Product TODOs

- Re-run detection on repo changes: add a “Re-run analysis” action (and/or auto re-run when repo contents change) so fixing a repo doesn’t require uninstall/reinstall or removing/adding repos in the GitHub App installation.
- Logged-in marketing nav: show a “Dashboard” link on `usetally.xyz` when a valid session exists (routes to `/projects` or `/dashboard`).
- Add functionality to poll for updates and make new PRs if necessary
- Marketing - https://claude.ai/chat/f26fbdc8-cf3e-49c5-a62b-f527048c2634